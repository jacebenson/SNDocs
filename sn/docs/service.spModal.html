<!DOCTYPE html>

<html>
<head>
  <title>service.spModal.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="service.AMB.html">
                  service.AMB.js
                </a>
              
                
                <a class="source" href="service.authInterceptor.html">
                  service.authInterceptor.js
                </a>
              
                
                <a class="source" href="service.avatarProfilePersister.html">
                  service.avatarProfilePersister.js
                </a>
              
                
                <a class="source" href="service.i18n.html">
                  service.i18n.js
                </a>
              
                
                <a class="source" href="service.progressDialog.html">
                  service.progressDialog.js
                </a>
              
                
                <a class="source" href="service.snComplexPopoverService.html">
                  service.snComplexPopoverService.js
                </a>
              
                
                <a class="source" href="service.snComposingPresence.html">
                  service.snComposingPresence.js
                </a>
              
                
                <a class="source" href="service.snCustomEvent.html">
                  service.snCustomEvent.js
                </a>
              
                
                <a class="source" href="service.snMention.html">
                  service.snMention.js
                </a>
              
                
                <a class="source" href="service.snNotification.html">
                  service.snNotification.js
                </a>
              
                
                <a class="source" href="service.snNotifier.html">
                  service.snNotifier.js
                </a>
              
                
                <a class="source" href="service.spAnnouncement.html">
                  service.spAnnouncement.js
                </a>
              
                
                <a class="source" href="service.spAria.html">
                  service.spAria.js
                </a>
              
                
                <a class="source" href="service.spAriaFocusManager.html">
                  service.spAriaFocusManager.js
                </a>
              
                
                <a class="source" href="service.spCodeEditorAutocomplete.html">
                  service.spCodeEditorAutocomplete.js
                </a>
              
                
                <a class="source" href="service.spIs.html">
                  service.spIs.js
                </a>
              
                
                <a class="source" href="service.spMetatags.html">
                  service.spMetatags.js
                </a>
              
                
                <a class="source" href="service.spModal.html">
                  service.spModal.js
                </a>
              
                
                <a class="source" href="service.spNavStateManager.html">
                  service.spNavStateManager.js
                </a>
              
                
                <a class="source" href="service.spPreference.html">
                  service.spPreference.js
                </a>
              
                
                <a class="source" href="service.spThrottle.html">
                  service.spThrottle.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>service.spModal.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/app.$sp/service.spModal.js */</span>
angular.module(<span class="hljs-string">'sn.$sp'</span>).factory(<span class="hljs-string">'spModal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$q, spUtil, $http, $uibModal, i18n</span>) </span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">alert</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-keyword">var</span> options = {
<span class="hljs-attr">title</span>: message,
<span class="hljs-attr">buttons</span>: [ {<span class="hljs-attr">label</span>: i18n.getMessage(<span class="hljs-string">'OK'</span>), <span class="hljs-attr">primary</span>: <span class="hljs-literal">true</span>} ]
}
<span class="hljs-keyword">return</span> alertConfirm(options);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">confirm</span>(<span class="hljs-params">message</span>) </span>{
<span class="hljs-keyword">var</span> options = {<span class="hljs-attr">title</span>: message}
<span class="hljs-keyword">return</span> alertConfirm(options);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">alertConfirm</span>(<span class="hljs-params">options</span>) </span>{
options.messageOnly = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">if</span> (options.title.length &lt; <span class="hljs-number">25</span>)
options.size = <span class="hljs-string">'sm'</span>
<span class="hljs-keyword">var</span> defer = $q.defer();
open(options).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
defer.resolve(<span class="hljs-literal">true</span>);
}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
defer.reject(<span class="hljs-literal">false</span>);
})
<span class="hljs-keyword">return</span> defer.promise;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prompt</span>(<span class="hljs-params">message, defaultValue</span>) </span>{
<span class="hljs-keyword">var</span> options = {
<span class="hljs-attr">title</span>: message,
<span class="hljs-attr">input</span>: <span class="hljs-literal">true</span>,
<span class="hljs-attr">value</span>: defaultValue,
<span class="hljs-attr">headerStyle</span>: {<span class="hljs-attr">border</span>: <span class="hljs-string">'none'</span>, <span class="hljs-string">'padding-bottom'</span>: <span class="hljs-number">0</span>},
<span class="hljs-attr">footerStyle</span>: {<span class="hljs-attr">border</span>: <span class="hljs-string">'none'</span>, <span class="hljs-string">'padding-top'</span>: <span class="hljs-number">0</span>}
}
<span class="hljs-keyword">var</span> defer = $q.defer();
open(options).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
defer.resolve(value);
}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
defer.reject(<span class="hljs-literal">null</span>);
})
<span class="hljs-keyword">return</span> defer.promise;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params">options</span>) </span>{
options = initOptions(options);
<span class="hljs-keyword">var</span> defer = $q.defer();
<span class="hljs-keyword">if</span> (options.widget) {
<span class="hljs-keyword">var</span> widgetURL = spUtil.getWidgetURL(options.widget);
$http.post(widgetURL, options.widgetInput).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
options.widget = response.result;
options.widget.options.shared = options.shared;
_open(options, defer);
});
} <span class="hljs-keyword">else</span>
_open(options, defer);
<span class="hljs-keyword">return</span> defer.promise;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_open</span>(<span class="hljs-params">options, defer</span>) </span>{
$uibModal.open({
<span class="hljs-attr">templateUrl</span>:<span class="hljs-string">'sp-modal.html'</span>,
<span class="hljs-attr">controller</span>: spModalCtrl,
<span class="hljs-attr">size</span>: options.size,
<span class="hljs-attr">backdrop</span>: options.backdrop != <span class="hljs-literal">undefined</span> ? options.backdrop : <span class="hljs-literal">true</span>,
<span class="hljs-attr">keyboard</span>: options.keyboard != <span class="hljs-literal">undefined</span> ? options.keyboard : <span class="hljs-literal">true</span>,
<span class="hljs-attr">resolve</span>: {
<span class="hljs-attr">options</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">return</span> options;
}
}
}).result.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
<span class="hljs-keyword">if</span> (options.input) {
defer.resolve(result.input, result.button);
} <span class="hljs-keyword">else</span> {
defer.resolve(result.button);
}
}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
defer.reject();
});
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initOptions</span>(<span class="hljs-params">options</span>) </span>{
<span class="hljs-keyword">var</span> defaults = {
<span class="hljs-attr">title</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">message</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">messageOnly</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">errorMessage</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">input</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">label</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">size</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">value</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">required</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">values</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">onSubmit</span>: <span class="hljs-literal">null</span>,
<span class="hljs-attr">widget</span>: <span class="hljs-literal">null</span>,
<span class="hljs-attr">widgetInput</span>: <span class="hljs-literal">null</span>,
<span class="hljs-attr">noDismiss</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">buttons</span>: [
{<span class="hljs-attr">label</span>: i18n.getMessage(<span class="hljs-string">'Cancel'</span>), <span class="hljs-attr">cancel</span>:<span class="hljs-literal">true</span>},
{<span class="hljs-attr">label</span>: i18n.getMessage(<span class="hljs-string">'OK'</span>), <span class="hljs-attr">primary</span>:<span class="hljs-literal">true</span>}
]
};
options = options || {};
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> defaults) {
<span class="hljs-keyword">if</span> (options[key] === <span class="hljs-literal">undefined</span>) {
options[key] = defaults[key];
}
}
<span class="hljs-keyword">if</span> (options.messageOnly) {
options.headerStyle = {<span class="hljs-attr">border</span>: <span class="hljs-string">'none'</span>}
options.footerStyle = {<span class="hljs-attr">border</span>: <span class="hljs-string">'none'</span>, <span class="hljs-string">'padding-top'</span>: <span class="hljs-number">0</span>}
}
<span class="hljs-keyword">if</span> (options.noDismiss)
options.headerStyle = {<span class="hljs-attr">display</span>: <span class="hljs-string">'none'</span>};
<span class="hljs-keyword">return</span> options;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">spModalCtrl</span>(<span class="hljs-params">$scope, options</span>) </span>{
$scope.input = {<span class="hljs-attr">value</span>: options.value};
$scope.options = options;
$scope.form = {};
<span class="hljs-keyword">if</span> (!options.input) {
options.buttons.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">b</span>) </span>{
<span class="hljs-keyword">if</span> (b.primary)
b.focus = <span class="hljs-literal">true</span>;
})
}
$scope.buttonClicked = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">button</span>)</span>{
<span class="hljs-keyword">if</span> (button.cancel) {
$scope.$dismiss();
<span class="hljs-keyword">return</span>;
}
<span class="hljs-keyword">if</span> (options.input &amp;&amp; $scope.form.xpForm.$invalid) {
$scope.changed = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">return</span>;
}
<span class="hljs-keyword">if</span>(options.onSubmit) {
<span class="hljs-keyword">var</span> promise = options.onSubmit();
promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
<span class="hljs-keyword">if</span>(!res.status) {
$scope.options.errorMessage = res.errorMessage;
<span class="hljs-keyword">return</span>;
} <span class="hljs-keyword">else</span> {
$scope.$close({<span class="hljs-attr">button</span>:button, <span class="hljs-attr">input</span>: $scope.input.value});
}
});
} <span class="hljs-keyword">else</span> {
$scope.$close({<span class="hljs-attr">button</span>:button, <span class="hljs-attr">input</span>: $scope.input.value});
}
}
$scope.submit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
<span class="hljs-keyword">var</span> ok;
angular.forEach($scope.options.buttons, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">button</span>) </span>{
<span class="hljs-keyword">if</span> (button.primary)
ok = button;
})
<span class="hljs-keyword">if</span> (ok) $scope.buttonClicked(ok);
}
$scope.keyPress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">keyCode</span>) </span>{
<span class="hljs-keyword">if</span>(keyCode === <span class="hljs-number">13</span>) {
$scope.submit();
}
}
}
<span class="hljs-keyword">var</span> spModal = {<span class="hljs-attr">alert</span>: alert, <span class="hljs-attr">confirm</span>: confirm, <span class="hljs-attr">prompt</span>: prompt, <span class="hljs-attr">open</span>: open};
<span class="hljs-keyword">return</span> spModal;
})
angular.module(<span class="hljs-string">'sn.$sp'</span>).directive(<span class="hljs-string">'spFocusIf'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusIf</span>(<span class="hljs-params">$timeout</span>) </span>{
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">link</span>(<span class="hljs-params">$scope, $element, $attrs</span>) </span>{
<span class="hljs-keyword">var</span> dom = $element[<span class="hljs-number">0</span>];
<span class="hljs-keyword">if</span> ($attrs.spFocusIf)
$scope.$watch($attrs.spFocusIf, focus);
<span class="hljs-keyword">else</span>
focus(<span class="hljs-literal">true</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focus</span>(<span class="hljs-params">condition</span>) </span>{
<span class="hljs-keyword">if</span> (condition) {
$timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
dom.focus();
}, $scope.$<span class="hljs-built_in">eval</span>($attrs.spFocusDelay) || <span class="hljs-number">0</span>);
}
}
}
<span class="hljs-keyword">return</span> {
<span class="hljs-attr">restrict</span> : <span class="hljs-string">'A'</span>,
<span class="hljs-attr">link</span> : link
}
})
;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
