<!DOCTYPE html>

<html>
<head>
  <title>service.progressDialog.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="service.AMB.html">
                  service.AMB.js
                </a>
              
                
                <a class="source" href="service.authInterceptor.html">
                  service.authInterceptor.js
                </a>
              
                
                <a class="source" href="service.avatarProfilePersister.html">
                  service.avatarProfilePersister.js
                </a>
              
                
                <a class="source" href="service.i18n.html">
                  service.i18n.js
                </a>
              
                
                <a class="source" href="service.progressDialog.html">
                  service.progressDialog.js
                </a>
              
                
                <a class="source" href="service.snComplexPopoverService.html">
                  service.snComplexPopoverService.js
                </a>
              
                
                <a class="source" href="service.snComposingPresence.html">
                  service.snComposingPresence.js
                </a>
              
                
                <a class="source" href="service.snCustomEvent.html">
                  service.snCustomEvent.js
                </a>
              
                
                <a class="source" href="service.snMention.html">
                  service.snMention.js
                </a>
              
                
                <a class="source" href="service.snNotification.html">
                  service.snNotification.js
                </a>
              
                
                <a class="source" href="service.snNotifier.html">
                  service.snNotifier.js
                </a>
              
                
                <a class="source" href="service.spAnnouncement.html">
                  service.spAnnouncement.js
                </a>
              
                
                <a class="source" href="service.spAria.html">
                  service.spAria.js
                </a>
              
                
                <a class="source" href="service.spAriaFocusManager.html">
                  service.spAriaFocusManager.js
                </a>
              
                
                <a class="source" href="service.spCodeEditorAutocomplete.html">
                  service.spCodeEditorAutocomplete.js
                </a>
              
                
                <a class="source" href="service.spIs.html">
                  service.spIs.js
                </a>
              
                
                <a class="source" href="service.spMetatags.html">
                  service.spMetatags.js
                </a>
              
                
                <a class="source" href="service.spModal.html">
                  service.spModal.js
                </a>
              
                
                <a class="source" href="service.spNavStateManager.html">
                  service.spNavStateManager.js
                </a>
              
                
                <a class="source" href="service.spPreference.html">
                  service.spPreference.js
                </a>
              
                
                <a class="source" href="service.spThrottle.html">
                  service.spThrottle.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>service.progressDialog.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/sn/common/ui/service.progressDialog.js */</span>
angular.module(<span class="hljs-string">'sn.common.ui'</span>).factory(<span class="hljs-string">'progressDialog'</span>, [<span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$compile'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'$http'</span>, <span class="hljs-string">'$templateCache'</span>, <span class="hljs-string">'nowServer'</span>, <span class="hljs-string">'i18n'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$rootScope, $compile, $timeout, $http, $templateCache, nowServer, i18n</span>) </span>{
<span class="hljs-meta">'use strict'</span>;
i18n.getMessages([<span class="hljs-string">'Close'</span>]);
<span class="hljs-keyword">return</span> {
<span class="hljs-attr">STATES</span> : [<span class="hljs-string">"Pending"</span>, <span class="hljs-string">"Running"</span>, <span class="hljs-string">"Succeeded"</span>, <span class="hljs-string">"Failed"</span>, <span class="hljs-string">"Cancelled"</span> ],
<span class="hljs-attr">STATUS_IMAGES</span> : [<span class="hljs-string">"images/workflow_skipped.gif"</span>, <span class="hljs-string">"images/loading_anim2.gifx"</span>,
<span class="hljs-string">"images/progress_success.png"</span>, <span class="hljs-string">"images/progress_failure.png"</span>,
<span class="hljs-string">'images/request_cancelled.gif'</span> ],
<span class="hljs-attr">EXPAND_IMAGE</span> : <span class="hljs-string">"images/icons/filter_hide.gif"</span>,
<span class="hljs-attr">COLLAPSE_IMAGE</span> : <span class="hljs-string">"images/icons/filter_reveal.gif"</span>,
<span class="hljs-attr">BACK_IMAGE</span> : <span class="hljs-string">"images/activity_filter_off.gif"</span>,
<span class="hljs-attr">TIMEOUT_INTERVAL</span> : <span class="hljs-number">750</span>,
<span class="hljs-attr">_findChildMessage</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> statusObject </span>) </span>{
<span class="hljs-keyword">if</span> ( !statusObject.children ) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
<span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; statusObject.children.length; i++ ) {
<span class="hljs-keyword">var</span> child = statusObject.children[i];
<span class="hljs-keyword">if</span> ( child.state == <span class="hljs-string">'1'</span> ) {
<span class="hljs-keyword">var</span> msg = child.message;
<span class="hljs-keyword">var</span> submsg = <span class="hljs-keyword">this</span>._findChildMessage( child );
<span class="hljs-keyword">if</span> ( submsg == <span class="hljs-literal">null</span> )
<span class="hljs-keyword">return</span> msg;
<span class="hljs-keyword">else</span>
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( child.state == <span class="hljs-string">'0'</span> ) {
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
} <span class="hljs-keyword">else</span> {
}
}
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
},
<span class="hljs-attr">create</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, elemid, title, startCallback, endCallback, closeCallback</span>) </span>{
<span class="hljs-keyword">var</span> namespace = <span class="hljs-keyword">this</span>;
<span class="hljs-keyword">var</span> progressItem = scope.$<span class="hljs-keyword">new</span>(<span class="hljs-literal">true</span>);
progressItem.id = elemid + <span class="hljs-string">"_progressDialog"</span>;
progressItem.overlayVisible = <span class="hljs-literal">true</span>;
progressItem.state = <span class="hljs-number">0</span>;
progressItem.message = <span class="hljs-string">''</span>;
progressItem.percentComplete = <span class="hljs-number">0</span>;
progressItem.enableChildMessages = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span> (!title) title = <span class="hljs-string">''</span>;
progressItem.title = title;
progressItem.button_close = i18n.getMessage(<span class="hljs-string">'Close'</span>);
<span class="hljs-keyword">var</span> overlayElement;
overlayElement = $compile(
<span class="hljs-string">'&lt;div id="{{id}}" ng-show="overlayVisible" class="modal modal-mask" role="dialog" tabindex="-1"&gt;'</span> +
<span class="hljs-string">'&lt;div class="modal-dialog m_progress_overlay_content"&gt;'</span> +
<span class="hljs-string">'&lt;div class="modal-content"&gt;'</span> +
<span class="hljs-string">'&lt;header class="modal-header"&gt;'</span> +
<span class="hljs-string">'&lt;h4 class="modal-title"&gt;{{title}}&lt;/h4&gt;'</span> +
<span class="hljs-string">'&lt;/header&gt;'</span> +
<span class="hljs-string">'&lt;div class="modal-body"&gt;'</span> +
<span class="hljs-string">'&lt;div class="progress" ng-class="{\'progress-danger\': (state == 3)}"&gt;'</span> +
<span class="hljs-string">'&lt;div class="progress-bar" ng-class="{\'progress-bar-danger\': (state == 3)}" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{percentComplete}}" ng-style="{width: percentComplete + \'%\'}"&gt;'</span> +
<span class="hljs-string">'&lt;/div&gt;'</span> +
<span class="hljs-string">'&lt;/div&gt;'</span> +
<span class="hljs-string">'&lt;div&gt;{{message}}&lt;span style="float: right;" ng-show="state==1 || state == 2"&gt;{{percentComplete}}%&lt;/span&gt;&lt;/div&gt;'</span> +
<span class="hljs-string">'&lt;/div&gt;'</span> +
<span class="hljs-string">'&lt;footer class="modal-footer"&gt;'</span> +
<span class="hljs-string">'&lt;button class="btn btn-default sn-button sn-button-normal" ng-click="close()" ng-show="state &gt; 1"&gt;{{button_close}}&lt;/button&gt;'</span> +
<span class="hljs-string">'&lt;/footer&gt;'</span> +
<span class="hljs-string">'&lt;/div&gt;'</span> +
<span class="hljs-string">'&lt;/div&gt;'</span> +
<span class="hljs-string">'&lt;/div&gt;'</span>)(progressItem);
$(<span class="hljs-string">"body"</span>)[<span class="hljs-number">0</span>].appendChild(overlayElement[<span class="hljs-number">0</span>]);
progressItem.setEnableChildMessages = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> enableChildren </span>) </span>{
progressItem.enableChildMessages = enableChildren;
}
progressItem.start = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> src, dataArray </span>) </span>{
$http.post(src, dataArray).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
progressItem.trackerId = response.sys_id;
<span class="hljs-keyword">try</span> { <span class="hljs-keyword">if</span> ( startCallback ) startCallback(response); } <span class="hljs-keyword">catch</span>(e) { }
$timeout(progressItem.checkProgress.bind(progressItem));
})
.error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response, status, headers, config</span>) </span>{
progressItem.state = <span class="hljs-string">'3'</span>;
<span class="hljs-keyword">if</span> (endCallback) endCallback( response );
});
};
progressItem.checkProgress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> src = nowServer.getURL(<span class="hljs-string">'progress_status'</span>, {<span class="hljs-attr">sysparm_execution_id</span>: <span class="hljs-keyword">this</span>.trackerId});
$http.post(src).success(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
<span class="hljs-keyword">if</span> ( $.isEmptyObject(response) ) {
progressItem.state = <span class="hljs-string">'3'</span>;
<span class="hljs-keyword">if</span> (endCallback) endCallback( response );
<span class="hljs-keyword">return</span>;
}
progressItem.update( response );
<span class="hljs-keyword">if</span> (response.status == <span class="hljs-string">'error'</span> || response.state == <span class="hljs-string">''</span>) {
progressItem.state = <span class="hljs-string">'3'</span>;
<span class="hljs-keyword">if</span> ( response.message )
progressItem.message = response.message;
<span class="hljs-keyword">else</span>
progressItem.message = response;
<span class="hljs-keyword">if</span> (endCallback) endCallback( response );
<span class="hljs-keyword">return</span>;
}
<span class="hljs-keyword">if</span> ( response.state == <span class="hljs-string">'0'</span> || response.state == <span class="hljs-string">'1'</span> ) {
$timeout(progressItem.checkProgress.bind(progressItem), namespace.TIMEOUT_INTERVAL);
} <span class="hljs-keyword">else</span> {
<span class="hljs-keyword">if</span> (endCallback) endCallback( response );
}
})
.error(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response, status, headers, config</span>) </span>{
progressItem.state = <span class="hljs-string">'3'</span>;
progressItem.message = response;
<span class="hljs-keyword">if</span> (endCallback) endCallback( response );
});
};
progressItem.update = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> statusObject </span>) </span>{
<span class="hljs-keyword">var</span> msg = statusObject.message;
<span class="hljs-keyword">if</span> ( progressItem.enableChildMessages ) {
<span class="hljs-keyword">var</span> childMsg = namespace._findChildMessage( statusObject );
<span class="hljs-keyword">if</span> ( childMsg != <span class="hljs-literal">null</span> )
msg = childMsg;
}
<span class="hljs-keyword">this</span>.message = msg;
<span class="hljs-keyword">this</span>.state = statusObject.state;
<span class="hljs-keyword">this</span>.percentComplete = statusObject.percent_complete;
};
progressItem.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ev</span>) </span>{
<span class="hljs-keyword">try</span> { <span class="hljs-keyword">if</span> (closeCallback) closeCallback(); } <span class="hljs-keyword">catch</span>(e) { }
$(<span class="hljs-string">"body"</span>)[<span class="hljs-number">0</span>].removeChild($(<span class="hljs-string">"#"</span> + <span class="hljs-keyword">this</span>.id)[<span class="hljs-number">0</span>]);
<span class="hljs-keyword">delete</span> namespace.progressItem;
};
<span class="hljs-keyword">return</span> progressItem;
}
}
}]);
;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
