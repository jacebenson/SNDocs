<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge"> <!-- † -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- 
        The above 3 meta tags *must* come first in the <head>
        to consistently ensure proper document rendering.
        Any other head element should come *after* these tags.
    
        † Use the content="ie-edge" tag if your project
        supports Internet Explorer prior to version 11.
    -->
    <!-- Short description of the document (limit to 150 characters) -->
    <!-- This content *may* be used as a part of search engine results. -->
    <meta name="description" content="A history of SN versions">
    <!-- Control the behavior of search engine crawling and indexing -->
    <meta name="robots" content="index,follow"><!-- All Search Engines -->
    <meta name="googlebot" content="index,follow"><!-- Google Specific -->
    <!-- Identify the software used to build the document (i.e. - WordPress, Dreamweaver) -->
    <meta name="generator" content="nodejs">
    <title>SN Versions</title>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <link rel="icon" href="./css/images/favicon.png" />
    
</head>

<body>
    <header>
        
        <script src="./js/jquery-3.2.1.min.js"></script>
        <script src="./js/bootstrap.min.js"></script>
        <link href="./css/bootstrap.min.css" rel="stylesheet"></link>
        <link href="./css/fontawesome.css" rel="stylesheet"></link>
        <script src="./js/script.js"></script>
    </header>
    <div class="container-fluid">
        <table id="table" class="table table-responsive table-hover" data-toolbar="#toolbar" data-search="true" data-show-toggle="true"
            data-show-columns="true" data-sort-name="1" data-sort-order="asc" data-click-to-select="true" data-classes="table table-hover table-no-bordered"
            data-maintain-selected="true">
        </table>

    </div>
    <style>
        .file-text {
            font-size: 8px;
            margin-left: -1.5em;
        }

        td {
            padding: 15px !important;
        }
    </style>
    <script>
        $(document).ready(function () {
            $.ajax({
                url: 'js/data.json?id=' + new Date().getTime(),
                dataType: 'json',
                error: function (jqXHR, status, errorThrown) {
                    //console.log(status);
                },
                success: function (data) {
                    try {
                        //console.log(data);
                        window.colspan = 1;
                        window.dataJson = data;
                        var dataLength = data.length - 1;
                        for (var x = dataLength; x >= 0; x--) {
                            var version = data[x];
                            //console.log(x + ' : data.length - 1 ' + dataLength);
                            if (x === data.length - 1) {
                                //console.log('in if');
                                //console.log('version.name: ' + version.name);
                                var html = '<thead>\n\t<tr class="thead">\n';
                                html += '\t\t<th class="" data-field="1">Version</th>\n';
                                html += '\t\t<th colspan="20" class="" data-field="2">Patches</th>\n';
                                html += '\t\t<th colspan="1" class="" data-field="3">';
                                html += '<div class="float-right text-nowrap">'
                                html += '<a title="Toggle Features" href="#" onclick="toggleFeatures()">';
                                html += 'Features ';
                                html += '<i id="feature-control" class="fa fa-angle-up"></i>';
                                html += '</a>';
                                html += '<a href="/rss.xml"><i class="fa fa-rss-square" aria-hidden="true"></i></a>';
                                html += '</div>';
                                html += '</th>\n';

                                /*
                                var allFeatures = [];
                                for(var a = 0;a<data.length;a++){
                                    allFeatures = allFeatures.concat(data[a].features);
                                }
                                console.log(allFeatures);
                                for (var f = 0; f < allFeatures.length; f++) {
                                    var fieldCount = f+2;
                                    html += '<th data-field="'+fieldCount+'">' + allFeatures[f] + '</th>'
                                }
                                */
                            }
                            html += '\t</tr>\n</thead>\n<tbody>\n\t<tr>\n';
                            html += '\t<tr class="section-header"><td class="section-header" colspan="' + window.colspan + '">';
                            html += '<a href="' + version.url + '">'
                            html += version.name;
                            html += '</a> (' + version.date + ')</td>';
                            if (version.patches.length < 20) {
                                while (version.patches.length < 20) {
                                    version.patches.push({});
                                }
                            }
                            for (var patch in version.patches) {
                                var patchNum = parseInt(patch, 10) + 1;
                                if (version.patches[patch].number) {
                                    //console.log(version.patches[patch].number);
                                    patchNum = version.patches[patch].number;
                                }
                                var thisPatch = version.patches[patch];
                                var hasHi = thisPatch.hi;
                                //console.log('hasHi: ' + hasHi);
                                if (thisPatch.name) {
                                    html += '<td><div class="row">';
                                    //release notes
                                    html += '<div class="col-12">';
                                    if (thisPatch.url === '#') {
                                        html += '<span title="' + thisPatch.name + ' Notes' + '"><strong>' + patchNum + '</strong></span>';
                                    } else {
                                        html += '<a title="' + thisPatch.name + ' Notes' + '" href="' + thisPatch.url + '"><strong>' + patchNum + '</strong></a>';
                                    }
                                    html += '</div>';
                                    //end release notes
                                    if (thisPatch.hi !== undefined) {
                                        //hi security notes
                                        html += '<div class="col-12">';
                                        html += '<a title="' + thisPatch.name + ' Security KB' + '" href="' + thisPatch.hi + '"><i class="fa fa-power-off"></i></a>';
                                        html += '</div>';
                                    }
                                    //end hi security notes
                                    if (thisPatch.git) {
                                        //saved off code
                                        html += '<div class="col-12">';
                                        html += '<a title="' + thisPatch.name + ' Code' + '" href="' + thisPatch.git + '"><i class="fa fa-code-fork"></i></a>';
                                        html += '</div>';
                                        //end saved off code
                                    }

                                    html += '</div></td>'
                                } else {
                                    html += '<td></td>';
                                }
                            }
                            html += '<td>';
                            html += '<div class="feature">'
                            for (var feature in version.features) {
                                html += '<a href="https://docs.servicenow.com/search?q=' + version.features[feature] + '">' + version.features[feature] + '</a>' + '<br/>'
                            }
                            html += '</div>';
                            html += '</td>';
                            html += '</tr>\n';
                        }

                        html += '</tbody>\n';
                        window.html = html
                        $(html).appendTo("#table");
                    } catch (error) {
                        //console.log(error);
                    }
                }
            });
        });
    </script>
</body>

</html>