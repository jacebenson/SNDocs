<!DOCTYPE html>

<html>
<head>
  <title>js_includes_list_edit_doctype.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AJAXCompleter.html">
                  AJAXCompleter.js
                </a>
              
                
                <a class="source" href="AJAXEmailClientCompleter.html">
                  AJAXEmailClientCompleter.js
                </a>
              
                
                <a class="source" href="AJAXOtherCompleter.html">
                  AJAXOtherCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceChoice.html">
                  AJAXReferenceChoice.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleter.html">
                  AJAXReferenceCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleterMulti.html">
                  AJAXReferenceCompleterMulti.js
                </a>
              
                
                <a class="source" href="AJAXReferenceControls.html">
                  AJAXReferenceControls.js
                </a>
              
                
                <a class="source" href="AJAXTableCompleter.html">
                  AJAXTableCompleter.js
                </a>
              
                
                <a class="source" href="AttachmentUploader.html">
                  AttachmentUploader.js
                </a>
              
                
                <a class="source" href="AutoComplete.html">
                  AutoComplete.js
                </a>
              
                
                <a class="source" href="BoundsUtil2.html">
                  BoundsUtil2.js
                </a>
              
                
                <a class="source" href="CookieJar.html">
                  CookieJar.js
                </a>
              
                
                <a class="source" href="CustomEventManager.html">
                  CustomEventManager.js
                </a>
              
                
                <a class="source" href="DaysOfWeekElement.html">
                  DaysOfWeekElement.js
                </a>
              
                
                <a class="source" href="DerivedFields.html">
                  DerivedFields.js
                </a>
              
                
                <a class="source" href="Draggable2.html">
                  Draggable2.js
                </a>
              
                
                <a class="source" href="DropTarget2.html">
                  DropTarget2.js
                </a>
              
                
                <a class="source" href="FieldListElement.html">
                  FieldListElement.js
                </a>
              
                
                <a class="source" href="GlideAPI1.html">
                  GlideAPI1.js
                </a>
              
                
                <a class="source" href="GlideAjax.html">
                  GlideAjax.js
                </a>
              
                
                <a class="source" href="GlideAjaxForm.html">
                  GlideAjaxForm.js
                </a>
              
                
                <a class="source" href="GlideBox.html">
                  GlideBox.js
                </a>
              
                
                <a class="source" href="GlideClientCache.html">
                  GlideClientCache.js
                </a>
              
                
                <a class="source" href="GlideDecoration.html">
                  GlideDecoration.js
                </a>
              
                
                <a class="source" href="GlideDialogForm.html">
                  GlideDialogForm.js
                </a>
              
                
                <a class="source" href="GlideDialogWindow.html">
                  GlideDialogWindow.js
                </a>
              
                
                <a class="source" href="GlideDraggable.html">
                  GlideDraggable.js
                </a>
              
                
                <a class="source" href="GlideDuration.html">
                  GlideDuration.js
                </a>
              
                
                <a class="source" href="GlideEvent.html">
                  GlideEvent.js
                </a>
              
                
                <a class="source" href="GlideEventHandler.html">
                  GlideEventHandler.js
                </a>
              
                
                <a class="source" href="GlideFilter14.html">
                  GlideFilter14.js
                </a>
              
                
                <a class="source" href="GlideFilterDate.html">
                  GlideFilterDate.js
                </a>
              
                
                <a class="source" href="GlideFilterDescription.html">
                  GlideFilterDescription.js
                </a>
              
                
                <a class="source" href="GlideFilterHandlers.html">
                  GlideFilterHandlers.js
                </a>
              
                
                <a class="source" href="GlideFilterItemVariables.html">
                  GlideFilterItemVariables.js
                </a>
              
                
                <a class="source" href="GlideFilterLabels.html">
                  GlideFilterLabels.js
                </a>
              
                
                <a class="source" href="GlideFilterQuestions.html">
                  GlideFilterQuestions.js
                </a>
              
                
                <a class="source" href="GlideFilterReference.html">
                  GlideFilterReference.js
                </a>
              
                
                <a class="source" href="GlideFilterReferenceMulti.html">
                  GlideFilterReferenceMulti.js
                </a>
              
                
                <a class="source" href="GlideFilterVariables.html">
                  GlideFilterVariables.js
                </a>
              
                
                <a class="source" href="GlideForm14.html">
                  GlideForm14.js
                </a>
              
                
                <a class="source" href="GlideHeaderSearch.html">
                  GlideHeaderSearch.js
                </a>
              
                
                <a class="source" href="GlideList2.html">
                  GlideList2.js
                </a>
              
                
                <a class="source" href="GlideList2FilterUtil.html">
                  GlideList2FilterUtil.js
                </a>
              
                
                <a class="source" href="GlideList2Handlers.html">
                  GlideList2Handlers.js
                </a>
              
                
                <a class="source" href="GlideList2InitEvents.html">
                  GlideList2InitEvents.js
                </a>
              
                
                <a class="source" href="GlideList2Statics.html">
                  GlideList2Statics.js
                </a>
              
                
                <a class="source" href="GlideListAggregates.html">
                  GlideListAggregates.js
                </a>
              
                
                <a class="source" href="GlideListEditor.html">
                  GlideListEditor.js
                </a>
              
                
                <a class="source" href="GlideListEditorMessaging.html">
                  GlideListEditorMessaging.js
                </a>
              
                
                <a class="source" href="GlideListElement.html">
                  GlideListElement.js
                </a>
              
                
                <a class="source" href="GlideListWidget.html">
                  GlideListWidget.js
                </a>
              
                
                <a class="source" href="GlideListv3Compatibility.html">
                  GlideListv3Compatibility.js
                </a>
              
                
                <a class="source" href="GlideModalForm.html">
                  GlideModalForm.js
                </a>
              
                
                <a class="source" href="GlideOverlay.html">
                  GlideOverlay.js
                </a>
              
                
                <a class="source" href="GlidePane.html">
                  GlidePane.js
                </a>
              
                
                <a class="source" href="GlidePaneForm.html">
                  GlidePaneForm.js
                </a>
              
                
                <a class="source" href="GlideRecord.html">
                  GlideRecord.js
                </a>
              
                
                <a class="source" href="GlideTabs2.html">
                  GlideTabs2.js
                </a>
              
                
                <a class="source" href="GlideTabs2State.html">
                  GlideTabs2State.js
                </a>
              
                
                <a class="source" href="GlideTabs2Tab.html">
                  GlideTabs2Tab.js
                </a>
              
                
                <a class="source" href="GlideTimeElement.html">
                  GlideTimeElement.js
                </a>
              
                
                <a class="source" href="GlideTimerElement.html">
                  GlideTimerElement.js
                </a>
              
                
                <a class="source" href="GlideTransactionScope.html">
                  GlideTransactionScope.js
                </a>
              
                
                <a class="source" href="GlideUI.html">
                  GlideUI.js
                </a>
              
                
                <a class="source" href="GlideUIDefault.html">
                  GlideUIDefault.js
                </a>
              
                
                <a class="source" href="GlideUIElement.html">
                  GlideUIElement.js
                </a>
              
                
                <a class="source" href="GlideUINotification.html">
                  GlideUINotification.js
                </a>
              
                
                <a class="source" href="GlideURL.html">
                  GlideURL.js
                </a>
              
                
                <a class="source" href="GlideURLElement.html">
                  GlideURLElement.js
                </a>
              
                
                <a class="source" href="GlideUserImageElement.html">
                  GlideUserImageElement.js
                </a>
              
                
                <a class="source" href="GlideWidgetActions.html">
                  GlideWidgetActions.js
                </a>
              
                
                <a class="source" href="GlideWidgetFilter.html">
                  GlideWidgetFilter.js
                </a>
              
                
                <a class="source" href="GlideWidgetHideOnEmpty.html">
                  GlideWidgetHideOnEmpty.js
                </a>
              
                
                <a class="source" href="GlideWidgetSearch.html">
                  GlideWidgetSearch.js
                </a>
              
                
                <a class="source" href="GlideWidgetVCR.html">
                  GlideWidgetVCR.js
                </a>
              
                
                <a class="source" href="GlideWindow.html">
                  GlideWindow.js
                </a>
              
                
                <a class="source" href="GuidedTourElementTranslator.html">
                  GuidedTourElementTranslator.js
                </a>
              
                
                <a class="source" href="GwtCellEditor.html">
                  GwtCellEditor.js
                </a>
              
                
                <a class="source" href="GwtCellSelector.html">
                  GwtCellSelector.js
                </a>
              
                
                <a class="source" href="GwtContextMenu.html">
                  GwtContextMenu.js
                </a>
              
                
                <a class="source" href="GwtCursor.html">
                  GwtCursor.js
                </a>
              
                
                <a class="source" href="GwtDate.html">
                  GwtDate.js
                </a>
              
                
                <a class="source" href="GwtDraggable.html">
                  GwtDraggable.js
                </a>
              
                
                <a class="source" href="GwtDraggableSnap.html">
                  GwtDraggableSnap.js
                </a>
              
                
                <a class="source" href="GwtExportScheduleDialog.html">
                  GwtExportScheduleDialog.js
                </a>
              
                
                <a class="source" href="GwtGridEdit.html">
                  GwtGridEdit.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxChangeSaver.html">
                  GwtListEditAjaxChangeSaver.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxValueLoader.html">
                  GwtListEditAjaxValueLoader.js
                </a>
              
                
                <a class="source" href="GwtListEditBoolean.html">
                  GwtListEditBoolean.js
                </a>
              
                
                <a class="source" href="GwtListEditCalendar.html">
                  GwtListEditCalendar.js
                </a>
              
                
                <a class="source" href="GwtListEditDuration.html">
                  GwtListEditDuration.js
                </a>
              
                
                <a class="source" href="GwtListEditEncryptedText.html">
                  GwtListEditEncryptedText.js
                </a>
              
                
                <a class="source" href="GwtListEditError.html">
                  GwtListEditError.js
                </a>
              
                
                <a class="source" href="GwtListEditGList.html">
                  GwtListEditGList.js
                </a>
              
                
                <a class="source" href="GwtListEditGlideRecord.html">
                  GwtListEditGlideRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditGridSelector.html">
                  GwtListEditGridSelector.js
                </a>
              
                
                <a class="source" href="GwtListEditInternalType.html">
                  GwtListEditInternalType.js
                </a>
              
                
                <a class="source" href="GwtListEditJournal.html">
                  GwtListEditJournal.js
                </a>
              
                
                <a class="source" href="GwtListEditMultiText.html">
                  GwtListEditMultiText.js
                </a>
              
                
                <a class="source" href="GwtListEditPassword.html">
                  GwtListEditPassword.js
                </a>
              
                
                <a class="source" href="GwtListEditRecord.html">
                  GwtListEditRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditRecordDecorations.html">
                  GwtListEditRecordDecorations.js
                </a>
              
                
                <a class="source" href="GwtListEditReference.html">
                  GwtListEditReference.js
                </a>
              
                
                <a class="source" href="GwtListEditRelatedTags.html">
                  GwtListEditRelatedTags.js
                </a>
              
                
                <a class="source" href="GwtListEditSavePolicy.html">
                  GwtListEditSavePolicy.js
                </a>
              
                
                <a class="source" href="GwtListEditSelect.html">
                  GwtListEditSelect.js
                </a>
              
                
                <a class="source" href="GwtListEditTableController.html">
                  GwtListEditTableController.js
                </a>
              
                
                <a class="source" href="GwtListEditTablename.html">
                  GwtListEditTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditText.html">
                  GwtListEditText.js
                </a>
              
                
                <a class="source" href="GwtListEditTranslatedField.html">
                  GwtListEditTranslatedField.js
                </a>
              
                
                <a class="source" href="GwtListEditUpdateTablename.html">
                  GwtListEditUpdateTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditValueRenderer.html">
                  GwtListEditValueRenderer.js
                </a>
              
                
                <a class="source" href="GwtListEditWindow.html">
                  GwtListEditWindow.js
                </a>
              
                
                <a class="source" href="GwtListEditor.html">
                  GwtListEditor.js
                </a>
              
                
                <a class="source" href="GwtListEditorPendingChanges.html">
                  GwtListEditorPendingChanges.js
                </a>
              
                
                <a class="source" href="GwtMessage14.html">
                  GwtMessage14.js
                </a>
              
                
                <a class="source" href="GwtObservable.html">
                  GwtObservable.js
                </a>
              
                
                <a class="source" href="GwtPollDialog.html">
                  GwtPollDialog.js
                </a>
              
                
                <a class="source" href="InPlaceEdit.html">
                  InPlaceEdit.js
                </a>
              
                
                <a class="source" href="ListDraggableRow2.html">
                  ListDraggableRow2.js
                </a>
              
                
                <a class="source" href="ListSelectManager2.html">
                  ListSelectManager2.js
                </a>
              
                
                <a class="source" href="ListSortDual2.html">
                  ListSortDual2.js
                </a>
              
                
                <a class="source" href="ListSortWindow2.html">
                  ListSortWindow2.js
                </a>
              
                
                <a class="source" href="NOW.messaging.html">
                  NOW.messaging.js
                </a>
              
                
                <a class="source" href="NOW.messaging.record.html">
                  NOW.messaging.record.js
                </a>
              
                
                <a class="source" href="NameMapEntry.html">
                  NameMapEntry.js
                </a>
              
                
                <a class="source" href="NotificationMessage.html">
                  NotificationMessage.js
                </a>
              
                
                <a class="source" href="PageTiming14.html">
                  PageTiming14.js
                </a>
              
                
                <a class="source" href="PersonalizeForm.html">
                  PersonalizeForm.js
                </a>
              
                
                <a class="source" href="Point.html">
                  Point.js
                </a>
              
                
                <a class="source" href="SLARepairClient.html">
                  SLARepairClient.js
                </a>
              
                
                <a class="source" href="ScriptLoader.html">
                  ScriptLoader.js
                </a>
              
                
                <a class="source" href="Select.html">
                  Select.js
                </a>
              
                
                <a class="source" href="SlushBucket.html">
                  SlushBucket.js
                </a>
              
                
                <a class="source" href="SortDraggable2.html">
                  SortDraggable2.js
                </a>
              
                
                <a class="source" href="SortDropTarget2.html">
                  SortDropTarget2.js
                </a>
              
                
                <a class="source" href="SortListManager2.html">
                  SortListManager2.js
                </a>
              
                
                <a class="source" href="SortUtil2.html">
                  SortUtil2.js
                </a>
              
                
                <a class="source" href="StopWatch.html">
                  StopWatch.js
                </a>
              
                
                <a class="source" href="Table.html">
                  Table.js
                </a>
              
                
                <a class="source" href="TableElement.html">
                  TableElement.js
                </a>
              
                
                <a class="source" href="TableExtension.html">
                  TableExtension.js
                </a>
              
                
                <a class="source" href="TemplateRecord.html">
                  TemplateRecord.js
                </a>
              
                
                <a class="source" href="TextAreaElement.html">
                  TextAreaElement.js
                </a>
              
                
                <a class="source" href="UserRolesElement.html">
                  UserRolesElement.js
                </a>
              
                
                <a class="source" href="UtilityAndOverrides2.html">
                  UtilityAndOverrides2.js
                </a>
              
                
                <a class="source" href="_module.html">
                  _module.js
                </a>
              
                
                <a class="source" href="ac.html">
                  ac.js
                </a>
              
                
                <a class="source" href="ac_derived_field_support.html">
                  ac_derived_field_support.js
                </a>
              
                
                <a class="source" href="accessibility_tabindex.html">
                  accessibility_tabindex.js
                </a>
              
                
                <a class="source" href="affix.html">
                  affix.js
                </a>
              
                
                <a class="source" href="alert.html">
                  alert.js
                </a>
              
                
                <a class="source" href="amb.Channel.html">
                  amb.Channel.js
                </a>
              
                
                <a class="source" href="amb.ChannelListener.html">
                  amb.ChannelListener.js
                </a>
              
                
                <a class="source" href="amb.ChannelRedirect.html">
                  amb.ChannelRedirect.js
                </a>
              
                
                <a class="source" href="amb.EventManager.html">
                  amb.EventManager.js
                </a>
              
                
                <a class="source" href="amb.Logger.html">
                  amb.Logger.js
                </a>
              
                
                <a class="source" href="amb.MessageClient.html">
                  amb.MessageClient.js
                </a>
              
                
                <a class="source" href="amb.MessageClientBuilder.html">
                  amb.MessageClientBuilder.js
                </a>
              
                
                <a class="source" href="amb.ServerConnection.html">
                  amb.ServerConnection.js
                </a>
              
                
                <a class="source" href="amb_initialize.html">
                  amb_initialize.js
                </a>
              
                
                <a class="source" href="amb_properties.html">
                  amb_properties.js
                </a>
              
                
                <a class="source" href="angular-animate.html">
                  angular-animate.js
                </a>
              
                
                <a class="source" href="angular-aria.html">
                  angular-aria.js
                </a>
              
                
                <a class="source" href="angular-cookies.html">
                  angular-cookies.js
                </a>
              
                
                <a class="source" href="angular-file-upload-all.html">
                  angular-file-upload-all.js
                </a>
              
                
                <a class="source" href="angular-resource.html">
                  angular-resource.js
                </a>
              
                
                <a class="source" href="angular-route.html">
                  angular-route.js
                </a>
              
                
                <a class="source" href="angular-sanitize.html">
                  angular-sanitize.js
                </a>
              
                
                <a class="source" href="angular-touch.html">
                  angular-touch.js
                </a>
              
                
                <a class="source" href="angular-ui-tinymce.html">
                  angular-ui-tinymce.js
                </a>
              
                
                <a class="source" href="angular.html">
                  angular.js
                </a>
              
                
                <a class="source" href="annotations_toggle.html">
                  annotations_toggle.js
                </a>
              
                
                <a class="source" href="app.$sp.html">
                  app.$sp.js
                </a>
              
                
                <a class="source" href="app.config.html">
                  app.config.js
                </a>
              
                
                <a class="source" href="app.ng.amb.html">
                  app.ng.amb.js
                </a>
              
                
                <a class="source" href="app_guided_tours.html">
                  app_guided_tours.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="bootstrap-datetimepicker.html">
                  bootstrap-datetimepicker.js
                </a>
              
                
                <a class="source" href="bootstrap-iconpicker.html">
                  bootstrap-iconpicker.js
                </a>
              
                
                <a class="source" href="bootstrap_336.html">
                  bootstrap_336.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="cabrillo.factory.html">
                  cabrillo.factory.js
                </a>
              
                
                <a class="source" href="calendar.html">
                  calendar.js
                </a>
              
                
                <a class="source" href="camera.html">
                  camera.js
                </a>
              
                
                <a class="source" href="carousel.html">
                  carousel.js
                </a>
              
                
                <a class="source" href="catalogDataLookup.html">
                  catalogDataLookup.js
                </a>
              
                
                <a class="source" href="catalogGlideFormFactory.html">
                  catalogGlideFormFactory.js
                </a>
              
                
                <a class="source" href="catalogItemFactory.html">
                  catalogItemFactory.js
                </a>
              
                
                <a class="source" href="clientScript_components.html">
                  clientScript_components.js
                </a>
              
                
                <a class="source" href="collapse.html">
                  collapse.js
                </a>
              
                
                <a class="source" href="cometd.html">
                  cometd.js
                </a>
              
                
                <a class="source" href="condition14_new.html">
                  condition14_new.js
                </a>
              
                
                <a class="source" href="condition14_reporting.html">
                  condition14_reporting.js
                </a>
              
                
                <a class="source" href="condition14_templates.html">
                  condition14_templates.js
                </a>
              
                
                <a class="source" href="condition_global_variables14.html">
                  condition_global_variables14.js
                </a>
              
                
                <a class="source" href="constants_embedded_help.html">
                  constants_embedded_help.js
                </a>
              
                
                <a class="source" href="context_actions.html">
                  context_actions.js
                </a>
              
                
                <a class="source" href="controller.AMBRecordWatcher.html">
                  controller.AMBRecordWatcher.js
                </a>
              
                
                <a class="source" href="controller.Stream.html">
                  controller.Stream.js
                </a>
              
                
                <a class="source" href="controller.guidedTours.html">
                  controller.guidedTours.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="debug.html">
                  debug.js
                </a>
              
                
                <a class="source" href="decorator.uiTinymce.html">
                  decorator.uiTinymce.js
                </a>
              
                
                <a class="source" href="deferred_related_lists.html">
                  deferred_related_lists.js
                </a>
              
                
                <a class="source" href="depends.html">
                  depends.js
                </a>
              
                
                <a class="source" href="directive.contenteditable.html">
                  directive.contenteditable.js
                </a>
              
                
                <a class="source" href="directive.glideFormField.html">
                  directive.glideFormField.js
                </a>
              
                
                <a class="source" href="directive.glyph.html">
                  directive.glyph.js
                </a>
              
                
                <a class="source" href="directive.message.html">
                  directive.message.js
                </a>
              
                
                <a class="source" href="directive.nowAttachmentsList.html">
                  directive.nowAttachmentsList.js
                </a>
              
                
                <a class="source" href="directive.recursiveHelper.html">
                  directive.recursiveHelper.js
                </a>
              
                
                <a class="source" href="directive.snAttachmentList.html">
                  directive.snAttachmentList.js
                </a>
              
                
                <a class="source" href="directive.snAttachmentPreview.html">
                  directive.snAttachmentPreview.js
                </a>
              
                
                <a class="source" href="directive.snAvatar.html">
                  directive.snAvatar.js
                </a>
              
                
                <a class="source" href="directive.snAvatarPopover.html">
                  directive.snAvatarPopover.js
                </a>
              
                
                <a class="source" href="directive.snBindI18n.html">
                  directive.snBindI18n.js
                </a>
              
                
                <a class="source" href="directive.snBindOnce.html">
                  directive.snBindOnce.js
                </a>
              
                
                <a class="source" href="directive.snBindPopoverSelection.html">
                  directive.snBindPopoverSelection.js
                </a>
              
                
                <a class="source" href="directive.snBlurOnEnter.html">
                  directive.snBlurOnEnter.js
                </a>
              
                
                <a class="source" href="directive.snChoiceList.html">
                  directive.snChoiceList.js
                </a>
              
                
                <a class="source" href="directive.snCloak.html">
                  directive.snCloak.js
                </a>
              
                
                <a class="source" href="directive.snComplexPopover.html">
                  directive.snComplexPopover.js
                </a>
              
                
                <a class="source" href="directive.snConfirmModal.html">
                  directive.snConfirmModal.js
                </a>
              
                
                <a class="source" href="directive.snContextMenu.html">
                  directive.snContextMenu.js
                </a>
              
                
                <a class="source" href="directive.snDayAgo.html">
                  directive.snDayAgo.js
                </a>
              
                
                <a class="source" href="directive.snDialog.html">
                  directive.snDialog.js
                </a>
              
                
                <a class="source" href="directive.snExpandedEmail.html">
                  directive.snExpandedEmail.js
                </a>
              
                
                <a class="source" href="directive.snFieldReference.html">
                  directive.snFieldReference.js
                </a>
              
                
                <a class="source" href="directive.snFileUploadInput.html">
                  directive.snFileUploadInput.js
                </a>
              
                
                <a class="source" href="directive.snFlyout.html">
                  directive.snFlyout.js
                </a>
              
                
                <a class="source" href="directive.snFocus.html">
                  directive.snFocus.js
                </a>
              
                
                <a class="source" href="directive.snGlyph.html">
                  directive.snGlyph.js
                </a>
              
                
                <a class="source" href="directive.snImageUploader.html">
                  directive.snImageUploader.js
                </a>
              
                
                <a class="source" href="directive.snLinkContent.html">
                  directive.snLinkContent.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentArticle.html">
                  directive.snLinkContentArticle.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentAttachment.html">
                  directive.snLinkContentAttachment.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentError.html">
                  directive.snLinkContentError.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentImage.html">
                  directive.snLinkContentImage.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentRecord.html">
                  directive.snLinkContentRecord.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentSoundcloud.html">
                  directive.snLinkContentSoundcloud.js
                </a>
              
                
                <a class="source" href="directive.snLinkContentYoutube.html">
                  directive.snLinkContentYoutube.js
                </a>
              
                
                <a class="source" href="directive.snMentionPopover.html">
                  directive.snMentionPopover.js
                </a>
              
                
                <a class="source" href="directive.snModal.html">
                  directive.snModal.js
                </a>
              
                
                <a class="source" href="directive.snModalShow.html">
                  directive.snModalShow.js
                </a>
              
                
                <a class="source" href="directive.snNotification.html">
                  directive.snNotification.js
                </a>
              
                
                <a class="source" href="directive.snPasteImageHandler.html">
                  directive.snPasteImageHandler.js
                </a>
              
                
                <a class="source" href="directive.snPresence.html">
                  directive.snPresence.js
                </a>
              
                
                <a class="source" href="directive.snRecordPicker.html">
                  directive.snRecordPicker.js
                </a>
              
                
                <a class="source" href="directive.snReferencePicker.html">
                  directive.snReferencePicker.js
                </a>
              
                
                <a class="source" href="directive.snResizeHeight.html">
                  directive.snResizeHeight.js
                </a>
              
                
                <a class="source" href="directive.snSelectBasic.html">
                  directive.snSelectBasic.js
                </a>
              
                
                <a class="source" href="directive.snStickyHeaders.html">
                  directive.snStickyHeaders.js
                </a>
              
                
                <a class="source" href="directive.snStream.html">
                  directive.snStream.js
                </a>
              
                
                <a class="source" href="directive.snSyncWith.html">
                  directive.snSyncWith.js
                </a>
              
                
                <a class="source" href="directive.snTableReference.html">
                  directive.snTableReference.js
                </a>
              
                
                <a class="source" href="directive.snTabs.html">
                  directive.snTabs.js
                </a>
              
                
                <a class="source" href="directive.snTextExpander.html">
                  directive.snTextExpander.js
                </a>
              
                
                <a class="source" href="directive.snTimeAgo.html">
                  directive.snTimeAgo.js
                </a>
              
                
                <a class="source" href="directive.snUserAvatar.html">
                  directive.snUserAvatar.js
                </a>
              
                
                <a class="source" href="directive.snUserProfile.html">
                  directive.snUserProfile.js
                </a>
              
                
                <a class="source" href="directive.spCLink.html">
                  directive.spCLink.js
                </a>
              
                
                <a class="source" href="directive.spCatItem.html">
                  directive.spCatItem.js
                </a>
              
                
                <a class="source" href="directive.spChoiceList.html">
                  directive.spChoiceList.js
                </a>
              
                
                <a class="source" href="directive.spCodeMirror.html">
                  directive.spCodeMirror.js
                </a>
              
                
                <a class="source" href="directive.spColorPicker.html">
                  directive.spColorPicker.js
                </a>
              
                
                <a class="source" href="directive.spContextMenu.html">
                  directive.spContextMenu.js
                </a>
              
                
                <a class="source" href="directive.spCssEditor.html">
                  directive.spCssEditor.js
                </a>
              
                
                <a class="source" href="directive.spDatePicker.html">
                  directive.spDatePicker.js
                </a>
              
                
                <a class="source" href="directive.spDropdownTree.html">
                  directive.spDropdownTree.js
                </a>
              
                
                <a class="source" href="directive.spEditableField.html">
                  directive.spEditableField.js
                </a>
              
                
                <a class="source" href="directive.spFieldListElement.html">
                  directive.spFieldListElement.js
                </a>
              
                
                <a class="source" href="directive.spFormField.html">
                  directive.spFormField.js
                </a>
              
                
                <a class="source" href="directive.spGlyph.html">
                  directive.spGlyph.js
                </a>
              
                
                <a class="source" href="directive.spGlyphPicker.html">
                  directive.spGlyphPicker.js
                </a>
              
                
                <a class="source" href="directive.spHTMLEditor.html">
                  directive.spHTMLEditor.js
                </a>
              
                
                <a class="source" href="directive.spHtmlContent.html">
                  directive.spHtmlContent.js
                </a>
              
                
                <a class="source" href="directive.spPanel.html">
                  directive.spPanel.js
                </a>
              
                
                <a class="source" href="directive.spReferenceElement.html">
                  directive.spReferenceElement.js
                </a>
              
                
                <a class="source" href="directive.spReferenceField.html">
                  directive.spReferenceField.js
                </a>
              
                
                <a class="source" href="directive.spScriptEditor.html">
                  directive.spScriptEditor.js
                </a>
              
                
                <a class="source" href="directive.spTinymceEditor.html">
                  directive.spTinymceEditor.js
                </a>
              
                
                <a class="source" href="dropdown.html">
                  dropdown.js
                </a>
              
                
                <a class="source" href="dropdowns.html">
                  dropdowns.js
                </a>
              
                
                <a class="source" href="email_activity.html">
                  email_activity.js
                </a>
              
                
                <a class="source" href="event_initialize.html">
                  event_initialize.js
                </a>
              
                
                <a class="source" href="factory.AMBOverlay.html">
                  factory.AMBOverlay.js
                </a>
              
                
                <a class="source" href="factory.ArraySynchronizer.html">
                  factory.ArraySynchronizer.js
                </a>
              
                
                <a class="source" href="factory.glideUrlBuilder.html">
                  factory.glideUrlBuilder.js
                </a>
              
                
                <a class="source" href="factory.notificationWrapper.html">
                  factory.notificationWrapper.js
                </a>
              
                
                <a class="source" href="factory.nowAttachmentHandler.html">
                  factory.nowAttachmentHandler.js
                </a>
              
                
                <a class="source" href="factory.paneManager.html">
                  factory.paneManager.js
                </a>
              
                
                <a class="source" href="factory.snAttachmentHandler.html">
                  factory.snAttachmentHandler.js
                </a>
              
                
                <a class="source" href="factory.snPresence.html">
                  factory.snPresence.js
                </a>
              
                
                <a class="source" href="factory.snRecordPresence.html">
                  factory.snRecordPresence.js
                </a>
              
                
                <a class="source" href="factory.snRecordWatcher.html">
                  factory.snRecordWatcher.js
                </a>
              
                
                <a class="source" href="factory.spMacro.html">
                  factory.spMacro.js
                </a>
              
                
                <a class="source" href="factory.spUIActionFactory.html">
                  factory.spUIActionFactory.js
                </a>
              
                
                <a class="source" href="factory.unwrappedHTTPPromise.html">
                  factory.unwrappedHTTPPromise.js
                </a>
              
                
                <a class="source" href="fixedHeaders.html">
                  fixedHeaders.js
                </a>
              
                
                <a class="source" href="form.html">
                  form.js
                </a>
              
                
                <a class="source" href="form_submitted_mask.html">
                  form_submitted_mask.js
                </a>
              
                
                <a class="source" href="form_tags.html">
                  form_tags.js
                </a>
              
                
                <a class="source" href="formatting.html">
                  formatting.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="functions_attachments.html">
                  functions_attachments.js
                </a>
              
                
                <a class="source" href="functions_bootstrap14.html">
                  functions_bootstrap14.js
                </a>
              
                
                <a class="source" href="functions_calendar.html">
                  functions_calendar.js
                </a>
              
                
                <a class="source" href="functions_clipboard.html">
                  functions_clipboard.js
                </a>
              
                
                <a class="source" href="functions_email.html">
                  functions_email.js
                </a>
              
                
                <a class="source" href="functions_fontsizer.html">
                  functions_fontsizer.js
                </a>
              
                
                <a class="source" href="functions_onchange.html">
                  functions_onchange.js
                </a>
              
                
                <a class="source" href="functions_reference.html">
                  functions_reference.js
                </a>
              
                
                <a class="source" href="functions_showloading.html">
                  functions_showloading.js
                </a>
              
                
                <a class="source" href="functions_user_image.html">
                  functions_user_image.js
                </a>
              
                
                <a class="source" href="geolocation.html">
                  geolocation.js
                </a>
              
                
                <a class="source" href="glide-highcharts-v5.html">
                  glide-highcharts-v5.js
                </a>
              
                
                <a class="source" href="glideAjaxFactory.html">
                  glideAjaxFactory.js
                </a>
              
                
                <a class="source" href="glideFormEnvironmentFactory.html">
                  glideFormEnvironmentFactory.js
                </a>
              
                
                <a class="source" href="glideFormFactory.html">
                  glideFormFactory.js
                </a>
              
                
                <a class="source" href="glideFormFieldFactory.html">
                  glideFormFieldFactory.js
                </a>
              
                
                <a class="source" href="glideFormMessageHandler.html">
                  glideFormMessageHandler.js
                </a>
              
                
                <a class="source" href="glideListFactory.html">
                  glideListFactory.js
                </a>
              
                
                <a class="source" href="glideModalFactory.html">
                  glideModalFactory.js
                </a>
              
                
                <a class="source" href="glideRecordData.html">
                  glideRecordData.js
                </a>
              
                
                <a class="source" href="glideRecordFactory.html">
                  glideRecordFactory.js
                </a>
              
                
                <a class="source" href="glideRequest.html">
                  glideRequest.js
                </a>
              
                
                <a class="source" href="glideUIActionsFactory.html">
                  glideUIActionsFactory.js
                </a>
              
                
                <a class="source" href="glideUser.html">
                  glideUser.js
                </a>
              
                
                <a class="source" href="glideUserFactory.html">
                  glideUserFactory.js
                </a>
              
                
                <a class="source" href="glideUserSession.html">
                  glideUserSession.js
                </a>
              
                
                <a class="source" href="guided_tours_template.html">
                  guided_tours_template.js
                </a>
              
                
                <a class="source" href="heisenberg_all.html">
                  heisenberg_all.js
                </a>
              
                
                <a class="source" href="html_class_setter.html">
                  html_class_setter.js
                </a>
              
                
                <a class="source" href="iconset-fontawesome-4.2.0.html">
                  iconset-fontawesome-4.2.0.js
                </a>
              
                
                <a class="source" href="jQueryRequestShim.html">
                  jQueryRequestShim.js
                </a>
              
                
                <a class="source" href="jquery-1.11.0_no_conflict.html">
                  jquery-1.11.0_no_conflict.js
                </a>
              
                
                <a class="source" href="jquery-2.1.html">
                  jquery-2.1.js
                </a>
              
                
                <a class="source" href="jquery-ui-1.9.2.custom.html">
                  jquery-ui-1.9.2.custom.js
                </a>
              
                
                <a class="source" href="jquery.cometd.html">
                  jquery.cometd.js
                </a>
              
                
                <a class="source" href="jquery_clean.html">
                  jquery_clean.js
                </a>
              
                
                <a class="source" href="jquery_includes.html">
                  jquery_includes.js
                </a>
              
                
                <a class="source" href="jquery_no_conflict.html">
                  jquery_no_conflict.js
                </a>
              
                
                <a class="source" href="js_guided_tours_includes.html">
                  js_guided_tours_includes.js
                </a>
              
                
                <a class="source" href="js_includes_amb.html">
                  js_includes_amb.js
                </a>
              
                
                <a class="source" href="js_includes_angular.html">
                  js_includes_angular.js
                </a>
              
                
                <a class="source" href="js_includes_attachments.html">
                  js_includes_attachments.js
                </a>
              
                
                <a class="source" href="js_includes_avatar.html">
                  js_includes_avatar.js
                </a>
              
                
                <a class="source" href="js_includes_cabrillo.html">
                  js_includes_cabrillo.js
                </a>
              
                
                <a class="source" href="js_includes_clientScript.html">
                  js_includes_clientScript.js
                </a>
              
                
                <a class="source" href="js_includes_common.html">
                  js_includes_common.js
                </a>
              
                
                <a class="source" href="js_includes_controls.html">
                  js_includes_controls.js
                </a>
              
                
                <a class="source" href="js_includes_customer.html">
                  js_includes_customer.js
                </a>
              
                
                <a class="source" href="js_includes_data.html">
                  js_includes_data.js
                </a>
              
                
                <a class="source" href="js_includes_datetime.html">
                  js_includes_datetime.js
                </a>
              
                
                <a class="source" href="js_includes_doctype.html">
                  js_includes_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_form.html">
                  js_includes_form.js
                </a>
              
                
                <a class="source" href="js_includes_glide.html">
                  js_includes_glide.js
                </a>
              
                
                <a class="source" href="js_includes_i18n.html">
                  js_includes_i18n.js
                </a>
              
                
                <a class="source" href="js_includes_last_doctype.html">
                  js_includes_last_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_link.html">
                  js_includes_link.js
                </a>
              
                
                <a class="source" href="js_includes_list_edit_doctype.html">
                  js_includes_list_edit_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_listv2_doctype.html">
                  js_includes_listv2_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_mention.html">
                  js_includes_mention.js
                </a>
              
                
                <a class="source" href="js_includes_messaging.html">
                  js_includes_messaging.js
                </a>
              
                
                <a class="source" href="js_includes_ng_amb.html">
                  js_includes_ng_amb.js
                </a>
              
                
                <a class="source" href="js_includes_notification.html">
                  js_includes_notification.js
                </a>
              
                
                <a class="source" href="js_includes_presence.html">
                  js_includes_presence.js
                </a>
              
                
                <a class="source" href="js_includes_sorting_new.html">
                  js_includes_sorting_new.js
                </a>
              
                
                <a class="source" href="js_includes_sp.html">
                  js_includes_sp.js
                </a>
              
                
                <a class="source" href="js_includes_sp_core.html">
                  js_includes_sp_core.js
                </a>
              
                
                <a class="source" href="js_includes_sp_deps.html">
                  js_includes_sp_deps.js
                </a>
              
                
                <a class="source" href="js_includes_sp_tinymce.html">
                  js_includes_sp_tinymce.js
                </a>
              
                
                <a class="source" href="js_includes_stream.html">
                  js_includes_stream.js
                </a>
              
                
                <a class="source" href="js_includes_ui.html">
                  js_includes_ui.js
                </a>
              
                
                <a class="source" href="js_includes_ui_popover.html">
                  js_includes_ui_popover.js
                </a>
              
                
                <a class="source" href="js_includes_user_profile.html">
                  js_includes_user_profile.js
                </a>
              
                
                <a class="source" href="js_includes_util.html">
                  js_includes_util.js
                </a>
              
                
                <a class="source" href="list.html">
                  list.js
                </a>
              
                
                <a class="source" href="list_filter.html">
                  list_filter.js
                </a>
              
                
                <a class="source" href="mentio.html">
                  mentio.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="modals.html">
                  modals.js
                </a>
              
                
                <a class="source" href="moment-2.8.3.html">
                  moment-2.8.3.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="newtag-it.html">
                  newtag-it.js
                </a>
              
                
                <a class="source" href="ng-sortable.html">
                  ng-sortable.js
                </a>
              
                
                <a class="source" href="page_title.html">
                  page_title.js
                </a>
              
                
                <a class="source" href="popover.html">
                  popover.js
                </a>
              
                
                <a class="source" href="popovers.html">
                  popovers.js
                </a>
              
                
                <a class="source" href="popupdivs14.html">
                  popupdivs14.js
                </a>
              
                
                <a class="source" href="popups.html">
                  popups.js
                </a>
              
                
                <a class="source" href="prism.html">
                  prism.js
                </a>
              
                
                <a class="source" href="prototype.effects.html">
                  prototype.effects.js
                </a>
              
                
                <a class="source" href="prototype.hidefix.html">
                  prototype.hidefix.js
                </a>
              
                
                <a class="source" href="prototype.html">
                  prototype.js
                </a>
              
                
                <a class="source" href="prototype.plugin.html">
                  prototype.plugin.js
                </a>
              
                
                <a class="source" href="prototype.template.html">
                  prototype.template.js
                </a>
              
                
                <a class="source" href="provider.lazyloader.html">
                  provider.lazyloader.js
                </a>
              
                
                <a class="source" href="provider.linkContentTypes.html">
                  provider.linkContentTypes.js
                </a>
              
                
                <a class="source" href="scoped_object_generators.html">
                  scoped_object_generators.js
                </a>
              
                
                <a class="source" href="scrollable.html">
                  scrollable.js
                </a>
              
                
                <a class="source" href="scrollspy.html">
                  scrollspy.js
                </a>
              
                
                <a class="source" href="section.html">
                  section.js
                </a>
              
                
                <a class="source" href="select2.html">
                  select2.js
                </a>
              
                
                <a class="source" href="selects.html">
                  selects.js
                </a>
              
                
                <a class="source" href="service.AMB.html">
                  service.AMB.js
                </a>
              
                
                <a class="source" href="service.authInterceptor.html">
                  service.authInterceptor.js
                </a>
              
                
                <a class="source" href="service.avatarProfilePersister.html">
                  service.avatarProfilePersister.js
                </a>
              
                
                <a class="source" href="service.dateUtils.html">
                  service.dateUtils.js
                </a>
              
                
                <a class="source" href="service.debounceFn.html">
                  service.debounceFn.js
                </a>
              
                
                <a class="source" href="service.filterExpressionParser.html">
                  service.filterExpressionParser.js
                </a>
              
                
                <a class="source" href="service.getTemplateUrl.html">
                  service.getTemplateUrl.js
                </a>
              
                
                <a class="source" href="service.guidedToursService.html">
                  service.guidedToursService.js
                </a>
              
                
                <a class="source" href="service.i18n.html">
                  service.i18n.js
                </a>
              
                
                <a class="source" href="service.md5.html">
                  service.md5.js
                </a>
              
                
                <a class="source" href="service.nowServer.html">
                  service.nowServer.js
                </a>
              
                
                <a class="source" href="service.nowStream.html">
                  service.nowStream.js
                </a>
              
                
                <a class="source" href="service.priorityQueue.html">
                  service.priorityQueue.js
                </a>
              
                
                <a class="source" href="service.progressDialog.html">
                  service.progressDialog.js
                </a>
              
                
                <a class="source" href="service.queryFilter.html">
                  service.queryFilter.js
                </a>
              
                
                <a class="source" href="service.snComplexPopoverService.html">
                  service.snComplexPopoverService.js
                </a>
              
                
                <a class="source" href="service.snConnect.html">
                  service.snConnect.js
                </a>
              
                
                <a class="source" href="service.snCustomEvent.html">
                  service.snCustomEvent.js
                </a>
              
                
                <a class="source" href="service.snMention.html">
                  service.snMention.js
                </a>
              
                
                <a class="source" href="service.snNotification.html">
                  service.snNotification.js
                </a>
              
                
                <a class="source" href="service.snNotifier.html">
                  service.snNotifier.js
                </a>
              
                
                <a class="source" href="service.snResource.html">
                  service.snResource.js
                </a>
              
                
                <a class="source" href="service.snTabActivity.html">
                  service.snTabActivity.js
                </a>
              
                
                <a class="source" href="service.spCommunicator.html">
                  service.spCommunicator.js
                </a>
              
                
                <a class="source" href="service.spFileSelect.html">
                  service.spFileSelect.js
                </a>
              
                
                <a class="source" href="service.spModal.html">
                  service.spModal.js
                </a>
              
                
                <a class="source" href="service.spUtil.html">
                  service.spUtil.js
                </a>
              
                
                <a class="source" href="service.urlTools.html">
                  service.urlTools.js
                </a>
              
                
                <a class="source" href="service.userPreferences.html">
                  service.userPreferences.js
                </a>
              
                
                <a class="source" href="simpleStorage.html">
                  simpleStorage.js
                </a>
              
                
                <a class="source" href="snPolyfill.html">
                  snPolyfill.js
                </a>
              
                
                <a class="source" href="snPopover.html">
                  snPopover.js
                </a>
              
                
                <a class="source" href="snTimeAgoSettings.html">
                  snTimeAgoSettings.js
                </a>
              
                
                <a class="source" href="snm.auth.data.module.html">
                  snm.auth.data.module.js
                </a>
              
                
                <a class="source" href="snm.serviceCatalog.data.shim.html">
                  snm.serviceCatalog.data.shim.js
                </a>
              
                
                <a class="source" href="snm.serviceCatalog.form.module.html">
                  snm.serviceCatalog.form.module.js
                </a>
              
                
                <a class="source" href="sp.geo.html">
                  sp.geo.js
                </a>
              
                
                <a class="source" href="streamButton.html">
                  streamButton.js
                </a>
              
                
                <a class="source" href="tables.html">
                  tables.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tabs2_14.html">
                  tabs2_14.js
                </a>
              
                
                <a class="source" href="templates.html">
                  templates.js
                </a>
              
                
                <a class="source" href="textutil.html">
                  textutil.js
                </a>
              
                
                <a class="source" href="timeAgo.html">
                  timeAgo.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="tooltips.html">
                  tooltips.js
                </a>
              
                
                <a class="source" href="transaction_scope_includes.html">
                  transaction_scope_includes.js
                </a>
              
                
                <a class="source" href="transition.html">
                  transition.js
                </a>
              
                
                <a class="source" href="ui-bootstrap-tpls-1.1.2.html">
                  ui-bootstrap-tpls-1.1.2.js
                </a>
              
                
                <a class="source" href="uiPolicyFactory.html">
                  uiPolicyFactory.js
                </a>
              
                
                <a class="source" href="uiPolicyTypes.html">
                  uiPolicyTypes.js
                </a>
              
                
                <a class="source" href="ui_policy.html">
                  ui_policy.js
                </a>
              
                
                <a class="source" href="utils14.html">
                  utils14.js
                </a>
              
                
                <a class="source" href="viewLayout.html">
                  viewLayout.js
                </a>
              
                
                <a class="source" href="xmlUtil.html">
                  xmlUtil.js
                </a>
              
                
                <a class="source" href="xmlhttp.html">
                  xmlhttp.js
                </a>
              
                
                <a class="source" href="z_last_include.html">
                  z_last_include.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>js_includes_list_edit_doctype.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>/*! RESOURCE: /scripts/js_includes_list_edit_doctype.js */
/*! RESOURCE: /scripts/GwtListEditWindow.js */
var GwtListEditWindow = Class.create(GlideWindow, {
  MESSAGES: [
    "1 row will be updated",
    " rows will be updated",
    "1 row will not be updated",
    " rows will not be updated",
    "Cancel (ESC)",
    "Save (Enter)"
  ],
  initialize: function($super, editor, gridEdit) {
    this.originalValue = editor.getValue();
    this.originalRenderValue = gridEdit.selected.textContent;
    this.editor = editor;
    this.gridEdit = gridEdit;
    $super(GwtListEditWindow.glideWindowId, true);
    this.refName = editor.name;
    this._getMessages();
    this.state = 'initialize';
    this.destroyed = false;
    this.statusPane = null;
    this._createControls();
  },
  _showUpdateMessage: function() {
    this.removeStatusPane();
    this.getCountCellsSelected();
    var numSelected = this.numCanEdit + this.numCannotEdit;
    if (numSelected &lt;= 1)
      return;
    var msgStr;
    if (this.numCanEdit == 1)
      msgStr = this.msgRowUpdated;
    else
      msgStr = this.numCanEdit + this.msgRowsUpdated;
    if (this.numCannotEdit &gt; 0) {
      msgStr = msgStr + "&lt;br/&gt;";
      if (this.numCannotEdit == 1)
        msgStr += this.msgRowNotUpdated;
      else
        msgStr += this.numCannotEdit + this.msgRowsNotUpdated;
    }
    this.appendStatusPane(msgStr);
  },
  appendStatusPane: function(msgHtml) {
    var div = new Element('div');
    div.style.marginTop = 2;
    div.style.fontWeight = "normal";
    div.update(msgHtml);
    $(GwtListEditWindow.glideWindowId + "_header").appendChild(div);
    this.statusPane = div;
  },
  removeStatusPane: function() {
    if (!this.statusPane)
      return;
    this.statusPane.remove();
    this.statusPane = null;
  },
  truncateDisplayValue: function(dispValue) {
    var displayChars = new Number(this.editor.tableElement.getDisplayChars());
    if (!isNaN(displayChars) &amp;&amp; (displayChars != -1)) {
      if (dispValue.length &gt; displayChars)
        dispValue = dispValue.substring(0, displayChars) + "...";
    }
    return dispValue;
  },
  getCountCellsSelected: function() {
    var selected = this.gridEdit.getSelectedSysIds();
    var writeable = this.editor.getCanWriteIds();
    this.numCanEdit = writeable.length;
    this.numCannotEdit = selected.length - writeable.length;
  },
  _createControls: function() {
    $(this.window).observe("resize", this._onResize.bind(this));
    $(this.window).observe("keydown", this._onKeyDown.bind(this));
    this.removeBody();
    this.clearSpacing();
    this.addMandatoryDecorator();
    this.createOkCancel();
    this.setPreferredWidth();
    var parent = getFormContentParent();
    this.insert(parent, null, true);
    var ret = this.createEditControls();
    if (!(ret === false))
      this.createEditControlsComplete();
  },
  createEditControls: function() {
    this.setTitle("unimplemented abstract function createEditControls");
  },
  createEditControlsComplete: function() {
    if (this.state != 'initialize')
      return;
    var cursorCell = this.gridEdit.getCursorCell();
    if (cursorCell !== this.getAnchorCell()) {
      this.dismiss();
      this.gridEdit.editCursor();
      return;
    }
    this.editor.hideLoading();
    this.moveToCell();
    this._showUpdateMessage();
    this.visible();
    setTimeout(this.focusEditor.bind(this), 10);
    this.state = 'complete';
  },
  createTextInput: function() {
    var answer = new Element('input', {
      'id': GwtListEditWindow.inputID
    });
    if (this.doctype)
      answer.addClassName('form-control list-edit-input');
    if (!this.doctype)
      answer.setStyle({
        width: this.preferredWidth
      });
    this.focusElement = answer;
    return answer;
  },
  getText: function(t) {
    if (!t)
      return;
    if (t.innerText)
      return t.innerText;
    else
      return t.textContent;
  },
  moveToCell: function() {
    if (!this.container)
      return;
    var cell = this.getAnchorCell();
    this.container.style.top = this._getOffsetTop(cell) + 'px';
    this.container.style.left = this._getOffsetLeft(cell) + 'px';
  },
  _getOffsetLeftOverflow: function(cell, offset) {
    var formList = $j(cell).closest('div.custom-form-group');
    var offsetLeft = formList.length != 0 ? offset - formList.scrollLeft() : offset;
    return offsetLeft;
  },
  _getOffsetLeft: function(cell) {
    var offsetLeft = getOffset(cell, 'offsetLeft');
    var viewportLeft = cell.viewportOffset().left;
    var editorWidth = this.getWidth();
    offsetLeft = isDoctype() ? this._getOffsetLeftOverflow(cell, offsetLeft) : offsetLeft;
    if (document.viewport.getDimensions().width &gt;= (editorWidth + viewportLeft))
      return offsetLeft;
    var drawWidth = editorWidth + 2;
    if (drawWidth &lt;= cell.clientWidth)
      return offsetLeft;
    return offsetLeft + cell.clientWidth - drawWidth;
  },
  _getOffsetTop: function(cell) {
    var offsetTop = getOffset(cell, 'offsetTop');
    var viewportTop = cell.viewportOffset().top;
    var editorHeight = this.getHeight();
    if (document.viewport.getDimensions().height &gt;= (editorHeight + viewportTop))
      return offsetTop;
    var drawHeight = editorHeight + 2;
    if (drawHeight &lt;= cell.clientHeight)
      return offsetTop;
    return offsetTop + cell.clientHeight - drawHeight;
  },
  addMandatoryDecorator: function() {
    if (!this.editor.isMandatory())
      return
    var mandatory = cel('span');
    if (!this.doctype) {
      if (this.originalRenderValue != "")
        mandatory.className = 'mandatory_populated';
      else
        mandatory.className = 'mandatory';
    }
    if (this.doctype)
      mandatory.className = 'required-marker';
    mandatory.style.fontSize = '18px';
    mandatory.innerHTML = '&amp;nbsp;';
    this.addDecoration(mandatory, true);
  },
  createOkCancel: function() {
    var cancel = createImage('images/workflow_approval_rejected.gif', this.msgCancelButton, this, this.dismissEvent);
    if (this.doctype)
      cancel = createIcon('btn btn-icon icon-cross-circle color-red', this.msgCancelButton, this, this.dismissEvent);
    cancel.id = 'cell_edit_cancel';
    cancel.width = 18;
    cancel.height = 18;
    this.addDecoration(cancel);
    var save = createImage('images/workflow_approved.gifx', this.msgSaveButton, this, this.saveEvent);
    if (this.doctype)
      save = createIcon('btn btn-icon icon-check-circle color-green', this.msgSaveButton, this, this.saveEvent);
    save.id = 'cell_edit_ok';
    save.width = 18;
    save.height = 18;
    this.addDecoration(save);
  },
  saveAndClose: function(keyCallback, evt) {
    if (this.destroyed)
      return false;
    if (this.state != 'complete') {
      this.dismiss();
      return true;
    }
    var input = GwtListEditWindow.getCellEditValue();
    if (!input)
      input = $("LIST_EDIT_" + this.editor.name);
    var value = "";
    if (input) {
      value = input.value;
    }
    var isEmpty = false;
    if ((value.trim() == "") || (value == "NULL" &amp;&amp; this.editor.tableElement.isReference())) {
      isEmpty = true;
    }
    if (isEmpty &amp;&amp; this.editor.isMandatory()) {
      if (this.editor.tableElement.type !== 'glide_duration') {
        alert(getMessage('The following mandatory fields are not filled in') + ': ' + this.editor.tableElement.getLabel());
        this.focusEditor();
        return false;
      } else {
        var dur = {
          day: gel("dur_day"),
          hour: gel("dur_hour"),
          min: gel("dur_min"),
          sec: gel("dur_sec")
        };
        for (var prop in dur) {
          if (dur[prop] &amp;&amp; dur[prop].value.trim() === "") {
            alert(getMessage('The following mandatory fields are not filled in') + ': ' + this.editor.tableElement.getLabel());
            return false;
          }
        }
      }
    }
    var editControls = gel("editControls");
    var result = true;
    if (input)
      result = this.runScript(0, true, this.editor.fieldName, value, null, keyCallback, evt);
    else if (editControls)
      result = this.runScriptsForMultipleFields(0, editControls.getElementsByTagName("select"));
    else
      this._commitSave();
    return result === false ? false : true;
  },
  runScriptsForMultipleFields: function(index, choiceLists) {
    if (index &lt; choiceLists.length) {
      var element = choiceLists[index];
      var option = element.options[element.selectedIndex];
      var fName = element.name.substring(this.editor.table.length + 1);
      var thisObj = this;
      var saveCallback = function() {
        thisObj.runScriptsForMultipleFields(index + 1, choiceLists);
      }
      return this.runScript(0, true, fName, option.value, saveCallback);
    } else
      this._commitSave();
  },
  runScript: function(index, lastScriptResult, fieldName, newValue, saveCallback, keyCallback, evt) {
    var scripts = [];
    if (this.editor &amp;&amp; this.editor.table &amp;&amp; fieldName)
      scripts = g_event_handlers_onCellEdit[this.editor.table + "." + fieldName];
    if (!scripts || scripts.length == 0) {
      if (saveCallback)
        saveCallback();
      else
        this._commitSave();
      return;
    }
    if (!lastScriptResult) {
      this.dismiss();
      return;
    }
    if (index &lt; scripts.length) {
      var thisObj = this;
      var callback = function(result, doKeyEvent) {
        thisObj.runScript(index + 1, result, fieldName, newValue, saveCallback);
        if (doKeyEvent &amp;&amp; keyCallback != null &amp;&amp; evt != null) {
          keyCallback(evt);
        }
      };
      var sysIDs = this.gridEdit.getSelectedSysIds();
      var atts = this.gridEdit.getSelectedAttributes(sysIDs, fieldName);
      var result = scripts[index](sysIDs, this.editor.table, atts, newValue, callback);
      return result;
    }
    if (saveCallback)
      saveCallback();
    else
      this._commitSave();
    return true;
  },
  _commitSave: function() {
    this.state = 'saving';
    this.save();
    this.dismiss();
    if (this.editor)
      this.editor.saveValues();
    return;
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input)
      this.setValue(input.value);
  },
  setValue: function(value, displayValue) {
    if (!displayValue)
      displayValue = '';
    if (this.editor)
      this.editor.setValue(value, displayValue);
  },
  setRenderValue: function(value) {
    if (!value)
      value = '';
    if (this.editor)
      this.editor.setRenderValue(value);
  },
  focusEditor: function() {
    if (this.focusElement) {
      $(this.focusElement).activate();
    }
  },
  _onKeyDown: function(e) {
    switch (e.keyCode) {
      case Event.KEY_ESC:
        this.onKeyEsc(e);
        break;
      case Event.KEY_RETURN:
        this.onKeyReturn(e);
        break;
      case Event.KEY_TAB:
        this.onKeyTab(e);
        break;
    }
  },
  onKeyEsc: function(evt) {
    this.dismissEvent(evt);
  },
  onKeyReturn: function(evt) {
    evt.stop();
    if (this.saveAndClose())
      this._placeCursorReturn(evt);
  },
  onKeyTab: function(evt) {
    evt.stop();
    if (!this.saveAndClose(this._placeCursorTab.bind(this), evt))
      return;
    this._placeCursorTab(evt);
  },
  _placeCursorReturn: function(evt) {
    if (!evt.ctrlKey)
      this.gridEdit.refreshCursor();
    else
      this.gridEdit.editNextRow();
  },
  _placeCursorTab: function(evt) {
    if (evt.shiftKey)
      this.prevColumn();
    else
      this.nextColumn();
  },
  prevColumn: function() {
    this.gridEdit.moveLeft();
    this.gridEdit.editCursor();
  },
  nextColumn: function() {
    this.gridEdit.moveRight();
    this.gridEdit.editCursor();
  },
  dismiss: function() {
    if (this.destroyed)
      return false;
    this.destroyed = true;
    if (document.selection)
      document.selection.empty();
    try {
      this.destroy();
    } catch (e) {}
    this.state = 'destroyed';
    this.gridEdit.clearSelected();
    return false;
  },
  setPreferredWidth: function() {
    this.preferredWidth = this.getAnchorCell().clientWidth;
    if (this.preferredWidth &gt; 400)
      this.preferredWidth = 400;
    if (this.preferredWidth &lt; 150)
      this.preferredWidth = 150;
    this.setWidth(10);
  },
  _onResize: function(e) {
    if (this.destroyed)
      return;
    setTimeout(this.moveToCell.bind(this), 0);
  },
  _getMessages: function() {
    var gMessage = new GwtMessage();
    var map = gMessage.getMessages(this.MESSAGES);
    this.msgRowUpdated = map[this.MESSAGES[0]];
    this.msgRowsUpdated = map[this.MESSAGES[1]];
    this.msgRowNotUpdated = map[this.MESSAGES[2]];
    this.msgRowsNotUpdated = map[this.MESSAGES[3]];
    this.msgCancelButton = map[this.MESSAGES[4]];
    this.msgSaveButton = map[this.MESSAGES[5]];
  },
  getAnchorCell: function() {
    return this.gridEdit.getAnchorCell();
  },
  getAnchorSysId: function() {
    return this.gridEdit.getAnchorSysId();
  },
  dismissEvent: function(evt) {
    Event.stop(evt);
    this.dismiss();
    this.gridEdit.refreshCursor();
  },
  saveEvent: function(evt) {
    Event.stop(evt);
    if (this.saveAndClose())
      this.gridEdit.refreshCursor();
  },
  toString: function() {
    return "GwtListEditWindow";
  }
});
GwtListEditWindow.glideWindowId = 'cell_edit_window';
GwtListEditWindow.inputID = 'cell_edit_value';
GwtListEditWindow.getCellEditValue = function() {
  return $(GwtListEditWindow.inputID);
};
GwtListEditWindow.getCellEditWindow = function() {
  return $(GwtListEditWindow.glideWindowId);
};;
/*! RESOURCE: /scripts/GwtListEditSavePolicy.js */
var GwtListEditSavePolicy = Class.create({
  initialize: function(listId) {
    this.listId = listId;
  },
  analyzeEvent: function(evt) {
    return;
  },
  isDirectSave: function() {
    return false;
  },
  isDeferredSave: function() {
    return false;
  },
  isImpliedSave: function() {
    return false;
  },
  getDeferredSaves: function() {
    return [];
  },
  handleChangesSaved: function(evt) {},
  handleRowsDeleted: function(evt) {},
  getEdits: function(evt) {
    if ('glide:list_v2.edit.cells_changed' !== evt.eventName)
      return [];
    if (this.listId !== evt.memo.listId)
      return [];
    return evt.memo.edits;
  },
  getSaves: function(evt) {
    if ('glide:list_v2.edit.changes_saved' !== evt.eventName)
      return [];
    if (this.listId !== evt.memo.listId)
      return [];
    return evt.memo.saves;
  },
  getDeletes: function(evt) {
    if ('glide:list_v2.edit.rows_deleted' !== evt.eventName)
      return [];
    if (this.listId !== evt.memo.listId)
      return [];
    return evt.memo.deletes;
  },
  isSaveNow: function(evt) {
    if ('glide:list_v2.edit.save_now' !== evt.eventName)
      return false;
    return (this.listId === evt.memo.listId);
  },
  toString: function() {
    return 'GwtListEditSavePolicy';
  }
});
GwtListEditSavePolicy.CellEdit = Class.create(GwtListEditSavePolicy, {
  analyzeEvent: function(evt) {
    if (this.isSaveNow(evt))
      this.isSave = true;
    else if (this.getEdits(evt).length &gt; 0)
      this.isSave = true;
    else
      this.isSave = false;
  },
  isDirectSave: function() {
    return this.isSave;
  },
  toString: function() {
    return 'GwtListEditSavePolicy.CellEdit';
  }
});
GwtListEditSavePolicy.SaveWithForm = Class.create(GwtListEditSavePolicy, {
  initialize: function($super, listId) {
    $super(listId);
    this.defers = [];
  },
  analyzeEvent: function(evt) {
    this.defers = [];
    var edits = this.getEdits(evt);
    for (var i = 0; i &lt; edits.length; i++) {
      var edit = edits[i];
      var sysId = edit[0];
      g_form.fieldChanged(sysId + "_" + edit[1], true);
      if (this.defers.indexOf(sysId) &lt; 0)
        this.defers.push(sysId);
    }
  },
  isDeferredSave: function() {
    return (this.defers.length &gt; 0);
  },
  getDeferredSaves: function() {
    return this.defers;
  },
  handleChangesSaved: function(evt) {
    this.defers = [];
  },
  handleRowsDeleted: function(evt) {
    var deletes = this.getDeletes(evt);
    for (i = 0; i &lt; this.defers.length; i++) {
      var delSysId = this.defers[i];
      if (deletes.indexOf(delSysId) &gt;= 0) {
        this.defers.splice(i, 1);
        i--;
      }
    }
  },
  toString: function() {
    return 'GwtListEditSavePolicy.SaveWithForm';
  }
});
GwtListEditSavePolicy.SaveByRow = Class.create(GwtListEditSavePolicy, {
  initialize: function($super, tableController) {
    $super(tableController.listID);
    this.tableController = tableController;
    this.pendingSysId = null;
  },
  analyzeEvent: function(evt) {
    this.signalSave = (this.getEdits(evt).length &gt; 0);
    this.directSave = this._isSaveEdit(evt);
    this.impliedSave = this._isSaveMotion(evt);
  },
  isDirectSave: function() {
    return this.directSave;
  },
  isDeferredSave: function() {
    if (this.isDirectSave())
      return false;
    return this.signalSave;
  },
  isImpliedSave: function() {
    return this.impliedSave;
  },
  getDeferredSaves: function() {
    if (this.pendingSysId)
      return [this.pendingSysId];
    return [];
  },
  handleChangesSaved: function(evt) {
    var saves = this.getSaves(evt);
    if (saves.indexOf(this.pendingSysId) &gt;= 0)
      this._clearPendingSysId();
  },
  handleRowsDeleted: function(evt) {
    var deletes = this.getDeletes(evt);
    if (deletes.indexOf(this.pendingSysId) &gt;= 0)
      this._clearPendingSysId();
  },
  _clearPendingSysId: function() {
    this.pendingSysId = null;
    this.signalSave = false;
    this.directSave = false;
    this.impliedSave = false;
  },
  _isSaveEdit: function(evt) {
    if (this.isSaveNow(evt))
      return true;
    var edits = this.getEdits(evt);
    for (var i = 0; i &lt; edits.length; i++) {
      if (!this.pendingSysId)
        this.pendingSysId = edits[i][0];
      else if (this.pendingSysId !== edits[i][0])
        return true;
    }
    return false;
  },
  _isSaveMotion: function(evt) {
    if (!this.pendingSysId)
      return false;
    if (this._isSaveMove(evt))
      return true;
    if (this._isSaveClick(evt))
      return true;
    return false;
  },
  _isSaveMove: function(evt) {
    if (!evt.eventName)
      return false;
    if ('glide:list_v2.edit.focus_moved' !== evt.eventName)
      return false;
    if (!evt.memo)
      return true;
    if (evt.memo.listId !== this.listId)
      return false;
    var toRow = evt.memo.toRow;
    if (!toRow)
      return true;
    var moveSysId = this.tableController.getSysID(toRow);
    if (!moveSysId)
      return true;
    return moveSysId !== this.pendingSysId;
  },
  _isSaveClick: function(evt) {
    if ('click' !== evt.type)
      return false;
    var row = Event.findElement(evt, 'tr.list_row');
    if (!row || row === document)
      return true;
    var clickSysId = this.tableController.getSysID(row.rowIndex);
    if (!clickSysId)
      return true;
    return clickSysId !== this.pendingSysId;
  },
  toString: function() {
    return 'GwtListEditSavePolicy.SaveByRow';
  }
});;
/*! RESOURCE: /scripts/GwtListEditTableController.js */
var GwtListEditTableController = Class.create({
  MSGS: [
    'New rows'
  ],
  initialize: function(tableElementDOM) {
    this.tableElementDOM = $(tableElementDOM);
    this._initMeta();
    this._updateTableData();
    this.msgs = getMessages(this.MSGS);
  },
  isForTable: function(tableDOM) {
    return tableDOM === this.tableElementDOM;
  },
  removeExistingRow: function(sysId) {
    this.changes.remove(sysId);
  },
  addExistingRow: function(sysId) {
    if (!this.changes.has(sysId)) {
      var record = this.changes.addRecord(sysId, "add_existing");
      this.changes.addToAggregates(record);
    }
  },
  addRow: function(sysId) {
    if (!this.changes.has(sysId)) {
      var record = this.changes.addRecord(sysId, "add");
      this.changes.addToAggregates(record);
    }
  },
  updateTable: function(tableElementDOM) {
    var tableName = tableElementDOM.getAttribute('glide_table');
    if (tableName !== this.tableName)
      jslog("New table name " + tableName + " does not match existing table name " + this.tableName);
    this.tableElementDOM = $(tableElementDOM);
    this._updateTableData();
  },
  unLoadTable: function(tableElementDOM) {
    if (tableElementDOM !== this.tableElementDOM)
      jslog("Unloaded table does not match current table " + this.tableName);
  },
  exportXml: function(elem) {
    elem.setAttribute("table", this.tableName);
    elem.setAttribute("field", this.relatedField);
    elem.setAttribute("query", this.query);
  },
  _initMeta: function() {
    this.tableName = this.getAttribute('glide_table');
    this.listID = this.getAttribute('glide_list_edit_id') + '';
    if (!GwtListEditTableController.controllers)
      GwtListEditTableController.controllers = {};
    GwtListEditTableController.controllers[this.listID] = this;
    this.listEditType = this.getAttribute('glide_list_edit_type') + '';
    this.relatedField = this.getAttribute('glide_list_field') + '';
    this.query = this.getAttribute('glide_list_query') + '';
    this.rowCount = new Number(this.getAttribute('total_rows'));
    this.insertRow = this._getBooleanAttribute('glide_list_edit_insert_row');
    this.canCreate = this._getBooleanAttribute('glide_list_can_create');
    this.canDelete = this._getBooleanAttribute('glide_list_can_delete');
    this.hasHierarchy = this._getBooleanAttribute('glide_list_has_hierarchy');
    this.hasHeader = this._getBooleanAttribute('glide_list_has_header');
    this.omitLinks = this._getBooleanAttribute('glide_list_omit_links');
    this.hasActions = this.getAttribute('glide_list_has_actions') == 'false' ? false : true;
    this.groupFields = this._getGroupFields();
    if (this.rowCount == 0 &amp;&amp; "save_with_form" == this.listEditType &amp;&amp; !this.hasHeader)
      this.insertRow = false;
    var prefixLength = this.tableName.length + 1;
    this.fields = [];
    this.firstField = null;
    var cellIndexOffset = this._getHeaderOffset();
    var cells = [];
    if (this.tableElementDOM &amp;&amp; this.tableElementDOM.rows &amp;&amp; this.tableElementDOM.rows.length &gt; 0 &amp;&amp; this.tableElementDOM.rows[0].cells) {
      cells = this.tableElementDOM.rows[0].cells;
    }
    this.headers = [];
    this.headersByName = {};
    for (var i = 0; i &lt; cells.length; i++) {
      var cell = cells[i];
      if (hasClassName(cell, "column_head") || hasClassName(cell, "list_header_cell")) {
        var fieldName = cell.getAttribute('glide_field');
        var type = cell.getAttribute('glide_type');
        if (type == 'composite_field') {
          var compositeField = cell.getAttribute('name');
          var compositeFirstField = cell.getAttribute('composite_edit_field');
          var fieldPos = i + cellIndexOffset;
          fieldName = this.getFqFieldName(compositeFirstField);
          cell.setAttribute('glide_field', fieldName);
          if (window['GlideCompositeField'])
            new GlideCompositeField(this, fieldPos, compositeField, compositeFirstField);
        }
        if (fieldName) {
          this.fields.push(fieldName.substring(prefixLength));
          this.headers[i + cellIndexOffset] = fieldName;
          this.headersByName[fieldName] = i + cellIndexOffset;
          if (!this.firstField)
            this.firstField = fieldName;
        }
      }
    }
  },
  _getHeaderOffset: function() {
    return 0;
  },
  _updateTableData: function() {
    this._updateSysIdToRowMapping();
    this._configureFocus();
    this.observe('glide:list_v2.edit.changes_saved', this._handleChangesSaved.bind(this));
    this.groupSeparator = null;
  },
  _updateSysIdToRowMapping: function() {
    var rows = this.tableElementDOM.rows;
    this.listRows = [];
    for (var i = 0, n = rows.length; i &lt; n; i++) {
      var row = rows[i];
      if (!hasClassName(row, 'list_row') &amp;&amp; !hasClassName(row, 'list_row_detail'))
        continue;
      this.listRows.push(row);
    }
    this.lastRecordRow = 0;
    this.sysIds = [];
    this.sysIdsToRows = {};
    var rowCount = this.getRowCount();
    for (var i = 0; i &lt; rowCount; i++) {
      var sysId = this.getSysID(i);
      if (sysId) {
        if (this.sysIdsToRows.hasOwnProperty(sysId))
          continue;
        this.sysIdsToRows[sysId] = i;
        this.sysIds.push(sysId);
        this.lastRecordRow = i;
      }
    }
  },
  buildCellSelector: function() {
    return new GwtListEditGridSelector(this.tableElementDOM);
  },
  getAttribute: function(name) {
    return this.tableElementDOM.getAttribute(name);
  },
  _configureFocus: function() {
    this.tableElementDOM.writeAttribute("tabIndex", "0");
    this.tableElementDOM.setStyle({
      outline: "none"
    });
    this.tableElementDOM.hideFocus = true;
  },
  _getBooleanAttribute: function(attrName) {
    return "true" === this.getAttribute(attrName);
  },
  getFields: function() {
    return this.fields;
  },
  getNameFromColumn: function(colNdx) {
    return this.headers[colNdx];
  },
  getCell: function(sysId, fieldName) {
    return this.getFqField(sysId, this.getFqFieldName(fieldName));
  },
  getFqFieldName: function(fieldName) {
    return this.tableName + "." + fieldName;
  },
  getFqField: function(sysId, fqFieldName) {
    var col = this.headersByName[fqFieldName];
    if (!col) {
      var row = this.tableElementDOM.select('tr[data-detail-row=' + fqFieldName + '][sys_id=' + sysId + ']');
      if (row.length &gt; 0)
        return $(row[0].cells[0]);
      return null;
    }
    var row = this.getRow(sysId);
    if (!row)
      return null;
    return $(row.cells[col]);
  },
  getRowCount: function() {
    return this.tableElementDOM.rows.length;
  },
  getRow: function(sysId) {
    var rowNdx = this.sysIdsToRows[sysId];
    if (!rowNdx)
      return null;
    return this.getRowByNdx(rowNdx);
  },
  getRowByNdx: function(rowNdx) {
    return this.tableElementDOM.rows[rowNdx];
  },
  getCellByNdx: function(rowNdx, cellNdx) {
    var row = this.getRowByNdx(rowNdx);
    if (!row)
      return null;
    return $(row.cells[cellNdx]);
  },
  getSysID: function(rowNdx) {
    var row = this.getRowByNdx(rowNdx);
    if (!row)
      return null;
    return row.getAttribute('sys_id');
  },
  getRelatedSysID: function() {
    if (!this.relatedField || this.relatedField == "null")
      return null;
    var indexOfSysId = this.query.indexOf(this.relatedField + "=") + this.relatedField.length + 1;
    return this.query.substring(indexOfSysId, indexOfSysId + 32);
  },
  _insertFinalBodyRow: function() {
    var body = this.tableElementDOM.tBodies[0];
    var result = body.insertRow(this._getInsertRow(body));
    return $(result);
  },
  _getInsertRow: function(body) {
    var rows = body.rows;
    for (var i = rows.length; i &gt; 0; i--) {
      var row = $(rows[i - 1]);
      if (row.hasClassName('aggregate'))
        continue;
      var aggMsg = row.down('td.aggregate_message');
      if (aggMsg)
        continue;
      if (row.hasClassName('calculationLine'))
        return i - 1;
      return i;
    }
    return 0;
  },
  _getRowCss: function(tr) {
    if (this.listEditType != "save_with_form")
      return "list_unsaved";
    if ((tr.rowIndex % 2) == 0)
      return "list_even";
    return "list_odd";
  },
  deleteRow: function(sysId) {
    var rowNdx = this.sysIdsToRows[sysId];
    this.tableElementDOM.deleteRow(rowNdx);
    this._updateSysIdToRowMapping();
  },
  isHierarchical: function() {
    return this.tableElementDOM.hasClassName("hierarchical");
  },
  getListRows: function() {
    return this.listRows;
  },
  getRowByCell: function(cell) {
    return $(cell).up('tr.list_row, tr.list_row_detail');
  },
  getSysIdByCell: function(cell) {
    return this.getRowByCell(cell).getAttribute('sys_id');
  },
  buildRow: function(sysId) {
    var row = this.getRowByNdx(this.lastRecordRow);
    var cellCnt = 0;
    for (var i = 0; i &lt; row.cells.length; i++)
      cellCnt += row.cells[i].colSpan;
    this._ensureGroupSeparator(sysId);
    var tr = this._insertFinalBodyRow();
    tr.id = sysId;
    tr.setAttribute('sys_id', sysId);
    tr.setAttribute('record_class', this.tableName);
    addClassName(tr, this._getRowCss(tr));
    addClassName(tr, 'list_row');
    var decor = this._buildDecorationCell(tr);
    for (var i = 1; i &lt; cellCnt; i++) {
      var td = tr.insertCell(i);
      td.innerHTML = "&amp;nbsp;";
      var fname = this.getNameFromColumn(i);
      if (fname) {
        addClassName(td, "vt");
      }
    }
    if (this.lastRecordRow == 0) {
      var tdExtra = $(tr.insertCell(i));
      tdExtra.writeAttribute('class', 'vt');
      tdExtra.writeAttribute('style', 'padding: 0;');
    }
    GwtListEditTableController.addClassToRow(tr, "list_add");
    this._updateSysIdToRowMapping();
    if (this.hasShowableHierarchy())
      this._buildHierarchyRow(sysId);
    return row;
  },
  _buildDecorationCell: function(tr) {
    var td = $(tr.insertCell(0));
    td.writeAttribute('class', 'list_decoration_cell');
    if (!this._isDoctype()) {
      var style = 'padding-top: 3px; padding-bottom: 3px;';
      if (this._isGrouped() &amp;&amp; this.hasHierarchy)
        style = 'padding-left: 20px;' + style;
      else
        style = 'padding-left: 2px;' + style;
      td.writeAttribute('style', style);
    } else {
      td.className += ' col-control col-small col-center';
    }
    if (!this._isDoctype())
      return td;
  },
  _isDoctype: function() {
    return document.documentElement.getAttribute('data-doctype') == 'true';
  },
  _buildHierarchyRow: function(sysId) {
    var tr = this._insertFinalBodyRow();
    tr.setAttribute('hierarchical', 'not_loaded');
    tr.setAttribute('style', 'display: none');
    tr.setAttribute('collapsed', 'true');
    tr.setAttribute('id', 'hier_row_' + this.listID + '_' + sysId);
    var td = tr.insertCell(0);
    td.setAttribute('colspan', '99');
    addClassName(td, 'list_hierarchical_hdr');
    return tr;
  },
  needsInsertRow: function() {
    if (this.tableElementDOM.select(".list_unsaved") != 0)
      return false;
    if (this.tableElementDOM.select(".list_edit_new_row") != 0)
      return false;
    if (typeof isTablet != 'undefined' &amp;&amp; isTablet)
      return false;
    return this.insertRow;
  },
  fire: function(evt, info) {
    if (!info.listId)
      jslog('Event ' + evt + ' fired with no listId');
    if (info.listId !== this.listID)
      jslog('Event ' + evt + ' fired for unknown list ' + info.listId);
    this.tableElementDOM.fire(evt, info);
  },
  fireCellsChanged: function(edits) {
    var info = {
      listId: this.listID,
      edits: edits
    };
    this.fire('glide:list_v2.edit.cells_changed', info);
  },
  fireFocusMoved: function(toRow, toCol) {
    var info = {
      listId: this.listID,
      toRow: toRow,
      toCol: toCol
    };
    this.fire('glide:list_v2.edit.focus_moved', info);
  },
  observe: function(evt, callback) {
    this.tableElementDOM.observe(evt, callback);
  },
  observeOnBody: function(evt, callback) {
    this.tableElementDOM.down('tbody').observe(evt, callback);
  },
  stopObserving: function(evt, callback) {
    this.tableElementDOM.stopObserving(evt, callback);
  },
  stopObservingOnBody: function(evt, callback) {
    this.tableElementDOM.down('tbody').stopObserving(evt, callback);
  },
  hasDeferredChanges: function() {
    if ('save_with_form' === this.listEditType)
      return true;
    if ('save_by_row' === this.listEditType)
      return true;
    return false;
  },
  isFormUI: function() {
    if ('save_with_form' === this.listEditType)
      return true;
    return false;
  },
  canEdit: function() {
    return ('disabled' !== this.listEditType);
  },
  buildSavePolicy: function(type) {
    if ("save_with_form" === this.listEditType)
      return new GwtListEditSavePolicy.SaveWithForm(this.listID);
    if ("save_by_row" === this.listEditType)
      return new GwtListEditSavePolicy.SaveByRow(this);
    return new GwtListEditSavePolicy.CellEdit(this.listID);
  },
  focus: function() {
    if (this.tableElementDOM.setActive)
      this.tableElementDOM.setActive();
    else
      this.tableElementDOM.focus();
  },
  focusBody: function() {
    var el = this.tableElementDOM.down('tbody');
    if (el.setActive)
      el.setActive();
    else
      el.focus();
  },
  getDecorationCell: function(sysId) {
    var row = this.getRow(sysId);
    if (!row)
      return null;
    return row.cells[0];
  },
  _handleChangesSaved: function(evt) {
    if (evt.memo.listId !== this.listID)
      return;
    if (!this.insertRow)
      return;
    if ("save_with_form" === this.listEditType)
      return;
    if (this.needsInsertRow &amp;&amp; (this.listRows.length === 1))
      this._showListActions();
    else if (this.listRows.length === 2) {
      this._showListActions();
    }
  },
  _showListActions: function() {
    var container = $(this.listID + '_expanded');
    if (!container)
      return;
    var navTables = container.select('table.list_nav_bottom');
    if (1 !== navTables.length)
      return;
    var spans = navTables[0].select('span.list_hide_empty');
    for (var i = 0; i &lt; spans.length; i++) {
      spans[i].show();
    }
  },
  getRecordPos: function(row) {
    return this.getListRows().indexOf(row) + 1;
  },
  getRecordIndex: function(recPos) {
    var rows = this.getListRows();
    var extra = recPos - rows.length
    if (rows.length &gt; 0 &amp;&amp; extra &gt; 0) {
      var lastNdx = rows[rows.length - 1].rowIndex;
      if (this.hasHierarchy)
        return lastNdx + extra + extra;
      return lastNdx + extra;
    }
    var row = this.getRowByPos(recPos);
    if (row)
      return row.rowIndex;
    return 0;
  },
  getRowByPos: function(recPos) {
    if (recPos &lt; 1)
      return null;
    var rows = this.getListRows();
    if (recPos &gt; rows.length)
      return null;
    return rows[recPos - 1];
  },
  getCellByPos: function(recPos, cellNdx) {
    var row = this.getRowByPos(recPos);
    if (!row)
      return null;
    if (hasClassName(row, 'list_row_detail'))
      return $(row.cells[0]);
    return $(row.cells[cellNdx]);
  },
  getSysIDByPos: function(recPos) {
    var row = this.getRowByPos(recPos);
    if (!row)
      return null;
    return row.getAttribute('sys_id');
  },
  getFieldElement: function(fieldName) {
    return TableElement.get(this.getFqFieldName(fieldName));
  },
  isFirstField: function(fieldName) {
    var fqFieldName = this.getFqFieldName(fieldName);
    return this.firstField === fqFieldName;
  },
  _getGroupFields: function() {
    var GROUP_BY = "GROUPBY";
    var groupBy = [];
    var query = this.getAttribute('glide_list_query') + '';
    var terms = query.split('^');
    for (var i = 0; i &lt; terms.length; i++) {
      var term = terms[i];
      if (0 === term.indexOf(GROUP_BY))
        groupBy.push(term.substring(GROUP_BY.length));
    }
    if (0 === groupBy.length)
      return null;
    return groupBy.join(',');
  },
  _isGrouped: function() {
    return (null !== this.groupFields);
  },
  _ensureGroupSeparator: function(sysId) {
    if (!this._isGrouped())
      return;
    if (null !== this.groupSeparator)
      return;
    this.groupSeparator = this._buildGroupSeparator(sysId);
  },
  _buildGroupSeparator: function(sysId) {
    var tr = this._insertFinalBodyRow();
    addClassName(tr, 'list_group');
    tr.setAttribute('group_row', 'true');
    tr.setAttribute('collapsed', 'never');
    tr.setAttribute('id', 'row_' + this.listID + '_' + sysId);
    tr.setAttribute('groupfield', this.groupFields);
    var td = $(tr.insertCell(0));
    addClassName(td, 'list_group');
    td.setAttribute('colSpan', '99');
    td.setAttribute('group_row_td', 'true');
    td.setAttribute('style', 'page-break-before: auto;');
    var o = {
      newRows: this.msgs['New rows']
    };
    td.insert(GwtListEditTableController.Templates.NEW_ROWS.evaluate(o));
    return tr;
  },
  hasShowableHierarchy: function() {
    if (this._isGrouped())
      return false;
    return this.hasHierarchy;
  },
  getNextRowByPos: function(fromPos) {
    var limit = this.getListRows().length;
    var ndx = fromPos + 1;
    while (ndx &lt;= limit) {
      var row = this.getRowByPos(ndx);
      if (row &amp;&amp; row.style.display != 'none')
        return ndx;
      ndx++;
    }
    return null;
  },
  getPrevRowByPos: function(fromPos) {
    var ndx = fromPos - 1;
    while (ndx &gt; 0) {
      var row = this.getRowByPos(ndx);
      if (row &amp;&amp; row.style.display != 'none')
        return ndx;
      ndx--;
    }
    return null;
  },
  toString: function() {
    return 'GwtListEditTableController';
  }
});
GwtListEditTableController.showImage = function(element, imageSrc) {
  var left = getOffset(element, "offsetLeft");
  var top = getOffset(element, "offsetTop");
  var w = element.offsetWidth;
  var h = element.offsetHeight;
  left += w - 11;
  top += h - 11;
  var img = cel('img');
  img.src = imageSrc;
  img.alt = '';
  img.style.position = 'absolute';
  img.style.left = left + 'px';
  img.style.top = top + 'px';
  addChild(img);
  return img;
};
GwtListEditTableController.addClassToRow = function(tr, className) {
  addClassName(tr, className);
  var cells = tr.cells;
  for (var i = 1; i &lt; cells.length; i++)
    addClassName(cells[i], className);
};
GwtListEditTableController.removeClassFromRow = function(tr, className) {
  removeClassName(tr, className);
  var cells = tr.cells;
  for (var i = 0; i &lt; cells.length; i++)
    removeClassName(cells[i], className);
};
GwtListEditTableController.Templates = {
  NEW_ROWS: new Template(
    '&lt;span class="list_group"&gt;#{newRows}&lt;/span&gt;'
  )
};;
/*! RESOURCE: /scripts/GwtListEditorPendingChanges.js */
var GwtListEditorPendingChanges = Class.create({
  initialize: function(tableController) {
    this.aggregates = new GlideListAggregates(tableController);
    this.valueLoader = new GwtListEditAjaxValueLoader(this, tableController);
    this.modifiedRecords = {};
    this.emptyRecord = null;
  },
  get: function(sysId) {
    if (this.isEmptyRecord(sysId))
      return this.emptyRecord;
    return this.modifiedRecords[sysId];
  },
  getModifiedRecords: function() {
    return this.modifiedRecords;
  },
  put: function(sysId, record) {
    this.modifiedRecords[sysId] = record;
  },
  has: function(sysId) {
    return this.modifiedRecords[sysId] != null;
  },
  addRecord: function(sysId, operation) {
    var record = new GwtListEditRecord(sysId);
    if (operation)
      record.setOperation(operation);
    this.put(sysId, record);
    return record;
  },
  addEmptyRecord: function(sysId) {
    this.saveEmptyRecord();
    this.emptyRecord = new GwtListEditRecord(sysId);
    this.emptyRecord.setOperation("new");
    return this.emptyRecord;
  },
  addField: function(sysId, fieldName, value) {
    var record = this.get(sysId);
    var field = record.addField(fieldName);
    field.setValue(value);
  },
  saveEmptyRecord: function() {
    var result = this.emptyRecord;
    if (result) {
      result.setOperation("add");
      this.modifiedRecords[this.emptyRecord.sysId] = result;
    }
    this.emptyRecord = null;
    return result;
  },
  isEmptyRecord: function(sysId) {
    return this.emptyRecord &amp;&amp; this.emptyRecord.sysId == sysId;
  },
  getValue: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return "";
    return field.getValue();
  },
  setValue: function(sysId, fieldName, value, notify) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return null;
    var oldValue = field.getValue();
    notify(sysId, fieldName, oldValue, value);
    field.setValue(value);
    this.aggregates.updateAggregates(fieldName, oldValue, value);
    return field;
  },
  setDisplayValue: function(sysId, fieldName, value, notify) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return null;
    var oldValue = field.getDisplayValue();
    notify(sysId, fieldName, oldValue, value);
    field.setDisplayValue(value);
    this.aggregates.updateAggregates(fieldName, oldValue, value);
    return field;
  },
  setReferenceValid: function(sysId, fieldName, valid) {
    var field = this.getField(sysId, fieldName);
    if (field)
      field.setReferenceValid(valid);
  },
  isReferenceValid: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (field)
      return field.isReferenceValid();
    return true;
  },
  getDisplayValue: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return "";
    return field.getDisplayValue();
  },
  getRenderValue: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return "";
    return field.getRenderValue();
  },
  getRecordOperation: function(sysId) {
    var r = this.get(sysId);
    if (r)
      return r.operation;
    return '';
  },
  setRecordOperation: function(sysId, operation) {
    var r = this.get(sysId);
    if (r)
      r.operation = operation;
  },
  getField: function(sysId, field) {
    var r = this.get(sysId);
    if (!r)
      return null;
    return r.getField(field);
  },
  getFieldDefaults: function() {
    var defaults = this.getDefaults();
    if (!defaults)
      return {};
    return defaults.getFields();
  },
  setDefaults: function(record) {
    var fields = this.getFieldDefaults();
    for (var n in fields) {
      var defaultField = fields[n];
      var f = record.addField(n);
      f.setInitialValues(defaultField.getValue(), defaultField.getDisplayValue());
      f.setWritable(defaultField.isWritable());
      f.setMandatory(defaultField.isMandatory());
      f.setOKExtension(defaultField.isOKExtension());
      f.setLabel(defaultField.getLabel());
    }
  },
  setRenderValue: function(sysId, fieldName, value) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return null;
    field.setRenderValue(value);
    return field;
  },
  isFieldDirty: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return false;
    return field.isModified();
  },
  isValueSet: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (!field)
      return false;
    return field.isValueSet();
  },
  getDefaults: function() {
    return this.modifiedRecords["-1"];
  },
  getDeletedRowCount: function() {
    var count = 0;
    for (var id in this.modifiedRecords) {
      var record = this.modifiedRecords[id];
      if (record.isDeleted())
        count++;
    }
    return count;
  },
  getAddedRowCount: function() {
    var count = 0;
    for (var id in this.modifiedRecords) {
      var record = this.modifiedRecords[id];
      if (record.isAdded())
        count++;
    }
    return count;
  },
  canWriteToFields: function(id, fields) {
    var record = this.get(id);
    if (!record)
      return false;
    var canWrite = true;
    for (var j = 0; j &lt; fields.length; j++) {
      var field = record.getField(fields[j]);
      if (!field)
        continue;
      if (!field.canWrite) {
        canWrite = false;
        break;
      }
    }
    return canWrite;
  },
  clearDefaults: function() {
    delete this.modifiedRecords["-1"];
  },
  clearModified: function(sysId) {
    if (!this.get(sysId))
      return;
    this.get(sysId).clearModified();
  },
  clearAllModified: function() {
    for (var id in this.changes)
      this.clearModified(id);
  },
  remove: function(sysId) {
    if (this.modifiedRecords[sysId])
      delete this.modifiedRecords[sysId];
  },
  removeAll: function() {
    for (var i in this.modifiedRecords)
      if (i != -1)
        this.remove(i);
  },
  getValueToRender: function(sysId, fieldName) {
    var field = this.getField(sysId, fieldName);
    if (!field || (this.emptyRecord &amp;&amp; sysId == this.emptyRecord.sysId))
      return '';
    if (field.isRenderValueSet())
      return field.getRenderValue();
    if (field.isDisplayValueSet())
      return field.getDisplayValue();
    if (field.isValueSet())
      return field.getValue();
    if (field.getRenderValue())
      return field.getRenderValue();
    if (field.getDisplayValue())
      return field.getDisplayValue();
    return field.getValue();
  },
  exportRecords: function(receiver) {
    for (var id in this.modifiedRecords) {
      var record = this.get(id);
      receiver.changedRecord(id, record);
    }
  },
  exportChanges: function(receiver) {
    var exporter = new GwtListEditorPendingChanges.ChangeExporter(receiver);
    this.exportRecords(exporter);
  },
  inspectRecords: function(receiver) {
    for (var id in this.modifiedRecords) {
      if (receiver.isDone())
        return;
      var record = this.get(id);
      receiver.changedRecord(id, record);
    }
  },
  getAggregateValue: function(fieldName, type) {
    this.aggregates.getAggregateValue(fieldName, type);
  },
  getAggregateFields: function() {
    return this.aggregates.getAggregateFields();
  },
  addToAggregates: function(record) {
    var fields = record.getFields();
    for (var n in fields) {
      var field = fields[n];
      var value = field.getValue();
      if (field.isDisplayValueSet())
        value = field.getDisplayValue();
      this.aggregates.addToAggregates(n, value);
    }
  },
  removeFromAggregates: function(record) {
    var fields = record.getFields();
    for (var n in fields) {
      var field = fields[n];
      var value = field.getValue();
      if (field.isDisplayValueSet())
        value = field.getDisplayValue();
      this.aggregates.removeFromAggregates(n, value);
    }
  },
  updateAggregates: function(n, originalValue, value) {
    this.aggregates.updateAggregates(n, originalValue, value);
  },
  rowCountChanged: function(value) {
    this.aggregates.rowCountChanged(value);
  },
  resetAggregates: function() {
    this.aggregates.resetAggregates();
  },
  calcWritableSysIds: function(sysIds, securityFields) {
    var writableSysIds = [];
    for (var i = 0; i &lt; sysIds.length; i++) {
      var sysId = sysIds[i];
      if (this.canWriteToFields(sysId, securityFields))
        writableSysIds.push(sysId);
    }
    return writableSysIds;
  },
  isDeletedRow: function(sysId) {
    var record = this.get(sysId);
    if (!record)
      return false;
    return record.isDeleted();
  },
  isUpdatedRow: function(sysId) {
    var record = this.get(sysId);
    if (!record)
      return false;
    return record.isUpdated();
  },
  isAddedRow: function(sysId) {
    var record = this.get(sysId);
    if (!record)
      return false;
    return record.isAdded();
  },
  loadValues: function(sysIds, fields, callback) {
    this.valueLoader.loadValues(sysIds, fields, callback);
  },
  loadDefaults: function(callback) {
    this.valueLoader.loadDefaults(callback);
  },
  loadTable: function(callback) {
    this.valueLoader.loadTable(callback);
  },
  getLoaderErrorMsg: function() {
    return this.valueLoader.getErrorMsg();
  },
  toString: function() {
    return 'GwtListEditorPendingChanges';
  }
});
GwtListEditorPendingChanges.RecordReceiver = Class.create({
  changedRecord: function(sysID, record) {},
  toString: function() {
    return 'GwtListEditorPendingChanges.RecordReceiver';
  }
});
GwtListEditorPendingChanges.RecordInspector = Class.create(
  GwtListEditorPendingChanges.RecordReceiver, {
    isDone: function() {
      return false;
    },
    toString: function() {
      return 'GwtListEditorPendingChanges.RecordReceiver';
    }
  });
GwtListEditorPendingChanges.ChangeExporter = Class.create(
  GwtListEditorPendingChanges.RecordReceiver, {
    initialize: function($super, receiver) {
      $super();
      this.receiver = receiver;
    },
    changedRecord: function(sysID, record) {
      if (record.isDefaultValues())
        return;
      if (record.isNew())
        return;
      if (this.receiver.beginRecord(sysID, record.operation)) {
        var fields = record.getFields();
        for (var fieldName in fields) {
          var field = fields[fieldName];
          this.receiver.changedField(sysID, field)
        }
      }
      this.receiver.endRecord(sysID);
    },
    toString: function() {
      return 'GwtListEditorPendingChanges.ChangeExporter';
    }
  });
GwtListEditorPendingChanges.ChangeReceiver = Class.create({
  beginRecord: function(sysID, op) {
    return true;
  },
  endRecord: function(sysID) {},
  changedField: function(sysID, field) {},
  toString: function() {
    return 'GwtListEditorPendingChanges.ChangeReceiver';
  }
});
GwtListEditorPendingChanges.ComposableChangeReceiver = Class.create(
  GwtListEditorPendingChanges.ChangeReceiver, {
    initialize: function($super) {
      $super();
      this.receivers = [];
    },
    addReceiver: function(receiver) {
      this.receivers.push(receiver);
    },
    beginRecord: function(sysID, op) {
      for (i = 0; i &lt; this.receivers.length; i++) {
        var result = this.receivers[i].beginRecord(sysID, op);
        if (!result) {
          this.limit = i + 1;
          return false;
        }
      }
      this.limit = this.receivers.length;
      return true;
    },
    endRecord: function(sysID) {
      for (i = 0; i &lt; this.limit; i++)
        this.receivers[i].endRecord(sysID);
    },
    changedField: function(sysID, field) {
      for (i = 0; i &lt; this.limit; i++)
        this.receivers[i].changedField(sysID, field);
    },
    toString: function() {
      return 'GwtListEditorPendingChanges.ComposableChangeReceiver';
    }
  });;
/*! RESOURCE: /scripts/GwtListEditText.js */
var GwtListEditText = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var input = this.createTextInput();
    input.value = this.editor.getValue();
    var tableElement = this.editor.tableElement;
    if (tableElement.maxLength &gt; 0)
      input.setAttribute("maxLength", tableElement.maxLength);
    var answer = this.editor.getValue();
    if (tableElement.isNumber()) {
      input.value = this.editor.getDisplayValue();
      input.className = this.doctype ? 'decimal form-control list-edit-input' : 'decimal';
      answer = this.editor.getDisplayValue();
    }
    this.setTitle(input);
    answer = answer.replace(/\n/g, " ");
    answer = answer.replace(/\t/g, "");
    this.focusElement.value = answer;
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input) {
      if (this.editor.tableElement.isNumber() || this.editor.tableElement.getType() == "translated_text")
        this.setValue(null, input.value);
      else
        this.setValue(input.value);
      this.setRenderValue(this.truncateDisplayValue(input.value));
    }
  },
  toString: function() {
    return "GwtListEditText";
  }
});;
/*! RESOURCE: /scripts/GwtListEditSelect.js */
var GwtListEditSelect = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var select = '';
    if (this.doctype)
      select = "&lt;select id = '" + GwtListEditWindow.inputID + "' class='form-control list-edit-input' /&gt;";
    else
      select = "&lt;select id = '" + GwtListEditWindow.inputID + "' /&gt;";
    this.setTitle(select);
    this.focusElement = GwtListEditWindow.getCellEditValue();
    this.addOptions();
    if (!this.staticOptions)
      return false;
  },
  addOptions: function() {
    var rowSysId = this.getAnchorSysId();
    var allIDs = this.gridEdit.getSelectedSysIds();
    var ajax = new GlideAjax('PickList');
    ajax.addParam('sys_uniqueValue', rowSysId);
    ajax.addParam('sysparm_id_list', allIDs.join());
    ajax.addParam('sysparm_target', this.editor.tableElement.getTable().getName());
    ajax.addParam('sysparm_chars', '*');
    ajax.addParam('sysparm_name', this.refName);
    ajax.addParam('sysparm_nomax', 'true');
    ajax.getXML(this._createOptions.bind(this));
  },
  _createOptions: function(response) {
    if (this.state != 'initialize')
      return;
    var xml = response.responseXML;
    var items = xml.getElementsByTagName("item");
    var value = this.editor.getValue();
    this.focusElement.options.length = 0;
    if (this.editor.tableElement.choice != "3") {
      this.nullOverride = xml.documentElement.getAttribute("default_option");
      if (this.nullOverride)
        addOption(this.focusElement, "", this.nullOverride, this._isSelected(value, "", this.nullOverride));
      else if (!this.editor.selectedOnly)
        addOption(this.focusElement, "", getMessage('-- None --'), true);
    }
    for (var i = 0; i &lt; items.length; i++) {
      var v = items[i].getAttribute("value");
      var l = items[i].getAttribute("label");
      if (!this._checkDuplicateOptions(v, l))
        addOption(this.focusElement, v, l, this._isSelected(value, v, l));
    }
    this.createEditControlsComplete();
  },
  _checkDuplicateOptions: function(value, label) {
    if (!this.focusElement.length)
      return false;
    var opts = this.focusElement.options;
    for (var i = 0; i &lt; opts.length; i++)
      if (opts[i].value == value &amp;&amp; opts[i].text === label)
        return true;
    return false;
  },
  _isSelected: function(value, v, l) {
    if (l == value || v == value)
      return true;
    else
      return false;
  },
  save: function() {
    var select = this.focusElement;
    var i = select.selectedIndex;
    var option = select.options[i];
    this.setValue(option.value);
    var text = option.text;
    if (!option.value)
      text = '';
    this.setRenderValue(text);
  },
  toString: function() {
    return "GwtListEditSelect";
  }
});;
/*! RESOURCE: /scripts/doctype/GwtListEditCalendar.js */
var GwtListEditCalendar = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    ScriptLoader.getScripts('scripts/classes/GwtDateTimePicker.js', this._start.bind(this));
    return false;
  },
  _start: function() {
    var html = this._createCalendarHTML();
    this.setTitle(html);
    if (g_full_calendar_edit)
      $('cell_edit_window').addClassName('hide_input_edit');
    this.createEditControlsComplete();
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input) {
      this.setValue(null, input.value);
      this.setRenderValue(input.value);
    }
  },
  dismiss: function($super) {
    this._dismissCalendar();
    if (GwtListEditWindow.inputID) {
      var input = GwtListEditWindow.getCellEditValue();
      if (input)
        input.onfocus = null;
    }
    $super();
  },
  _dismissCalendar: function() {
    if (gel("GwtDateTimePicker") &amp;&amp; this.cal)
      this.cal.dismiss();
    this.cal = null;
  },
  _createCalendarHTML: function() {
    var answer = cel('div');
    var input = this.createTextInput();
    input.value = this.editor.getDisplayValue();
    answer.style.borderSpacing = '0';
    answer.className = 'input-group';
    answer.appendChild(input);
    input.onfocus = this.onFocus.bind(this);
    var img = createIcon('icon-calendar', getMessage("Choose date..."), this, this._showCalendar.bind(this));
    img.id = this.type();
    img = img.wrap('span', {
      'class': 'input-group-addon'
    });
    answer.appendChild(img);
    return answer;
  },
  onFocus: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input)
      input.onfocus = null;
    this._showCalendar();
    if (g_full_calendar_edit)
      this._hideInput();
  },
  _hideInput: function() {
    var cell = this.getAnchorCell();
    var leftPosition = this._getOffsetLeft(cell);
    $j('#cell_edit_window').css({
      'display': 'none'
    });
    $j('#GwtDateTimePicker').css({
      'top': this._getOffsetTop(cell),
      'left': leftPosition,
      'z-index': 1
    });
    cell = this;
    $j('#GwtDateTimePicker_ok').click(function() {
      $j('#cell_edit_ok').trigger('click');
    });
    $j('#GwtDateTimePicker_cancel').click(function() {
      cell.dismiss();
    });
  },
  _showCalendar: function() {
    if (gel("GwtDateTimePicker"))
      return;
    var format;
    var useTime;
    if (this.editor.tableElement.isDateTime()) {
      format = g_user_date_time_format;
      useTime = true;
    } else
      format = g_user_date_format;
    this.cal = new GwtDateTimePicker(GwtListEditWindow.inputID, format, useTime);
    this.addMultipleEditMsg();
    return false;
  },
  addMultipleEditMsg: function() {
    if (!window.g_full_calendar_edit)
      return;
    var msgStr;
    if (this.numCanEdit == 1)
      return;
    else
      msgStr = this.numCanEdit + this.msgRowsUpdated;
    if (this.numCannotEdit &gt; 0) {
      msgStr = msgStr + "&lt;br/&gt;";
      if (this.numCannotEdit == 1)
        msgStr += this.msgRowNotUpdated;
      else
        msgStr += this.numCannotEdit + this.msgRowsNotUpdated;
    }
    var div = new Element('div');
    div.style.marginTop = 2;
    div.style.fontWeight = "normal";
    div.update(msgStr);
    $('window.GwtDateTimePicker').appendChild(div);
  },
  toString: function() {
    return "GwtListEditCalendar";
  }
});;
/*! RESOURCE: /scripts/GwtListEditReference.js */
var GwtListEditReference = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    this.id = this.refName;
    this._createInputControls(this.getTitle());
  },
  _createInputControls: function(parent) {
    var refSysId = this.editor.getValue();
    var rowSysId = this.getAnchorSysId();
    this.inputControls = new AJAXReferenceControls(this.editor.tableElement, this.id, parent, refSysId, rowSysId, this._getRefQualTag());
    this.inputControls.setDisplayValue(this._getDisplayValue());
    this.focusElement = this.inputControls.getInput();
    this.focusElement.style.width = this.preferredWidth;
    this.inputControls.setRecord(this.editor);
  },
  saveAndClose: function($super) {
    this.inputControls.resolveReference();
    if (this.inputControls.isResolving())
      this.inputControls.setResolveCallback(this.saveAndClose.bind(this));
    else
      return $super();
  },
  save: function() {
    var sys_id = this.inputControls.getValue();
    if (!sys_id)
      sys_id = "NULL";
    if (sys_id == "1111")
      sys_id = "NULL";
    var displayValue = this.inputControls.getDisplayValue();
    var refValid = this.inputControls.isReferenceValid();
    if (!refValid) {
      if (this.inputControls.tableElement.isDynamicCreation())
        sys_id = displayValue;
      else
        return;
    }
    if (sys_id == "NULL") {
      displayValue = '';
    }
    this.setReferenceValue(sys_id, refValid);
    this.setRenderValue(displayValue);
  },
  setReferenceValue: function(value, valid) {
    this.setValue(value);
    if (this.editor)
      this.editor.setReferenceValid(valid);
  },
  dismiss: function($super) {
    if (this.destroyed || !this.inputControls)
      return false;
    this.inputControls.clearDropDown();
    $super();
  },
  onKeyReturn: function(evt) {
    evt.stop();
    setTimeout(this.saveAndClose.bind(this), 50);
    this._placeCursorReturn(evt);
  },
  _getRefQualTag: function() {
    var cell = this.getAnchorCell();
    var table = findParentByTag(cell, "TABLE");
    if (table) {
      var tag = getAttributeValue(table, 'glide_list_edit_ref_qual_tag');
      if (tag)
        return tag;
    }
    return "";
  },
  _getDisplayValue: function() {
    if (this.editor.getValue() == "NULL")
      return "";
    return this.editor.getRenderValue() || this.editor.getDisplayValue();
  },
  toString: function() {
    return "GwtListEditReference";
  }
});;
/*! RESOURCE: /scripts/GwtListEditBoolean.js */
var GwtListEditBoolean = Class.create(GwtListEditSelect, {
  addOptions: function() {
    this.staticOptions = true;
    var select = this.focusElement;
    var value = this.editor.getValue();
    addOption(select, true, getMessage("true"), value == "true");
    addOption(select, false, getMessage("false"), value != "true");
  },
  toString: function() {
    return "GwtListEditBoolean";
  }
});;
/*! RESOURCE: /scripts/GwtListEditDuration.js */
var GwtListEditDuration = Class.create(GwtListEditWindow, {
  MS_IN_DAY: 86400000,
  MAX_UNIT_DAYS: 4,
  MAX_UNIT_HOURS: 3,
  MAX_UNIT_MINUTES: 2,
  MAX_UNIT_SECONDS: 1,
  createEditControls: function() {
    this.setDateParts(this.editor.getValue());
    this.gMessage = new GwtMessage();
    this.gMessage.getMessages(['Hours', 'Days', 'day', 'hour', 'minute', 'second', 'minutes', 'seconds']);
    this.renderControl();
  },
  onKeyTab: function(evt) {
    evt.stop();
    if (evt.shiftKey) {
      if (!this._previousChoice(evt)) {
        this.saveAndClose();
        this.prevColumn();
      }
    } else if (!this._nextChoice(evt)) {
      this.saveAndClose();
      this.nextColumn();
    }
  },
  _previousChoice: function(e) {
    var previous = this.focusElement.up().previousSibling;
    if (previous)
      previous = previous.previousSibling;
    if (previous == null)
      return false;
    this.focusElement = $(previous).select("input")[0];
    this.focusEditor();
    return true;
  },
  _nextChoice: function(e) {
    var next = this.focusElement.up().nextSibling;
    if (next)
      next = next.nextSibling;
    if (next == null)
      return false;
    this.focusElement = $(next).select("input")[0];
    this.focusEditor();
    return true;
  },
  setDateParts: function(dateStr) {
    if (dateStr.length &lt;= 0) {
      this.days = 0;
      this.hours = 0;
      this.minutes = 0;
      this.seconds = 0;
    } else {
      var dateTime = dateStr.split(" ");
      var dateParts = dateTime[0].split("-");
      var timeParts = dateTime[1].split(":");
      this.days = parseInt(Date.parse(dateParts[1] + "/" + dateParts[2] + "/" + dateParts[0] + " 00:00:00 UTC") / this.MS_IN_DAY);
      this.hours = timeParts[0];
      this.minutes = timeParts[1];
      this.seconds = timeParts[2];
      var max_level = this._getUnitLevel();
      if (max_level &lt;= this.MAX_UNIT_HOURS) {
        this.hours = parseInt(this.hours, 10) + (this.days * 24);
        this.days = 0;
      }
      if (max_level &lt;= this.MAX_UNIT_MINUTES) {
        this.minutes = parseInt(this.minutes, 10) + (this.hours * 60);
        this.hours = 0;
      }
      if (max_level &lt;= this.MAX_UNIT_SECONDS) {
        this.seconds = parseInt(this.seconds, 10) + (this.minutes * 60);
        this.minutes = 0;
      }
    }
  },
  renderControl: function() {
    var table = cel("table");
    var cls = '';
    if (this.doctype)
      cls = 'form-control list-edit-input';
    table.cellPadding = 0;
    table.style.backgroundColor = "EEEEEE";
    var tbody = cel("tbody", table);
    var tr = cel("tr", tbody);
    var max_level = this._getUnitLevel();
    var td = cel("td", tr);
    var days;
    if (max_level == this.MAX_UNIT_DAYS) {
      td.innerHTML = this.gMessage.getMessage("Days") + "&amp;nbsp;";
      td = cel("td", tr);
      days = cel("input", td);
      days.id = "dur_day";
      days.className = cls;
      days.size = "2";
      days.maxLength = "5";
      days.style.marginRight = "5px";
      days.value = this.days
      td = cel("td", tr);
    }
    var hours;
    if (max_level &gt;= this.MAX_UNIT_HOURS) {
      td.innerHTML = this.gMessage.getMessage("Hours") + "&amp;nbsp;";
      td = cel("td", tr);
      hours = cel("input", td);
      hours.id = "dur_hour";
      hours.className = cls;
      hours.size = "2";
      hours.maxLength = "2";
      hours.value = this.hours;
      td = cel("td", tr);
      td.innerHTML = ":";
      td = cel("td", tr);
    } else {
      td.innerHTML = this.gMessage.getMessage("Minutes") + "&amp;nbsp;";
    }
    var mins;
    if (max_level &gt;= this.MAX_UNIT_MINUTES) {
      mins = cel("input", td);
      mins.id = "dur_min";
      mins.className = cls;
      mins.size = "2";
      mins.maxLength = "2";
      mins.value = this.minutes;
      td = cel("td", tr);
      td.innerHTML = ":";
      td = cel("td", tr);
    } else {
      td.innerHTML = this.gMessage.getMessage("Seconds") + "&amp;nbsp;";
    }
    var secs = cel("input", td);
    secs.id = "dur_sec";
    secs.className = cls;
    secs.size = "2";
    secs.maxLength = "2";
    secs.value = this.seconds;
    this.setTitle(table);
    this.focusElement = gel("dur_day");
  },
  save: function() {
    var max_level = this._getUnitLevel();
    var day = (max_level == this.MAX_UNIT_DAYS) ? gel("dur_day").value : 0;
    var hour = (max_level &gt;= this.MAX_UNIT_HOURS) ? gel("dur_hour").value : 0;
    var min = (max_level &gt;= this.MAX_UNIT_MINUTES) ? gel("dur_min").value : 0;
    var sec = gel("dur_sec").value;
    if (!day || day == null || !isNumber(day))
      day = 0;
    if (!hour || hour == null || !isNumber(hour))
      hour = 0;
    if (!min || min == null || !isNumber(min))
      min = 0;
    if (!sec || sec == null || !isNumber(sec))
      sec = 0;
    day = parseInt(day, 10);
    hour = parseInt(hour, 10);
    min = parseInt(min, 10);
    sec = parseInt(sec, 10);
    if (max_level == this.MAX_UNIT_SECONDS) {
      min = Math.floor(sec / 60);
      sec = sec % 60;
    }
    if (max_level &lt;= this.MAX_UNIT_MINUTES) {
      hour = Math.floor(min / 60);
      min = min % 60;
    }
    if (max_level &lt;= this.MAX_UNIT_HOURS) {
      day = Math.floor(hour / 24);
      hour = hour % 24;
    }
    var dt = new Date(0);
    dt.setUTCDate(day + 1);
    var dateStr = dt.getUTCFullYear() + "-" + padLeft(dt.getUTCMonth() + 1, 2, '0') + "-" + padLeft(dt.getUTCDate(), 2, '0') + " " +
      padLeft(hour, 2, '0') + ":" + padLeft(min, 2, '0') + ":" + padLeft(sec, 2, '0');
    this.setValue(dateStr);
    this._setRenderValue(day, hour, min, sec);
  },
  _setRenderValue: function(day, hour, min, sec) {
    var dspVal = "";
    if (day &gt; 0)
      dspVal += day + " " + this._getLabel("day", day) + " ";
    if (hour &gt; 0)
      dspVal += hour + " " + this._getLabel("hour", hour) + " ";
    if (min &gt; 0)
      dspVal += min + " " + this._getLabel("minute", min) + " ";
    if (dspVal == "")
      dspVal += sec + " " + this._getLabel("second", sec) + " ";
    this.setRenderValue(dspVal);
  },
  _getLabel: function(label, val) {
    if (val != 1)
      label += "s";
    return this.gMessage.getMessage(label).toLowerCase();
  },
  _getUnitLevel: function() {
    var max_unit = this.editor.tableElement.getNamedAttribute('max_unit');
    if (max_unit == null)
      return this.MAX_UNIT_DAYS;
    switch (max_unit) {
      case 'hours':
        return this.MAX_UNIT_HOURS;
      case 'minutes':
        return this.MAX_UNIT_MINUTES;
      case 'seconds':
        return this.MAX_UNIT_SECONDS;
    }
    return this.MAX_UNIT_DAYS;
  },
  toString: function() {
    return "GwtListEditDuration";
  }
});;
/*! RESOURCE: /scripts/GwtListEditTablename.js */
var GwtListEditTablename = Class.create(GwtListEditSelect, {
  addOptions: function() {
    var ga = new GlideAjax('AjaxClientHelper');
    this.editor.selectedOnly = this.editor.tableElement.getNamedAttribute("selected_only") == "true";
    ga.addParam('sysparm_name', this.getName());
    ga.addParam('sysparm_noViews', this.getNoViews());
    ga.addParam('sysparm_noSystemTables', this.editor.tableElement.getNamedAttribute("no_system_tables") == "true");
    ga.addParam('sysparm_currentTableName', this.editor.tableElement.tableName);
    if (this.editor.selectedOnly) {
      ga.addParam('sysparm_selectedOnly', true);
      ga.addParam('sysparm_selectedField', this.editor.fields[0]);
      ga.addParam('sysparm_selected', this._getSelected());
      ga.addParam('sysparm_forceSelected', this.editor.tableElement.getNamedAttribute("force_selected") == "true")
    }
    ga.getXML(this._createOptions.bind(this));
  },
  getName: function() {
    return "generateChoiceTable";
  },
  getNoViews: function() {
    return this.editor.tableElement.getNamedAttribute("no_views") == "true";
  },
  _getSelected: function() {
    var selected = this.editor.getValue(this.editor.fields[0]);
    var selectedOnlyOverride = this.editor.tableElement.getNamedAttribute("selected_only_list_override");
    if ((selected == null || selected.length == 0) &amp;&amp; selectedOnlyOverride != null) {
      if (selectedOnlyOverride.indexOf('javascript:') == 0) {
        var script = selectedOnlyOverride.substring(11, selectedOnlyOverride.length);
        var response;
        try {
          response = eval(script);
        } catch (e) {
          return selected;
        }
        if (typeof response == 'undefined') {
          return selected;
        } else {
          return response == null || response.length == 0 ?
            'empty_c460fe18-371f-4315-a61b-c7bf21c82786' : response;
        }
      } else {
        return selectedOnlyOverride;
      }
    }
    return selected;
  },
  toString: function() {
    return "GwtListEditTablename";
  }
});;
/*! RESOURCE: /scripts/GwtListEditUpdateTablename.js */
var GwtListEditUpdateTablename = Class.create(GwtListEditTablename, {
  getName: function() {
    return 'generateChoiceUpdateTable';
  },
  getNoViews: function() {
    return true;
  },
  toString: function() {
    return "GwtListEditUpdateTablename";
  }
});;
/*! RESOURCE: /scripts/GwtListEditDependent.js */
var GwtListEditDependent = Class.create(GwtListEditWindow, {
  initialize: function($super, editor, gridEdit, fields) {
    this.fields = fields;
    $super(editor, gridEdit);
  },
  createEditControls: function() {
    this.preferredWidth = 0;
    this.controlsCount = 0;
    this._renderContainer();
    this._renderControls();
    return false;
  },
  onKeyTab: function(evt) {
    evt.stop();
    if (evt.shiftKey) {
      if (!this._previousChoice(evt)) {
        this.saveAndClose();
        this.prevColumn();
      }
    } else if (!this._nextChoice(evt)) {
      this.saveAndClose();
      this.nextColumn();
    }
  },
  _previousChoice: function(e) {
    var previous = this.focusElement.parentNode.parentNode.previousSibling;
    if (previous == null)
      return false;
    this.focusElement = $(previous).select("select")[0];
    this.focusEditor();
    return true;
  },
  _nextChoice: function(e) {
    var next = this.focusElement.parentNode.parentNode.nextSibling;
    if (next == null)
      return false;
    this.focusElement = $(next).select("select")[0];
    this.focusEditor();
    return true;
  },
  _renderControls: function() {
    var clickedField = this.refName;
    for (var i = 0; i &lt; this.fields.length; i++) {
      var field = this.fields[i];
      var elName = this.editor.table + '.' + field;
      var tableElement = TableElement.get(elName);
      if (!tableElement || !tableElement.isChoice())
        continue;
      var focus = (elName == clickedField);
      var el = this._renderControl(tableElement, field, focus);
    }
  },
  _resizeControls: function() {
    var editControls = gel("editControls");
    if (editControls) {
      var choiceLists = editControls.getElementsByTagName("select");
      for (var i = 0; i &lt; choiceLists.length; i++) {
        if (choiceLists[i].clientWidth &gt; this.preferredWidth)
          this.preferredWidth = choiceLists[i].clientWidth;
      }
      for (var i = 0; i &lt; choiceLists.length; i++) {
        choiceLists[i].style.width = this.preferredWidth + 'px';
      }
    }
  },
  _renderContainer: function() {
    var table = cel("table");
    table.cellPadding = 2;
    table.style.backgroundColor = "EEEEEE";
    var tbody = cel("tbody", table);
    tbody.id = "editControls";
    this.setTitle(table);
  },
  _renderControl: function(tableElement, fieldName, focus) {
    this.refName = this.editor.table + "." + fieldName;
    var id = "LIST_EDIT_" + this.refName;
    if (gel(id))
      return;
    var tbody = gel("editControls");
    var tr = cel("tr", tbody);
    var td = cel("td", tr);
    td.id = "container_" + this.refName;
    td.innerHTML = tableElement.label + ":&lt;br&gt;";
    var select = cel("select");
    select.id = id;
    if (this.doctype)
      select.className = 'form-control list-edit-input';
    select.name = this.refName;
    select.setAttribute("dbVal", this.editor.getValue(fieldName));
    select.onchange = this._handleOnChange.bindAsEventListener(this);
    td.appendChild(select)
    this.controlsCount++;
    var dependent = tableElement.getDependent();
    var depVal = '';
    if (dependent)
      depVal = this.editor.getValue(this._getTargetName(fieldName, dependent));
    this._addOptions(select, depVal);
    if (focus)
      this.focusElement = select;
  },
  _handleOnChange: function(e) {
    var parent = Event.element(e);
    var tableElement = TableElement.get(parent.name);
    var children = tableElement.getDependentChildren();
    for (var k in children) {
      var focusElement = gel("LIST_EDIT_" + this._getTargetName(parent.name, k));
      if (!focusElement)
        return;
      focusElement.setAttribute("dbVal", "");
      this._addOptions(focusElement, parent.options[parent.options.selectedIndex].value);
    }
  },
  _getTargetName: function(base, field) {
    var parts = base.split(".");
    parts[parts.length - 1] = field;
    return parts.join(".");
  },
  _addOptions: function(element, depValue) {
    var ajax = new GlideAjax('PickList');
    ajax.addParam('sysparm_chars', '*');
    ajax.addParam('sysparm_name', element.name);
    if (depValue)
      ajax.addParam('sysparm_value', depValue);
    ajax.addParam('sysparm_nomax', 'true');
    ajax.addParam('sysparm_id_list', this.gridEdit.getSelectedSysIds().join());
    ajax.getXML(this._createOptions.bind(this, element));
  },
  _createOptions: function(element, response) {
    element.options.length = 0;
    element.style.width = '';
    var xml = response.responseXML;
    var items = xml.getElementsByTagName("item");
    var value = element.getAttribute("dbVal");
    var nullOverride = xml.documentElement.getAttribute("default_option");
    if (nullOverride != null &amp;&amp; nullOverride.length &gt; 0) {
      addOption(element, "", nullOverride, true);
    } else {
      var msg = getMessage("-- None --");
      addOption(element, "", msg, true);
    }
    for (var i = 0; i &lt; items.length; i++) {
      var v = items[i].getAttribute("value");
      var l = items[i].getAttribute("label");
      if (!this._checkDuplicateOptions(element, v, l))
        addOption(element, v, l, (v == value));
    }
    if (this.controlsCount &gt; 0)
      this.controlsCount--;
    if (this.controlsCount == 0) {
      setTimeout(this._resizeControls.bind(this), 0);
      this.createEditControlsComplete();
    }
  },
  _checkDuplicateOptions: function(element, value, label) {
    if (!element.length)
      return false;
    var opts = element.options;
    for (var i = 0; i &lt; opts.length; i++)
      if (opts[i].value == value &amp;&amp; opts[i].text === label)
        return true;
    return false;
  },
  save: function() {
    var tbody = gel("editControls");
    var choiceLists = tbody.getElementsByTagName("select");
    if (choiceLists) {
      for (var i = 0; i &lt; choiceLists.length; i++) {
        var element = choiceLists[i];
        var option = element.options[element.selectedIndex];
        var fName = element.name.substring(this.editor.table.length + 1);
        this.editor.setFieldValue(fName, option.value);
        var dspValue;
        if (!option.value)
          dspValue = '';
        else
          dspValue = option.text;
        this.editor.setFieldRenderValue(fName, dspValue);
      }
    }
  },
  toString: function() {
    return "GwtListEditDependent";
  }
});;
/*! RESOURCE: /scripts/GwtListEditMultiText.js */
var GwtListEditMultiText = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var input = this._createTextAreaInput();
    this.setTitle(input);
  },
  onKeyEsc: function(evt) {
    evt.stop();
    this.dismiss();
    setTimeout(this._delayedRefresh.bind(this), 10);
  },
  onKeyReturn: function(evt) {
    if (evt.shiftKey)
      return;
    evt.stop();
    this.saveAndClose();
    if (evt.ctrlKey)
      setTimeout(this._delayedEdit.bind(this), 10);
    else
      setTimeout(this._delayedRefresh.bind(this), 10);
  },
  _delayedRefresh: function() {
    this.gridEdit.refreshCursor();
  },
  _delayedEdit: function() {
    this.gridEdit.editNextRow();
  },
  _createTextAreaInput: function() {
    var answer = cel("textarea");
    answer.value = this.editor.getDisplayValue();
    answer.rows = 4;
    answer.id = GwtListEditWindow.inputID;
    if (this.doctype)
      answer.addClassName('form-control list-edit-input');
    if (!this.doctype) {
      answer.style.width = this.preferredWidth;
      answer.style.overflow = "auto";
    }
    this.focusElement = answer;
    return answer;
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input) {
      this.setValue(null, input.value);
      this.setRenderValue(this.truncateDisplayValue(input.value));
    }
  },
  toString: function() {
    return "GwtListEditMultiText";
  }
});;
/*! RESOURCE: /scripts/GwtListEditJournal.js */
var GwtListEditJournal = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var input = this._createTextAreaInput();
    this.setTitle(input);
  },
  onKeyReturn: function($super, evt) {
    if (evt.shiftKey)
      return;
    $super(evt);
  },
  _createTextAreaInput: function() {
    var answer = cel("textarea");
    answer.value = "";
    answer.rows = 3;
    answer.id = GwtListEditWindow.inputID;
    if (this.doctype)
      answer.addClassName('form-control list-edit-input');
    if (!this.doctype) {
      answer.style.width = this.preferredWidth;
      answer.style.overflow = "auto";
    }
    this.focusElement = answer;
    return answer;
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input)
      this.setValue(null, input.value);
  },
  toString: function() {
    return "GwtListEditJournal";
  }
});;
/*! RESOURCE: /scripts/GwtListEditInternalType.js */
var GwtListEditInternalType = Class.create(GwtListEditSelect, {
  addOptions: function() {
    var ga = new GlideAjax('AjaxClientHelper');
    ga.addParam('sysparm_name', 'generateChoice');
    var selectedValue = this.editor.getValue();
    if (selectedValue) {
      ga.addParam('sysparm_selected_value', selectedValue);
    }
    ga.getXML(this._createOptions.bind(this));
  },
  _createOptions: function(response) {
    if (this.state != 'initialize')
      return;
    var xml = response.responseXML;
    var items = xml.getElementsByTagName("item");
    var value = this.editor.getValue();
    this.focusElement.options.length = 0;
    for (var i = 0; i &lt; items.length; i++) {
      var v = items[i].getAttribute("value");
      var l = items[i].getAttribute("label");
      addOption(this.focusElement, v, l, this._isSelected(value, v, l));
    }
    this.createEditControlsComplete();
  },
  toString: function() {
    return "GwtListEditInternalType";
  }
});;
/*! RESOURCE: /scripts/GwtListEditRelatedTags.js */
var GwtListEditRelatedTags = Class.create(GwtListEditWindow, {
  createOkCancel: function() {
    var save = createImage('images/icons/nav_clear_2.png', this.msgSaveButton, this, this.saveEvent);
    save.id = 'cell_edit_ok';
    save.width = 18;
    save.height = 18;
    this.addDecoration(save);
  },
  save: function() {},
  createEditControls: function() {
    var $ = $j;
    var that = this;
    var tags = new Element("ul", {
      "id": "tag_cell_edit"
    });
    this.setTitle(tags);
    $dt = $('#tag_cell_edit');
    var url = new GlideURL("data_table.do");
    url.addParam('sysparm_type', 'labels');
    url.addParam('sysparm_table', this.editor.table);
    url.addParam('sysparm_sys_id', this.editor.getCanWriteIds().toString());
    url.addParam('sysparm_action', 'common_labels');
    url.addParam('nocache', (new Date().getTime().toString()));
    url = url.getURL();
    $.ajax({
      dataType: "json",
      url: url,
      beforeSend: function(request) {
        request.setRequestHeader("X-UserToken", window.g_ck);
      },
      success: initializeResponse
    });

    function labelTypeAhead(table, search, showChoices) {
      var url = new GlideURL("data_table.do");
      url.addParam('sysparm_type', 'labels');
      url.addParam('sysparm_table', table);
      url.addParam('sysparm_action', 'available_labels');
      url.addParam('sysparm_prefix', search.term);
      url = url.getURL();
      $.ajax({
        dataType: "json",
        url: url,
        beforeSend: function(request) {
          request.setRequestHeader("X-UserToken", window.g_ck);
        },
        success: function() {
          var t = arguments[2].responseText;
          var response = JSON.parse(t);
          showChoices(response.availableLabels);
        }
      });
    }

    function initializeResponse() {
      var labels = JSON.parse(arguments[2].responseText);
      $dt.html += "&lt;li&gt;&lt;/li&gt;";
      $dt.newtagit({
        allowSpaces: true,
        afterTagAdded: onTagAdded,
        afterTagRemoved: onTagRemoved,
        showAutocompleteOnFocus: false,
        animate: false,
        placeholderText: getMessage("Add Tag..."),
        table: labels.table,
        labelsListString: JSON.stringify(labels),
        autocomplete: {
          source: function(search, showChoices) {
            labelTypeAhead(labels.table, search, showChoices);
          }
        },
        query: "",
        context: "cellEdit",
        rowId: that.getAnchorSysId(),
        fieldName: "documentTags"
      });
      $dt.css("display", "inline-block");
    }

    function onTagAdded(evt, ui) {
      if (ui.duringInitialization)
        return;
      var rowIds = that.editor.getCanWriteIds();
      var validRowIds = [];
      for (var i = 0; i &lt; rowIds.length; i++) {
        var row = $("tr[sys_id='" + rowIds[i] + "']");
        var labelNames = row.find(".tagit-label:contains(" + ui.tagLabel + ")")
          .filter(function() {
            return this.text == ui.tagLabel
          });
        if (labelNames.length != 0)
          continue;
        row.find("input.ui-widget-content").parent().before(ui.tag.clone(true));
        validRowIds.push(rowIds[i]);
      }
      labelSet('add', ui.tagLabel, ui.table, validRowIds);
    }

    function onTagRemoved(evt, ui) {
      if (ui.duringInitialization)
        return;
      var rowIds = that.editor.getCanWriteIds();
      var validRowIds = [];
      for (var i = 0; i &lt; rowIds.length; i++) {
        var label = $("tr[sys_id='" + rowIds[i] + "']").find("li[id='" + ui.tag + "']");
        if (label.length != 0) {
          label.remove();
          validRowIds.push(rowIds[i]);
        }
      }
      labelSet('removeById', ui.tag, ui.table, validRowIds);
    }

    function labelSet(action, label, table, rowId) {
      var url = new GlideURL("data_table.do");
      url.addParam('sysparm_type', 'labels');
      url.addParam('sysparm_table', table);
      url.addParam('sysparm_sys_id', rowId.toString());
      url.addParam('sysparm_label', label);
      url.addParam('sysparm_action', action);
      url = url.getURL();
      $.ajax({
        dataType: "json",
        url: url,
        beforeSend: function(request) {
          request.setRequestHeader("X-UserToken", window.g_ck);
        },
        success: labelResponse
      });
    }

    function labelResponse() {
      if (g_enhanced_activated == 'false') return;
      if (arguments == null || arguments[2] == null) return;
      var t = arguments[2].responseText;
      if (t == "" || t == null) return;
      var json = JSON.parse(t);
      var share = $dt.find('[id=\'' + json.label + '\'].tagit-share');
      share.parent().attr("id", json.sysId).css({
        "background-color": json.bgcolor,
        "color": json.tcolor
      });
      share.parent().find(".tagit-label").unbind('click').click(function() {
        window.location.href = json.table + "_list.do?sysparm_query=" + json.query
      });
      if (json.owner != true) {
        share.removeClass("pointerhand");
        share.unbind("click");
      }
      var icon = (json.type == 'SHARED') ? 'icon-user-group' : 'icon-user';
      share = share.children();
      share.removeClass("icon-user-group icon-user").addClass(icon);
      var rowIds = that.editor.getCanWriteIds();
      for (var i = 0; i &lt; rowIds.length; i++) {
        var rowShare = $("tr[sys_id='" + rowIds[i] + "']").find('[id=\'' + json.label + '\'].tagit-share');
        rowShare.parent().attr("id", json.sysId).css({
          "background-color": json.bgcolor,
          "color": json.tcolor
        });
        rowShare.parent().find(".tagit-label").unbind('click').click(function() {
          window.location.href = json.table + "_list.do?sysparm_query=" + json.query
        });
        if (json.owner != true) {
          rowShare.removeClass("pointerhand");
          rowShare.unbind("click");
        }
        rowShare = rowShare.children();
        rowShare.removeClass("icon-user-group icon-user").addClass(icon);
      }
    }
  },
  _onKeyDown: function(e) {
    switch (e.keyCode) {
      case Event.KEY_ESC:
        this.onKeyEsc(e);
        break;
      case Event.KEY_TAB:
        this.onKeyTab(e);
        break;
    }
  },
  toString: function() {
    return "GwtListEditRelatedTags";
  }
});;
/*! RESOURCE: /scripts/GwtListEditEncryptedText.js */
var GwtListEditEncryptedText = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var input = this._createTextAreaInput();
    this.setTitle(input);
  },
  _createTextAreaInput: function() {
    var answer = cel("textarea");
    answer.value = this.editor.getDisplayValue();
    answer.rows = 4;
    answer.id = GwtListEditWindow.inputID;
    if (this.doctype)
      answer.addClassName('form-control list-edit-input');
    if (!this.doctype) {
      answer.style.width = this.preferredWidth;
      answer.style.overflow = "auto";
    }
    this.focusElement = answer;
    return answer;
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input) {
      this.setValue(null, input.value);
      this.setRenderValue(this.truncateDisplayValue(input.value));
    }
  },
  toString: function() {
    return "GwtListEditEncryptedText";
  }
});;
/*! RESOURCE: /scripts/GwtListEditTranslatedField.js */
var GwtListEditTranslatedField = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var input = this.createTextInput();
    input.value = this.editor.getDisplayValue();
    this.setTitle(input);
    if (this.editor.tableElement.maxLength &gt; 0)
      input.setAttribute("maxLength", this.editor.tableElement.maxLength);
    var answer = input.value.replace(/\n/g, " ");
    answer = answer.replace(/\t/g, "");
    this.focusElement.value = answer;
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input) {
      this.setValue(null, input.value);
      this.setRenderValue(this.truncateDisplayValue(input.value));
    }
  },
  toString: function() {
    return "GwtListEditTranslatedField";
  }
});;
/*! RESOURCE: /scripts/GwtListEditPassword.js */
var GwtListEditPassword = Class.create(GwtListEditWindow, {
  createEditControls: function() {
    var input = this.createTextInput();
    input.type = "password";
    this.setTitle(input);
  },
  save: function() {
    var input = GwtListEditWindow.getCellEditValue();
    if (input)
      this.setValue(null, input.value);
  },
  toString: function() {
    return "GwtListEditPassword";
  }
});;
/*! RESOURCE: /scripts/GwtListEditError.js */
var GwtListEditError = Class.create(GwtListEditWindow, {
  initialize: function($super, editor, gridEdit, errorMsg) {
    this.errorMsg = errorMsg;
    $super(editor, gridEdit);
  },
  _showUpdateMessage: function() {
    return;
  },
  createEditControls: function() {
    var input = this.createTextInput();
    input.value = this.editor.getDisplayValue();
    if (this.doctype)
      input.style.marginBottom = '3px';
    input.style.backgroundColor = "LightGrey";
    input.readOnly = true;
    this.setTitle(input);
    this.appendStatusPane(this.errorMsg);
    var e = $('cell_edit_ok');
    if (e)
      e.parentNode.removeChild(e);
  },
  focusEditor: function() {
    this.focusElement.focus();
  },
  saveAndClose: function() {
    this.dismiss();
    return true;
  },
  toString: function() {
    return "GwtListEditError";
  }
});;
/*! RESOURCE: /scripts/GwtCellEditor.js */
var GwtCellEditor = Class.create({
  REF_ELEMENT_PREFIX: 'ref_',
  IGNORE_MSG: "This element type is not editable from the list.",
  WAITING_IMAGE: 'images/loading_anim3.gifx',
  initialize: function(gridEdit, ignoreTypes, changes, tableController, renderer) {
    this.gridEdit = gridEdit;
    this.ignoreTypes = ignoreTypes;
    this.changes = changes;
    this.tableController = tableController;
    this.renderer = renderer;
    this._initElement();
    this.savedFields = [];
    if (this.changes.isDeletedRow(this.sysId))
      return;
    this.timer = setTimeout(this.showLoading.bind(this), this.WAIT_INITIAL_DELAY);
    this.valid = true;
    this.errorMsg = this._checkIgnoreTypes();
    if (this.errorMsg) {
      this.editWindow = this._buildErrorEditor();
      return;
    }
    this.errorMsg = this._checkMultipleDerivedOrExtended();
    if (this.errorMsg) {
      this.editWindow = this._buildErrorEditor();
      return;
    }
    this._loadValues(this.renderEditor.bind(this));
  },
  dismiss: function() {
    this.valid = false;
    this.hideLoading();
    if (this.editWindow)
      this.editWindow.dismiss();
  },
  saveAndClose: function() {
    this.valid = false;
    this.hideLoading();
    if (this.editWindow)
      return this.editWindow.saveAndClose();
    return false;
  },
  saveValues: function() {
    this._saveValues();
  },
  _getSelectedSysIds: function() {
    return this.gridEdit.getSelectedSysIds();
  },
  _getSecurityFields: function() {
    if (this.tableElement.isReference()) {
      var answer = [];
      answer.push(this.fieldName);
      return answer;
    }
    return this.fields;
  },
  getValue: function(field) {
    if (!field)
      field = this.fieldName;
    return this.changes.getValue(this.sysId, field);
  },
  getDisplayValue: function(field) {
    if (!field)
      field = this.fieldName;
    return this.changes.getDisplayValue(this.sysId, field);
  },
  getRenderValue: function(field) {
    if (!field)
      field = this.fieldName;
    return this.changes.getRenderValue(this.sysId, field);
  },
  getCanWriteIds: function() {
    var sysIds = this._getSelectedSysIds();
    return this.changes.calcWritableSysIds(sysIds, this._getSecurityFields());
  },
  isMandatory: function(id, fieldName) {
    if (!fieldName)
      fieldName = this.fieldName;
    if (!id)
      id = this.sysId;
    var record = this.changes.get(id);
    if (!record)
      return false;
    var field = record.getField(fieldName);
    if (!field)
      return false;
    if (field.isMandatory())
      return true;
  },
  setValue: function(value, displayValue) {
    this.setFieldValue(this.fieldName, value, displayValue);
  },
  setReferenceValid: function(valid) {
    this.changes.setReferenceValid(this.sysId, this.fieldName, valid);
  },
  isReferenceValid: function() {
    return this.changes.isReferenceValid(this.sysId, this.fieldName);
  },
  setFieldValue: function(name, value, displayValue) {
    var ids = this.getCanWriteIds();
    for (var i = 0; i &lt; ids.length; i++) {
      var id = ids[i];
      this._beforeSetValue(id, name, value, displayValue);
      if (value == null)
        this.renderer.setDisplayValue(id, name, displayValue);
      else
        this.renderer.setValue(id, name, value);
      this._afterSetValue(id, name);
      if (this.changes.isAddedRow(id) || this.changes.isFieldDirty(id, name)) {
        var entry = [id, name];
        this.savedFields.push(entry);
      }
    }
  },
  setRenderValue: function(value, displayValue) {
    this.setFieldRenderValue(this.fieldName, value, displayValue);
  },
  setFieldRenderValue: function(name, value) {
    var ids = this.getCanWriteIds();
    for (var i = 0; i &lt; ids.length; i++) {
      var id = ids[i];
      this.changes.setRenderValue(id, name, value);
      if (this.changes.isFieldDirty(id, name))
        this.renderer.renderValue(id, name);
    }
  },
  renderEditor: function() {
    if (!this.valid)
      return;
    var valueErr = this.changes.getLoaderErrorMsg();
    if (valueErr)
      this.errorMsg = valueErr;
    else
      this.errorMsg = this._checkSecurity();
    if (this.errorMsg)
      this.editWindow = this._buildErrorEditor();
    else
      this.editWindow = this._createEditWindow();
  },
  _buildErrorEditor: function() {
    this.gridEdit.clearSelected();
    return new GwtListEditError(this, this.gridEdit, this.errorMsg);
  },
  _checkIgnoreTypes: function() {
    var type = this.tableElement.getType();
    for (var i = 0; i &lt; this.ignoreTypes.length; i++) {
      if (type == this.ignoreTypes[i])
        return getMessage(this.IGNORE_MSG);
    }
    if (this.tableElement.isArray())
      return getMessage(this.IGNORE_MSG);
    return null;
  },
  _checkSecurity: function() {
    var canWriteIds = this.getCanWriteIds();
    if (canWriteIds.length != 0)
      return null;
    var sysIds = this._getSelectedSysIds();
    if (sysIds.length == 1) {
      var field = this.changes.getField(sysIds[0], this.fields[0]);
      if (field &amp;&amp; !field.isOKExtension()) {
        return getMessage("Field does not exist for this record");
      }
    }
    return getMessage("Security prevents writing to this field");
  },
  _checkMultipleDerivedOrExtended: function() {
    var parts = this.name.split('.');
    var sysIds = this._getSelectedSysIds();
    if ((sysIds.length &gt; 1) &amp;&amp; (parts.length &gt; 2)) {
      if (parts[1].indexOf(this.REF_ELEMENT_PREFIX) == 0) {
        return getMessage("Only one extended field can be list edited at a time");
      }
      return getMessage("Only one derived field can be list edited at a time");
    }
    return null;
  },
  _createEditWindow: function() {
    var tableElement = this.tableElement;
    var isDoctype = document.documentElement.getAttribute("data-doctype") == "true";
    if ((tableElement.isDependent() || tableElement.hasDependentChildren()) &amp;&amp; tableElement.isChoice())
      return new GwtListEditDependent(this, this.gridEdit, this.fields);
    if (tableElement.isDate())
      return new GwtListEditCalendar(this, this.gridEdit);
    if (tableElement.isReference())
      return new GwtListEditReference(this, this.gridEdit);
    if (tableElement.isChoice() || tableElement.getType() == "workflow")
      return new GwtListEditSelect(this, this.gridEdit);
    if (tableElement.getType() == "boolean")
      return new GwtListEditBoolean(this, this.gridEdit);
    if (tableElement.getType() == "glide_duration" || tableElement.getType() == "timer")
      return new GwtListEditDuration(this, this.gridEdit);
    if (tableElement.getType() == "table_name") {
      if (tableElement.getNamedAttribute("update_tables_only") == "true") {
        return new GwtListEditUpdateTablename(this, this.gridEdit);
      }
      return new GwtListEditTablename(this, this.gridEdit);
    }
    if (tableElement.getType() == "glide_encrypted")
      return new GwtListEditEncryptedText(this, this.gridEdit);
    if (tableElement.isMulti() &amp;&amp; tableElement.getType() != "journal_input")
      return new GwtListEditMultiText(this, this.gridEdit);
    if (tableElement.getType() == "journal_input")
      return new GwtListEditJournal(this, this.gridEdit);
    if (tableElement.getType() == "related_tags") {
      if (!isDoctype)
        return new GwtListEditError(this, this.gridEdit, getMessage("In-cell editing not available, instead use the 'Assign Tag...' Context Menu to add a tag"));
      else
        return new GwtListEditRelatedTags(this, this.gridEdit);
    }
    if (tableElement.getType() == "internal_type")
      return new GwtListEditInternalType(this, this.gridEdit);
    if (tableElement.getType() == "translated_field")
      return new GwtListEditTranslatedField(this, this.gridEdit);
    if (tableElement.getType().startsWith('password'))
      return new GwtListEditPassword(this, this.gridEdit);
    return new GwtListEditText(this, this.gridEdit);
  },
  _beforeSetValue: function(sysId, name, value, displayValue) {},
  _afterSetValue: function(sysId, name) {},
  showLoading: function() {
    this.loadingImage = GwtListEditTableController.showImage(
      this.gridEdit.getAnchorCell(), this.WAITING_IMAGE);
  },
  hideLoading: function() {
    if (this.timer) {
      clearTimeout(this.timer);
      this.timer = null;
    }
    if (this.loadingImage) {
      rel(this.loadingImage);
      this.loadingImage = null;
    }
  },
  _initElement: function() {
    this.sysId = this.gridEdit.getAnchorSysId();
    this.name = this.gridEdit.getAnchorFqFieldName();
    var parts = this.name.split('.');
    this.table = parts[0];
    this.fieldName = parts.slice(1).join('.');
    this.tableElement = TableElement.get(this.name);
    this.fields = [];
    var topParent = this._findTopParent();
    this._initFields(topParent);
    this._addFieldName(this.fieldName);
  },
  _findTopParent: function() {
    var topParent = this.name;
    var visited = new Object();
    var name = topParent;
    while (name) {
      name = null;
      var tableElement = TableElement.get(topParent);
      if (tableElement) {
        name = tableElement.getDependent();
        if (name) {
          topParent = this.table + "." + name;
          if (visited[name])
            return topParent;
          visited[name] = topParent;
        }
      }
    }
    return topParent;
  },
  _initFields: function(fieldName) {
    var tableElement = TableElement.get(fieldName);
    if (!tableElement)
      return;
    var prefix = '';
    var parts = fieldName.split('.');
    if (parts.length &gt; 2)
      prefix = parts.slice(1, -1).join('.') + '.';
    if (this._addFieldName(prefix + tableElement.name)) {
      var children = tableElement.getDependentChildren();
      for (var k in children)
        this._initFields(this.table + "." + prefix + k);
    }
  },
  _addFieldName: function(fieldName) {
    for (var i = 0; i &lt; this.fields.length; i++)
      if (this.fields[i] == fieldName)
        return null;
    this.fields.push(fieldName);
    return fieldName;
  },
  addRecSysId: function(recPos, callback) {
    var sysId = this.tableController.getSysIDByPos(recPos);
    if (!sysId)
      return;
    if (this.changes.isDeletedRow(sysId))
      return;
    this._loadValues(callback);
  },
  _loadValues: function(callbackStub) {
    this.changes.loadValues(this._getSelectedSysIds(), this.fields, callbackStub);
  },
  _saveValues: function() {
    if (this.savedFields.length &gt; 0) {
      this.tableController.fireCellsChanged(this.savedFields);
      this.savedFields = [];
    }
  },
  isActive: function() {
    if (!this.valid)
      return false;
    if (!this.editWindow)
      return false;
    return !this.editWindow.destroyed;
  },
  toString: function() {
    return "GwtCellEditor";
  }
});;
/*! RESOURCE: /scripts/GwtListEditAjaxChangeSaver.js */
var GwtListEditAjaxChangeSaver = Class.create({
  PROCESSOR: 'com.glide.ui_list_edit.AJAXListEdit',
  WAIT_INITIAL_DELAY: 300,
  WAITING_IMAGE: 'images/loading_anim3.gifx',
  initialize: function(changes, tableController, onCompletion) {
    this.changes = changes;
    this.tableController = tableController;
    this.onCompletion = onCompletion;
    this.changedEntries = [];
    this.savingImages = [];
    this.timer = null;
  },
  save: function() {
    this._startSavingTimer();
    var ajax = new GlideAjax(this.PROCESSOR);
    ajax.addParam("sysparm_type", 'set_value');
    ajax.addParam('sysparm_table', this.tableController.tableName);
    ajax.addParam('sysparm_first_field', this.tableController.firstField);
    ajax.addParam('sysparm_omit_links', this.tableController.omitLinks);
    ajax.addParam('sysparm_xml', this._buildXml());
    this.tableController.tableElementDOM.fire('glide:list_v2.edit.save', {
      ajax: ajax
    });
    ajax.setErrorCallback(this._errorResponse.bind(this));
    ajax.getXML(this._saveResponse.bind(this));
    this.changes.clearAllModified();
    this.changes.removeAll();
  },
  _buildXml: function() {
    var xml = this._createRecordUpdateXml();
    var selector = new GlideListEditor.IsModifiedRecordSelector(this.changes);
    var serializer = new GlideListEditor.XmlSerializingReceiver(xml, xml.documentElement, selector);
    var capture = new GwtListEditAjaxChangeSaver.ChangeCaptureReceiver();
    var receiver = new GwtListEditorPendingChanges.ComposableChangeReceiver();
    receiver.addReceiver(serializer);
    receiver.addReceiver(capture);
    this.changes.exportChanges(receiver);
    this.changedEntries = capture.changedEntries;
    return getXMLString(xml);
  },
  _createRecordUpdateXml: function() {
    var xml = loadXML("&lt;record_update/&gt;");
    this.tableController.exportXml(xml.documentElement);
    return xml;
  },
  _saveResponse: function(response) {
    this._hideSaving();
    if (!response || !response.responseXML) {
      if (this.onCompletion)
        this.onCompletion();
      return;
    }
    var savedSysIds = [];
    var xml = response.responseXML;
    var items = xml.getElementsByTagName("item");
    for (var i = 0; i &lt; items.length; i++) {
      var item = items[i];
      var sysId = item.getAttribute("sys_id");
      if (savedSysIds.indexOf(sysId) &lt; 0)
        savedSysIds.push(sysId);
      var fqField = item.getAttribute("fqField");
      var data = item.firstChild;
      if (!data)
        continue
      var cell = this.tableController.getFqField(sysId, fqField);
      if (!cell)
        continue;
      GlideList2.updateCellContents(cell, data);
      var n = new GlideUINotification({
        type: 'action',
        attributes: {
          table: this.tableController.tableName,
          sys_id: sysId,
          action: 'list_update'
        }
      });
      GlideUI.get().fire(n);
    }
    if (savedSysIds.length &gt; 0)
      this._fireChangesSaved(savedSysIds);
    if (this.onCompletion)
      this.onCompletion();
  },
  _errorResponse: function() {
    this._hideSaving();
  },
  _fireChangesSaved: function(savedSysIds) {
    var info = {
      listId: this.tableController.listID,
      saves: savedSysIds
    };
    this.tableController.fire('glide:list_v2.edit.changes_saved', info);
  },
  _startSavingTimer: function() {
    this.timer = setTimeout(this._showSaving.bind(this), this.WAIT_INITIAL_DELAY);
  },
  _hideSaving: function() {
    if (this.timer) {
      clearTimeout(this.timer);
      this.timer = null;
    }
    for (var i = 0; i &lt; this.savingImages.length; i++)
      rel(this.savingImages[i]);
    this.savingImages = [];
  },
  _showSaving: function() {
    for (var i = 0; i &lt; this.changedEntries.length; i++) {
      var sysId = this.changedEntries[i][0];
      var field = this.changedEntries[i][1];
      var element = this.tableController.getCell(sysId, field);
      if (element)
        this._showImage(element);
    }
  },
  _showImage: function(element) {
    var img = GwtListEditTableController.showImage(element, this.WAITING_IMAGE);
    this.savingImages.push(img);
  },
  toString: function() {
    return 'GwtListEditAjaxChangeSaver';
  }
});
GwtListEditAjaxChangeSaver.ChangeCaptureReceiver = Class.create(
  GwtListEditorPendingChanges.ChangeReceiver, {
    initialize: function($super) {
      $super();
      this.changedEntries = [];
    },
    changedField: function(sysID, field) {
      var entry = [sysID, field.getName()];
      this.changedEntries.push(entry);
    },
    toString: function() {
      return 'GwtListEditAjaxChangeSaver.ChangeCaptureReceiver';
    }
  });;
/*! RESOURCE: /scripts/GwtListEditAjaxValueLoader.js */
var GwtListEditAjaxValueLoader = Class.create({
  PROCESSOR: 'com.glide.ui_list_edit.AJAXListEdit',
  initialize: function(changes, tableController) {
    this.changes = changes;
    this.tableController = tableController;
    this._clearErrorMsg();
    this.generatedSysId = null;
  },
  loadValues: function(sysIds, fields, callback) {
    var ajax = new GlideAjax(this.PROCESSOR);
    ajax.addParam('sysparm_type', 'get_value');
    ajax.addParam('sysparm_table', this.tableController.tableName);
    if ((sysIds.length == 1) &amp;&amp; (sysIds[0] == "-1"))
      ajax.addParam("sysparm_default_query", this.tableController.query);
    if (this._buildIdList(ajax, sysIds, fields)) {
      this._waitForAjax(ajax, callback, 5000);
    } else
      callback();
  },
  loadDefaults: function(callback) {
    this.changes.clearDefaults();
    this.loadValues(["-1"], this.tableController.getFields(), callback);
  },
  loadTable: function(callback) {
    var ajax = new GlideAjax(this.PROCESSOR);
    ajax.addParam('sysparm_type', 'get_value');
    ajax.addParam('sysparm_table', this.tableController.tableName);
    ajax.addParam('sysparm_query', this.tableController.query);
    var fields = this.tableController.getFields();
    ajax.addParam("sysparm_fields", fields.join(','));
    this._waitForAjax(ajax, callback, 5000);
  },
  getErrorMsg: function() {
    return this.errorMsg;
  },
  _buildIdList: function(ajax, sysIds, fields) {
    var needFields = false;
    for (var i = 0; i &lt; sysIds.length; i++) {
      var id = sysIds[i];
      var fieldList = [];
      for (var j = 0; j &lt; fields.length; j++) {
        if (!this.changes.getField(id, fields[j]))
          fieldList.push(fields[j]);
      }
      if (fieldList.length &gt; 0) {
        needFields = true;
        ajax.addParam('sysparm_sys_id_' + id, fieldList.join(','));
      }
    }
    return needFields;
  },
  _waitForAjax: function(ajax, callback, timeout) {
    if (timeout &lt; 0)
      return;
    if (!this.ajax) {
      this.ajax = true;
      ajax.getXML(this._getValuesResponse.bind(this, callback));
    } else {
      setTimeout(this._waitForAjax.bind(this, ajax, callback), 10, timeout - 10);
    }
  },
  _getValuesResponse: function(callback, response) {
    this.ajax = false;
    if (!response || !response.responseXML) {
      this.errorMsg = getMessage("No response from server - try again later");
      callback();
      return;
    }
    var xml = response.responseXML;
    var items = xml.getElementsByTagName("item");
    for (var i = 0; i &lt; items.length; i++) {
      var item = items[i];
      var sysId = item.getAttribute("sys_id");
      this.generatedSysId = item.getAttribute("new_sys_id");
      var fieldList = item.getAttribute("field_list");
      var fields;
      if (fieldList)
        fields = fieldList.split(',');
      else
        fields = [];
      for (var j = 0; j &lt; fields.length; j++) {
        var n = fields[j];
        var fieldItem = this._getXMLFieldItem(item, n);
        if (!fieldItem)
          continue;
        var canWrite = true;
        if (fieldItem.getAttribute("can_write") == "false")
          canWrite = false;
        var mandatory = false;
        if (fieldItem.getAttribute("mandatory") == "true")
          mandatory = true;
        var okExtension = true;
        if (fieldItem.getAttribute("ok_extension") == "false")
          okExtension = false;
        if (!this.changes.getField(sysId, n)) {
          var f = this._addField(sysId, n);
          f.setInitialValues(this._getXMLValue(fieldItem, "value"), this._getXMLValue(fieldItem, "displayvalue"));
          f.setWritable(canWrite);
          f.setMandatory(mandatory);
          f.setOKExtension(okExtension);
          f.setLabel(fieldItem.getAttribute("label"));
        }
      }
    }
    this._clearErrorMsg();
    callback();
  },
  _getXMLFieldItem: function(parent, n) {
    for (var i = 0; i &lt; parent.childNodes.length; i++) {
      var item = parent.childNodes[i];
      if (item.nodeName.toLowerCase() == n)
        return item;
    }
    return null;
  },
  _getXMLValue: function(item, type) {
    var value = null;
    var e = item.getElementsByTagName(type);
    if (e &amp;&amp; e.length &gt; 0)
      value = getTextValue(e[0]);
    if (!value)
      value = "";
    return value;
  },
  _addField: function(sysId, field) {
    var record = this.changes.get(sysId);
    if (!record)
      record = this.changes.addRecord(sysId)
    return record.addField(field);
  },
  _clearErrorMsg: function() {
    this.errorMsg = "";
  },
  toString: function() {
    return 'GwtListEditAjaxValueLoader';
  }
});;
/*! RESOURCE: /scripts/GwtListEditRecordDecorations.js */
var GwtListEditRecordDecorations = Class.create({
  MSGS: [
    'Insert a new row...',
    'Mark record for List Action',
    'View',
    'Save',
    'Delete',
    'Display / hide hierarchical lists'
  ],
  initialize: function(changes, tableController) {
    this.changes = changes;
    this.tableController = tableController;
    this.msgs = getMessages(this.MSGS);
    this.updateTable();
  },
  updateTable: function() {
    this.currDecor = {};
    this.viewDecor = {};
    this.pendingDecor = {};
    this.editDecor = {};
    this.tableController.observe('glide:list_v2.edit.changes_saved', this._handleChangesSaved.bind(this));
    this.tableController.observe('glide:list_v2.edit.rows_deleted', this._handleRowsDeleted.bind(this));
    this.tableController.observe('glide:list_v2.edit.changes_deferred', this._handleChangesDeferred.bind(this));
  },
  showView: function(sysId) {
    if (!this.tableController.hasActions)
      return;
    var currDecor = this._getCurrDecor(sysId);
    var showDecor = this._getViewDecor(sysId);
    this._displayDecor(sysId, showDecor, currDecor);
    if (this._isDoctype())
      this._adjustView();
  },
  _adjustView: function() {
    var table = gel(this.tableController.listID + '_table');
    var popup = $j(table).find('td.list_decoration_cell a.list_popup').last();
    var row = popup.closest('tr');
    popup.detach();
    row.children(':eq(1)').empty().append(popup);
  },
  showPending: function(sysId) {
    var currDecor = this._getCurrDecor(sysId);
    var showDecor = this._getPendingDecor(sysId);
    this._displayDecor(sysId, showDecor, currDecor);
  },
  showEdit: function(sysId) {
    var currDecor = this._getCurrDecor(sysId);
    var showDecor = this._getEditDecor(sysId);
    this._displayDecor(sysId, showDecor, currDecor);
  },
  _displayDecor: function(sysId, showDecor, currDecor) {
    if (!showDecor)
      return;
    if (currDecor &amp;&amp; (currDecor !== showDecor))
      currDecor.hide();
    this.currDecor[sysId] = showDecor;
    showDecor.show();
  },
  resetSaveIcons: function() {
    var thisDecor = this;
    this.tableController.tableElementDOM.select("tr.list_row").each(function(elem) {
      var sys_id = elem.getAttribute("sys_id");
      if (sys_id &amp;&amp; (elem.hasClassName("list_add") || elem.down(".list_edit_dirty")) &amp;&amp; !elem.down("td.list_edit_new_row"))
        thisDecor.showPending(sys_id);
    });
  },
  resetPendingIcons: function() {
    var thisDecor = this;
    this.tableController.tableElementDOM.select("tr.list_row").each(function(elem) {
      var sys_id = elem.getAttribute("sys_id");
      if (sys_id &amp;&amp; (elem.hasClassName("list_add") || elem.down(".list_edit_dirty")) &amp;&amp; !elem.down("td.list_edit_new_row")) {
        var cell = thisDecor.tableController.getDecorationCell(sys_id);
        if (cell) {
          var existingImg = cell.select("img.list_popup");
          if (existingImg.length &gt; 0)
            existingImg[0].parentNode.removeChild(existingImg[0]);
        }
        thisDecor.showPending(sys_id);
      }
    });
  },
  _getCurrDecor: function(sysId) {
    var decor = this.currDecor[sysId];
    if (decor)
      return decor;
    var cell = this.tableController.getDecorationCell(sysId);
    decor = this._getServerViewDecorations(sysId, cell);
    if (decor) {
      this.viewDecor[sysId] = decor;
      this.currDecor[sysId] = decor;
      return decor;
    }
    return null;
  },
  _getViewDecor: function(sysId) {
    var decor = this.viewDecor[sysId];
    if (decor)
      return decor;
    var cell = this.tableController.getDecorationCell(sysId);
    if (!cell)
      return null;
    decor = this._getServerViewDecorations(sysId, cell);
    if (decor) {
      this.viewDecor[sysId] = decor;
      return decor;
    }
    decor = this._buildDecorationSpan(sysId, cell, 'view');
    this._addViewDecorations(sysId, decor);
    this.viewDecor[sysId] = decor;
    return decor;
  },
  _getPendingDecor: function(sysId) {
    var decor = this.pendingDecor[sysId];
    if (decor)
      return decor;
    var cell = this.tableController.getDecorationCell(sysId);
    cell = $(cell);
    if (cell.down("[icon_type='save']"))
      return;
    decor = this._buildDecorationSpan(sysId, cell, 'unsaved');
    var existingImg = cell.select("img.list_popup");
    this._addPendingDecorations(sysId, decor, existingImg);
    this.pendingDecor[sysId] = decor;
    return decor;
  },
  _getEditDecor: function(sysId) {
    var decor = this.editDecor[sysId];
    if (decor)
      return decor;
    var cell = this.tableController.getDecorationCell(sysId);
    decor = this._buildDecorationSpan(sysId, cell, 'edit');
    this._addEditDecorations(sysId, decor);
    this.editDecor[sysId] = decor;
    return decor;
  },
  _getServerViewDecorations: function(sysId, cell) {
    if (!cell)
      return null;
    var decor = cell.firstChild;
    if (!decor)
      return null;
    if (!Object.isElement(decor))
      return null;
    if ("SPAN" !== decor.tagName)
      return null;
    if (decor.id)
      return null;
    return $(decor);
  },
  _buildDecorationSpan: function(sysId, cell, label) {
    var decor = $(new Element("span", {
      'id': sysId + '_' + label,
      'class': 'list_decoration'
    }));
    decor.hide();
    cell.appendChild(decor);
    return decor;
  },
  _addEditDecorations: function(sysId, span) {
    if (this.tableController.isFormUI()) {
      this._addEmbeddedEditIcon(span);
      return;
    }
    this._addEditIcon(span);
  },
  _addViewDecorations: function(sysId, span) {
    if (this.tableController.isFormUI()) {
      this._addDeleteIcon(span, sysId);
      this._addSpacerIcon(span);
      this._addEmbeddedPopUp(span, sysId);
      return;
    }
    this._addCheckBox(span, sysId);
    if (this.tableController.hasShowableHierarchy())
      this._addHierarchyIcon(span, sysId);
    this._addPopUp(span, sysId);
  },
  _addPendingDecorations: function(sysId, span, existingImg) {
    if (this.tableController.isFormUI()) {
      if (this._isDoctype() &amp;&amp; this.changes.isUpdatedRow(sysId))
        return;
      this._addDeleteIcon(span, sysId);
      this._addSpacerIcon(span);
      if (existingImg &amp;&amp; existingImg.length &gt; 0 &amp;&amp; existingImg[0].parentElement)
        this._addEmbeddedPopupIcon(span, sysId, existingImg[0].parentElement);
      else
        this._addNewEmbeddedListIcon(span, sysId);
      return;
    }
    if (this.changes.isUpdatedRow(sysId)) {
      this._addCheckBox(span, sysId);
      if (this.tableController.hasShowableHierarchy())
        this._addHierarchyIcon(span, sysId);
      this._addSavePopUp(span, sysId);
      return;
    }
    this._addDeleteIcon(span, sysId);
    this._addSaveIcon(span, sysId);
  },
  _handleRowsDeleted: function(evt) {
    this.sortZebra();
  },
  _addEditIcon: function(span) {
    var o = {
      title: this.msgs['Insert a new row...']
    };
    span.insert(this._getTemplate("EDIT_ICON").evaluate(o));
  },
  _addCheckBox: function(span, sysId) {
    var o = {
      row_id: sysId,
      listId: this.tableController.listID,
      title: this.msgs['Mark record for List Action']
    };
    span.insert(this._getTemplate("LIST_CHECKBOX_ICON").evaluate(o));
  },
  _addPopUp: function(span, sysId) {
    var o = {
      row_id: sysId,
      table: this.tableController.tableName,
      title: this.msgs['View']
    };
    span.insert(this._getTemplate("POPUP_ICON").evaluate(o));
  },
  _addSavePopUp: function(span, sysId) {
    var o = {
      row_id: sysId,
      table: this.tableController.tableName,
      title: this.msgs['Save']
    };
    span.insert(this._getTemplate("SAVE_POPUP_ICON").evaluate(o));
  },
  _addDeleteIcon: function(span, sysId) {
    var o = {
      row_id: sysId,
      title: this.msgs['Delete'],
      listID: this.tableController.listID,
      dataType: "list2_delete_row"
    };
    span.insert(this._getTemplate("DELETE_ICON").evaluate(o));
  },
  _addEmbeddedEditIcon: function(span) {
    var o = {
      title: this.msgs['Insert a new row...']
    };
    span.insert(this._getTemplate("EMBEDDED_EDIT_ICON").evaluate(o));
  },
  _addEmbeddedPopUp: function(span, sysId) {
    var o = {
      row_id: sysId,
      table: this.tableController.tableName,
      title: this.msgs['View']
    };
    span.insert(this._getTemplate("EMBEDDED_POPUP_ICON").evaluate(o));
  },
  _addSaveIcon: function(span, sysId) {
    var o = {
      title: this.msgs['Save']
    };
    span.insert(this._getTemplate("SAVE_ICON").evaluate(o));
  },
  _addEmbeddedPopupIcon: function(span, sysId, elem) {
    var o = {
      row_id: sysId,
      table: this.tableController.tableName,
      title: this.msgs['Record Modified'],
      href: elem.href,
      dataType: "list2_popup",
      listID: this.tableController.listID
    };
    span.insert(this._getTemplate("EMBEDDED_MODIFIED_POPUP_ICON").evaluate(o));
  },
  _addNewEmbeddedListIcon: function(span, sysId) {
    var o = {
      title: this.msgs['New Record']
    };
    span.insert(this._getTemplate("EMBEDDED_LIST_NEW_ICON").evaluate(o));
  },
  _addHierarchyIcon: function(span, sysId) {
    var o = {
      title: this.msgs['Display / hide hierarchical lists']
    };
    span.insert(this._getTemplate("HIERARCHY_ICON").evaluate(o));
  },
  _addSpacerIcon: function(e) {
    e.insert(this._getTemplate("SPACER_ICON"));
  },
  _handleChangesSaved: function(evt) {
    if (evt.memo.listId !== this.tableController.listID)
      return;
    var saves = evt.memo.saves;
    for (i = 0; i &lt; saves.length; i++) {
      var saveId = saves[i];
      this.showView(saveId);
    }
    this.sortZebra();
  },
  _handleChangesDeferred: function(evt) {
    if (evt.memo.listId !== this.tableController.listID)
      return;
    var defers = evt.memo.defers;
    for (i = 0; i &lt; defers.length; i++) {
      var deferId = defers[i];
      this.showPending(deferId);
    }
    this.sortZebra();
  },
  sortZebra: function() {
    var flip = false;
    this.tableController.tableElementDOM.select("tr.list_row").each(function(row) {
      if (flip) {
        if (row.hasClassName("list_odd"))
          row.removeClassName("list_odd");
        if (!row.hasClassName("list_even"))
          row.addClassName("list_even");
      } else {
        if (row.hasClassName("list_even"))
          row.removeClassName("list_even");
        if (!row.hasClassName("list_odd"))
          row.addClassName("list_odd");
      }
      flip = !flip;
    });
  },
  _getTemplate: function(name) {
    var doctypeTempl = GwtListEditRecordDecorations.Templates[name + '_DOCTYPE'];
    if (this._isDoctype() &amp;&amp; doctypeTempl)
      return doctypeTempl;
    return GwtListEditRecordDecorations.Templates[name];
  },
  _isDoctype: function() {
    return document.documentElement.getAttribute('data-doctype');
  },
  toString: function() {
    return 'GwtListEditRecordDecorations';
  }
});
GwtListEditRecordDecorations.Templates = {
  DELETE_ICON: new Template(
    '&lt;img data-type="#{dataType}" data-list_id="#{listID}" width="16" height="16" src="images/delete_row.gifx"' +
    ' class="list_delete_row list_decoration clsshort button"' +
    ' title="#{title}"&gt;&lt;/img&gt;'
  ),
  SPACER_ICON: '&lt;img width="0" height="16" src="images/s.gifx" class="clsshort button"&gt;',
  NEW_ICON: new Template(
    '&lt;img src="images/new_row.gifx" width="12" height="12" class="clsshort button" title="#{title}"&gt;&lt;/img&gt;'),
  SAVE_ICON: new Template(
    '&lt;img icon_type="save" src="images/save.pngx" width="16" height="16" class="clsshort button list_decoration" title="#{title}"' +
    'onclick="editListSaveRow(this);" &gt;&lt;/img&gt;'),
  EMBEDDED_MODIFIED_POPUP_ICON: new Template(
    '&lt;a href="#{href}"&gt;' +
    '&lt;img icon_type="save" data-type="#{dataType}" data-list_id="#{listID}" class="list_popup list_decoration" title="#{title}" src="images/icons/hover_icon_dirty.gifx" height="16" width="16"&gt;' +
    '&lt;/a&gt;'),
  EMBEDDED_LIST_NEW_ICON: new Template('&lt;img src="images/dirty.gifx" width="16" height="16" class="clsshort button list_decoration" title="#{title}" &gt;&lt;/img&gt;'),
  SAVE_POPUP_ICON: new Template(
    '&lt;img src="images/save.pngx" width="16" height="16" class="list_popup list_decoration" title="#{title}"' +
    'onclick="editListSaveRow(this);" &gt;&lt;/img&gt;'),
  POPUP_ICON: new Template(
    '&lt;a href="#{table}.do?sys_id=#{row_id}&amp;amp;sysparm_view=&amp;amp;sysparm_record_target=#{table}&amp;amp;sysparm_record_list="&gt;' +
    '&lt;img icon_type="save" class="list_popup list_decoration" title="#{title}" src="images/icons/hover_icon.gifx" height="16" width="16"&gt;' +
    '&lt;/a&gt;'),
  LIST_CHECKBOX_ICON: new Template(
    '&lt;input class="list_checkbox checkbox" title="#{title}" type="checkbox" name="checkbox_#{listId}" id="checkbox_#{listId}_#{row_id}" /&gt;'),
  HIERARCHY_ICON: new Template(
    '&lt;img class="list_hier button" title="#{title}" src="images/list_v2_heir_hide.gifx" height="16" width="16"&gt;'
  ),
  EDIT_ICON: new Template(
    '&lt;img width="14" height="14" class="list_edit_image" title="#{title}" src="images/list_edit.pngx" /&gt;'
  ),
  EMBEDDED_POPUP_ICON: new Template(
    '&lt;a href="#{table}.do?sys_id=#{row_id}&amp;amp;sysparm_view=&amp;amp;sysparm_record_target=#{table}&amp;amp;sysparm_record_list="&gt;' +
    '&lt;img class="list_popup list_decoration" title="#{title}" src="images/icons/hover_icon.gifx" height="12" width="12"&gt;' +
    '&lt;/a&gt;'),
  EMBEDDED_EDIT_ICON: new Template(
    '&lt;img width="12" height="12" class="list_edit_image" title="#{title}" src="images/list_edit.pngx" /&gt;'
  ),
  EMBEDDED_EDIT_ICON_DOCTYPE: new Template(
    '&lt;i class="list_edit_image icon-add btn disabled" title="#{title}"&gt;' +
    '&lt;span class="sr-only"&gt;#{title}&lt;/span&gt;' +
    '&lt;/i&gt;'
  ),
  EMBEDDED_POPUP_ICON_DOCTYPE: new Template(
    '&lt;a href=#{table}.do?sys_id=#{row_id}&amp;amp;sysparm_view=&amp;amp;sysparm_record_target=#{table}&amp;amp;sysparm_record_list=" class="btn btn-icon icon-info list_popup" data-type="list2_popup" data-list_id="$[sysparm_list_id]" title="#{title}" style="margin-left:0px"&gt;' +
    '&lt;span class="sr-only"&gt;#{title}&lt;/span&gt;' +
    '&lt;/a&gt;'),
  EDIT_ICON_DOCTYPE: new Template(
    '&lt;i class="list_edit_image icon-add btn disabled" title="#{title}"&gt;' +
    '&lt;span class="sr-only"&gt;#{title}&lt;/span&gt;' +
    '&lt;/i&gt;'
  ),
  POPUP_ICON_DOCTYPE: new Template(
    '&lt;a href=#{table}.do?sys_id=#{row_id}&amp;amp;sysparm_view=&amp;amp;sysparm_record_target=#{table}&amp;amp;sysparm_record_list=" class="btn btn-icon table-btn-lg icon-info list_popup" data-type="list2_popup" data-list_id="$[sysparm_list_id]" title="#{title}" style="margin-left:0px"&gt;' +
    '&lt;span class="sr-only"&gt;#{title}&lt;/span&gt;' +
    '&lt;/a&gt;'),
  DELETE_ICON_DOCTYPE: new Template(
    '&lt;i data-type="#{dataType}" data-list_id="#{listID}" class="list_delete_row list_decoration clsshort button icon-cross btn" title="#{title}" style="color:#FF402C"&gt;&lt;/i&gt;'
  ),
  EMBEDDED_LIST_NEW_ICON_DOCTYPE: new Template(
    '&lt;i class="list_edit_image btn icon-edit disabled" title="#{title}"&gt;' +
    '&lt;span class="sr-only"&gt;#{title}&lt;/span&gt;' +
    '&lt;/i&gt;'
  ),
  LIST_CHECKBOX_ICON_DOCTYPE: new Template(
    '&lt;span class="input-group-checkbox"&gt;' +
    '&lt;input type="checkbox"' +
    '		title="#{title}"' +
    '		id="check_#{listId}_#{row_id}"' +
    '		name="check_#{listId}"' +
    '		class="list_checkbox checkbox"' +
    '		data-type="list2_checkbox"' +
    '		data-list_id="#{listId}" /&gt;' +
    '&lt;label class="checkbox-label" for="check_#{listId}_#{row_id}"&gt;' +
    '&lt;span class="sr-only"&gt;Select record for action&lt;/span&gt;' +
    '&lt;/label&gt;' +
    '&lt;/span&gt;')
};;
/*! RESOURCE: /scripts/GwtListEditValueRenderer.js */
var GwtListEditValueRenderer = Class.create({
      MSGS: [
        'Insert a new row...',
        'Undelete',
        'Mark deleted',
        'Loading...',
        'A new {0} identified by {1} will be created upon save'
      ],
      initialize: function(changes, tableController) {
        this.changes = changes;
        this.tableController = tableController;
        this.gList = new GwtListEditGList(this.changes, this.tableController, this);
        this.decor = new GwtListEditRecordDecorations(this.changes, this.tableController);
        this.emptyRecord = null;
        this.msgs = getMessages(this.MSGS);
      },
      updateTable: function() {
        this.decor.updateTable();
      },
      setValue: function(sysId, fieldName, value) {
        if (this.changes.isEmptyRecord(sysId))
          this._saveEmptyRecord(sysId);
        return this.changes.setValue(sysId, fieldName, value, this._callOnChange.bind(this));
      },
      setDisplayValue: function(sysId, fieldName, value) {
        if (this.changes.isEmptyRecord(sysId))
          this._saveEmptyRecord(sysId);
        return this.changes.setDisplayValue(sysId, fieldName, value, this._callOnChange.bind(this));
      },
      addRow: function() {
        if (GlideLists2[this.tableController.listID] &amp;&amp; GlideLists2[this.tableController.listID].disableRowAdd)
          return;
        this.addRowWithValues({}, {});
      },
      addRowWithValues: function(values, displayValues) {
        if (GlideLists2[this.tableController.listID] &amp;&amp; GlideLists2[this.tableController.listID].disableRowAdd)
          return;
        var adder = this._addRowHandler.bind(this, values, displayValues);
        this.changes.loadDefaults(adder);
      },
      _addRowHandler: function(values, displayValues) {
        var sysId = this._generateId();
        var record = this.changes.addRecord(sysId, "add");
        this.changes.setDefaults(record);
        this._populateFields(record, values, displayValues);
        this.insertRowForRecord(record);
        this.changes.addToAggregates(record);
      },
      _populateFields: function(record, values, displayValues) {
        for (var v in values) {
          var field = record.addField(v);
          field.setValue(values[v]);
        }
        for (var v in displayValues) {
          var field = record.addField(v);
          field.setDisplayValue(displayValues[v]);
        }
      },
      addRowNoInsert: function() {
        if (!this.tableController.canCreate)
          return;
        if (GlideLists2[this.tableController.listID] &amp;&amp; GlideLists2[this.tableController.listID].disableRowAdd)
          return;
        if (!this.emptyRecord) {
          this.changes.loadDefaults(this._addRowNoInsertHandler.bind(this));
          return;
        }
        this.insertRowForRecord(this.emptyRecord);
        this.decor.showEdit(this.emptyRecord.sysId);
      },
      _addRowNoInsertHandler: function() {
        if (!this.emptyRecord) {
          var sysId = this._generateId();
          this.emptyRecord = this.changes.addEmptyRecord(sysId);
        }
        this.changes.setDefaults(this.emptyRecord);
        this.insertRowForRecord(this.emptyRecord);
        this.decor.showEdit(this.emptyRecord.sysId);
      },
      renderValue: function(sysId, fieldName, valueToDisplay, newRow) {
        var cell = this.tableController.getCell(sysId, fieldName);
        if (!cell)
          return;
        var cellIndex = document.documentElement.getAttribute('data-doctype') == 'true' ? 2 : 1;
        var dspValue = this._getValueToRender(sysId, fieldName, valueToDisplay);
        if (newRow &amp;&amp; (cellIndex === cell.cellIndex) &amp;&amp; ("" === dspValue)) {
          dspValue = this.msgs['Insert a new row...'];
          cell.addClassName("list_edit_new_row");
        }
        this._renderContents(cell, sysId, fieldName, dspValue, newRow);
        this._markChangedField(cell, sysId, fieldName);
      },
      _renderContents: function(cell, sysId, fieldName, dspValue, newRow) {
        if (dspValue)
          dspValue = dspValue.escapeHTML();
        if (!newRow &amp;&amp; this.tableController.isFirstField(fieldName)) {
          var linkLabel = this._getLinkLabel(cell);
          if (linkLabel) {
            linkLabel.nodeValue = dspValue;
            return;
          }
        }
        var doctypeMode = document.documentElement.getAttribute('data-doctype') == 'true';
        cell.innerHTML = "";
        var fieldElement = this.tableController.getFieldElement(fieldName);
        if (fieldElement.isReference()) {
          var referenceValue = this.changes.getValue(sysId, fieldName);
          if (referenceValue) {
            if ('NULL' === referenceValue) {
              if (!hasClassName(cell, "list_edit_new_row"))
                dspValue = '';
            } else if (!this.changes.isReferenceValid(sysId, fieldName)) {
              if (fieldElement.isDynamicCreation()) {
                var o = {
                  sys_id: referenceValue,
                  display: dspValue,
                  title: new GwtMessage().format(
                    this.msgs['A new {0} identified by {1} will be created upon save.'],
                    fieldElement.getRefLabel(), referenceValue)
                };
                var dynamicTemplate = doctypeMode ?
                  GwtListEditValueRenderer.Templates.RENDER_DYNAMIC_REFERENCE_DOCTYPE :
                  GwtListEditValueRenderer.Templates.RENDER_DYNAMIC_REFERENCE
                cell.insert(dynamicTemplate.evaluate(o));
                return;
              }
              dspValue = '';
            } else {
              if (this.tableController.omitLinks == false) {
                var o = {
                  sys_id: referenceValue,
                  refKey: fieldElement.refKey,
                  display: dspValue,
                  href: fieldElement.reference
                };
                var template = doctypeMode ?
                  GwtListEditValueRenderer.Templates.RENDER_REFERENCE_DOCTYPE :
                  GwtListEditValueRenderer.Templates.RENDER_REFERENCE
                cell.insert(template.evaluate(o));
                return;
              }
            }
          }
        }
        var defaultTemplate = doctypeMode ? GwtListEditValueRenderer.Templates.RENDER_DEFAULT_DOCTYPE : GwtListEditValueRenderer.Templates.RENDER_DEFAULT;
        cell.insert(defaultTemplate.evaluate({
          display: dspValue
        }));
      },
      _getLinkLabel: function(cell) {
        if (!cell)
          return null;
        if (!cell.firstChild)
          return null;
        var child = cell.down('a.linked') || cell.firstChild;
        return child.firstChild;
      },
      _getValueToRender: function(sysId, fieldName, valueToDisplay) {
        if (valueToDisplay)
          return valueToDisplay;
        return this.changes.getValueToRender(sysId, fieldName);
      },
      _saveEmptyRecord: function(id) {
        var record = this.changes.saveEmptyRecord(id);
        var sysId = this.tableController.getRelatedSysID();
        if (sysId)
          this.changes.addField(id, this.tableController.relatedField, sysId);
        var tr = $(id);
        if (tr) {
          this._removeAddRowClassName(tr);
          this._resetBackgroundColor(tr);
        }
        this.updateRowWithRecord(record);
        this.changes.addToAggregates(record);
        this.emptyRecord = null;
        this.addRowNoInsert();
      },
      insertRowForRecord: function(record) {
        var isNew = record.isNew();
        this.tableController.buildRow(record.sysId);
        this.changes.rowCountChanged(1);
        var fields = record.getFields();
        for (var n in fields)
          this.renderValue(record.sysId, n, "", isNew);
        var info = {
          listId: this.tableController.listID,
          sys_id: record.sysId
        };
        this.tableController.fire('glide:list_v2.edit.row_added', info);
      },
      showViewDecorations: function(sysId) {
        this.decor.showView(sysId);
      },
      isDoctype: function() {
        return document.documentElement.getAttribute('data-doctype') == 'true';
      },
      updateRowWithRecord: function(record) {
        var fields = record.getFields();
        for (var n in fields) {
          this.renderValue(record.sysId, n);
          var field = fields[n];
          if (field.isDisplayValueSet())
            this.changes.updateAggregates(n, field.getOriginalDisplay(), field.getDisplayValue());
          else if (field.isValueSet())
            this.changes.updateAggregates(n, field.getOriginalValue(), field.getValue());
        }
      },
      deleteRowWithRecord: function(record) {
        var sysId = record.sysId;
        var tr = this.tableController.getRow(sysId);
        if (tr) {
          if (!hasClassName(tr, "list_delete"))
            GwtListEditTableController.addClassToRow(tr, "list_delete");
          var img = tr.select('.list_delete_row')[0];
          img.src = "images/undelete_row.gifx";
          writeTitle(img, this.msgs['Undelete']);
          if (this.isDoctype())
            img.setStyle({
              color: '#cfcfcf'
            });
        }
        this.changes.removeFromAggregates(record);
      },
      deleteRowToggle: function(sysId) {
        var record = this.changes.get(sysId);
        if (record &amp;&amp; record.operation == "delete_pending")
          return;
        if (!record)
          record = this.changes.addRecord(sysId, "delete_pending");
        if (this.tableController.isFormUI())
          g_form.fieldChanged("delete_row", true);
        if (record.operation == "delete") {
          this._undeleteRow(record);
          var tr = this.tableController.getRow(sysId);
          if (tr) {
            GwtListEditTableController.removeClassFromRow(tr, "list_delete");
            var img = tr.select('.list_delete_row')[0];
            img.src = "images/delete_row.gifx";
            writeTitle(img, this.msgs['Mark deleted']);
            if (this.isDoctype())
              img.setStyle({
                color: '#FF402C'
              })
          }
        } else if (record.operation == "add") {
          this.tableController.deleteRow(sysId);
          this.changes.remove(sysId);
          this.changes.rowCountChanged(-1);
          this.changes.removeFromAggregates(record);
          var info = {
            listId: this.tableController.listID,
            deletes: [sysId]
          };
          this.tableController.fire('glide:list_v2.edit.rows_deleted', info);
        } else {
          record.operation = "delete_pending";
          if (img) {
            img.src = "images/loading_anim2.gifx";
            img.alt = this.msgs['Loading...'];
          }
          var tr = this.tableController.getRow(sysId);
          if (tr) {
            GwtListEditTableController.addClassToRow(tr, "list_delete");
            var img = tr.select('.list_delete_row')[0];
            img.src = "images/loading_anim2.gifx";
            writeTitle(img, this.msgs['Loading...']);
          }
          this.changes.loadValues([sysId], this.changes.getAggregateFields(), this._deleteRowHandler.bind(this, sysId));
        }
      },
      _deleteRowHandler: function(sysId) {
        var record = this.changes.get(sysId);
        if (!record)
          return;
        record.setOperation("delete");
        this.deleteRowWithRecord(record);
      },
      _undeleteRow: function(record) {
        record.setOperation("update");
        this.changes.addToAggregates(record);
      },
      _generateId: function() {
          var aj = new GlideAjax("GlideSystemAjax");
          aj.addParam("sysparm_na</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
