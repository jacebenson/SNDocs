<!DOCTYPE html>

<html>
<head>
  <title>AttachmentUploader.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="AJAXCompleter.html">
                  AJAXCompleter.js
                </a>
              
                
                <a class="source" href="AJAXEmailClientCompleter.html">
                  AJAXEmailClientCompleter.js
                </a>
              
                
                <a class="source" href="AJAXOtherCompleter.html">
                  AJAXOtherCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceChoice.html">
                  AJAXReferenceChoice.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleter.html">
                  AJAXReferenceCompleter.js
                </a>
              
                
                <a class="source" href="AJAXReferenceCompleterMulti.html">
                  AJAXReferenceCompleterMulti.js
                </a>
              
                
                <a class="source" href="AJAXReferenceControls.html">
                  AJAXReferenceControls.js
                </a>
              
                
                <a class="source" href="AJAXTableCompleter.html">
                  AJAXTableCompleter.js
                </a>
              
                
                <a class="source" href="AttachmentUploader.html">
                  AttachmentUploader.js
                </a>
              
                
                <a class="source" href="AutoComplete.html">
                  AutoComplete.js
                </a>
              
                
                <a class="source" href="BoundsUtil2.html">
                  BoundsUtil2.js
                </a>
              
                
                <a class="source" href="CookieJar.html">
                  CookieJar.js
                </a>
              
                
                <a class="source" href="CustomEventManager.html">
                  CustomEventManager.js
                </a>
              
                
                <a class="source" href="DaysOfWeekElement.html">
                  DaysOfWeekElement.js
                </a>
              
                
                <a class="source" href="DerivedFields.html">
                  DerivedFields.js
                </a>
              
                
                <a class="source" href="Draggable2.html">
                  Draggable2.js
                </a>
              
                
                <a class="source" href="DropTarget2.html">
                  DropTarget2.js
                </a>
              
                
                <a class="source" href="FieldListElement.html">
                  FieldListElement.js
                </a>
              
                
                <a class="source" href="GlideAPI1.html">
                  GlideAPI1.js
                </a>
              
                
                <a class="source" href="GlideAjax.html">
                  GlideAjax.js
                </a>
              
                
                <a class="source" href="GlideAjaxForm.html">
                  GlideAjaxForm.js
                </a>
              
                
                <a class="source" href="GlideBox.html">
                  GlideBox.js
                </a>
              
                
                <a class="source" href="GlideClientCache.html">
                  GlideClientCache.js
                </a>
              
                
                <a class="source" href="GlideDecoration.html">
                  GlideDecoration.js
                </a>
              
                
                <a class="source" href="GlideDialogForm.html">
                  GlideDialogForm.js
                </a>
              
                
                <a class="source" href="GlideDialogWindow.html">
                  GlideDialogWindow.js
                </a>
              
                
                <a class="source" href="GlideDraggable.html">
                  GlideDraggable.js
                </a>
              
                
                <a class="source" href="GlideDuration.html">
                  GlideDuration.js
                </a>
              
                
                <a class="source" href="GlideEvent.html">
                  GlideEvent.js
                </a>
              
                
                <a class="source" href="GlideEventHandler.html">
                  GlideEventHandler.js
                </a>
              
                
                <a class="source" href="GlideFilter14.html">
                  GlideFilter14.js
                </a>
              
                
                <a class="source" href="GlideFilterDate.html">
                  GlideFilterDate.js
                </a>
              
                
                <a class="source" href="GlideFilterDescription.html">
                  GlideFilterDescription.js
                </a>
              
                
                <a class="source" href="GlideFilterHandlers.html">
                  GlideFilterHandlers.js
                </a>
              
                
                <a class="source" href="GlideFilterItemVariables.html">
                  GlideFilterItemVariables.js
                </a>
              
                
                <a class="source" href="GlideFilterLabels.html">
                  GlideFilterLabels.js
                </a>
              
                
                <a class="source" href="GlideFilterQuestions.html">
                  GlideFilterQuestions.js
                </a>
              
                
                <a class="source" href="GlideFilterReference.html">
                  GlideFilterReference.js
                </a>
              
                
                <a class="source" href="GlideFilterReferenceMulti.html">
                  GlideFilterReferenceMulti.js
                </a>
              
                
                <a class="source" href="GlideFilterVariables.html">
                  GlideFilterVariables.js
                </a>
              
                
                <a class="source" href="GlideForm14.html">
                  GlideForm14.js
                </a>
              
                
                <a class="source" href="GlideHeaderSearch.html">
                  GlideHeaderSearch.js
                </a>
              
                
                <a class="source" href="GlideList2.html">
                  GlideList2.js
                </a>
              
                
                <a class="source" href="GlideList2FilterUtil.html">
                  GlideList2FilterUtil.js
                </a>
              
                
                <a class="source" href="GlideList2Handlers.html">
                  GlideList2Handlers.js
                </a>
              
                
                <a class="source" href="GlideList2InitEvents.html">
                  GlideList2InitEvents.js
                </a>
              
                
                <a class="source" href="GlideListAggregates.html">
                  GlideListAggregates.js
                </a>
              
                
                <a class="source" href="GlideListEditor.html">
                  GlideListEditor.js
                </a>
              
                
                <a class="source" href="GlideListEditorMessaging.html">
                  GlideListEditorMessaging.js
                </a>
              
                
                <a class="source" href="GlideListElement.html">
                  GlideListElement.js
                </a>
              
                
                <a class="source" href="GlideModal.html">
                  GlideModal.js
                </a>
              
                
                <a class="source" href="GlideModalForm.html">
                  GlideModalForm.js
                </a>
              
                
                <a class="source" href="GlideNavigation.html">
                  GlideNavigation.js
                </a>
              
                
                <a class="source" href="GlideOverlay.html">
                  GlideOverlay.js
                </a>
              
                
                <a class="source" href="GlidePane.html">
                  GlidePane.js
                </a>
              
                
                <a class="source" href="GlidePaneForm.html">
                  GlidePaneForm.js
                </a>
              
                
                <a class="source" href="GlideRecord.html">
                  GlideRecord.js
                </a>
              
                
                <a class="source" href="GlideTabs2.html">
                  GlideTabs2.js
                </a>
              
                
                <a class="source" href="GlideTabs2State.html">
                  GlideTabs2State.js
                </a>
              
                
                <a class="source" href="GlideTabs2Tab.html">
                  GlideTabs2Tab.js
                </a>
              
                
                <a class="source" href="GlideTimeElement.html">
                  GlideTimeElement.js
                </a>
              
                
                <a class="source" href="GlideTimerElement.html">
                  GlideTimerElement.js
                </a>
              
                
                <a class="source" href="GlideTransactionScope.html">
                  GlideTransactionScope.js
                </a>
              
                
                <a class="source" href="GlideUI.html">
                  GlideUI.js
                </a>
              
                
                <a class="source" href="GlideUIDefault.html">
                  GlideUIDefault.js
                </a>
              
                
                <a class="source" href="GlideUIElement.html">
                  GlideUIElement.js
                </a>
              
                
                <a class="source" href="GlideUINotification.html">
                  GlideUINotification.js
                </a>
              
                
                <a class="source" href="GlideURL.html">
                  GlideURL.js
                </a>
              
                
                <a class="source" href="GlideURLElement.html">
                  GlideURLElement.js
                </a>
              
                
                <a class="source" href="GlideUser.html">
                  GlideUser.js
                </a>
              
                
                <a class="source" href="GlideUserImageElement.html">
                  GlideUserImageElement.js
                </a>
              
                
                <a class="source" href="GlideWidgetFilter.html">
                  GlideWidgetFilter.js
                </a>
              
                
                <a class="source" href="GlideWidgetHideOnEmpty.html">
                  GlideWidgetHideOnEmpty.js
                </a>
              
                
                <a class="source" href="GlideWidgetSearch.html">
                  GlideWidgetSearch.js
                </a>
              
                
                <a class="source" href="GlideWidgetVCR.html">
                  GlideWidgetVCR.js
                </a>
              
                
                <a class="source" href="GlideWindow.html">
                  GlideWindow.js
                </a>
              
                
                <a class="source" href="GuidedTourElementTranslator.html">
                  GuidedTourElementTranslator.js
                </a>
              
                
                <a class="source" href="GwtCellEditor.html">
                  GwtCellEditor.js
                </a>
              
                
                <a class="source" href="GwtCellSelector.html">
                  GwtCellSelector.js
                </a>
              
                
                <a class="source" href="GwtContextMenu.html">
                  GwtContextMenu.js
                </a>
              
                
                <a class="source" href="GwtDate.html">
                  GwtDate.js
                </a>
              
                
                <a class="source" href="GwtDraggable.html">
                  GwtDraggable.js
                </a>
              
                
                <a class="source" href="GwtDraggableSnap.html">
                  GwtDraggableSnap.js
                </a>
              
                
                <a class="source" href="GwtExportScheduleDialog.html">
                  GwtExportScheduleDialog.js
                </a>
              
                
                <a class="source" href="GwtGridEdit.html">
                  GwtGridEdit.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxChangeSaver.html">
                  GwtListEditAjaxChangeSaver.js
                </a>
              
                
                <a class="source" href="GwtListEditAjaxValueLoader.html">
                  GwtListEditAjaxValueLoader.js
                </a>
              
                
                <a class="source" href="GwtListEditBoolean.html">
                  GwtListEditBoolean.js
                </a>
              
                
                <a class="source" href="GwtListEditCalendar.html">
                  GwtListEditCalendar.js
                </a>
              
                
                <a class="source" href="GwtListEditDependent.html">
                  GwtListEditDependent.js
                </a>
              
                
                <a class="source" href="GwtListEditDuration.html">
                  GwtListEditDuration.js
                </a>
              
                
                <a class="source" href="GwtListEditEncryptedText.html">
                  GwtListEditEncryptedText.js
                </a>
              
                
                <a class="source" href="GwtListEditGList.html">
                  GwtListEditGList.js
                </a>
              
                
                <a class="source" href="GwtListEditGlideRecord.html">
                  GwtListEditGlideRecord.js
                </a>
              
                
                <a class="source" href="GwtListEditGridSelector.html">
                  GwtListEditGridSelector.js
                </a>
              
                
                <a class="source" href="GwtListEditInternalType.html">
                  GwtListEditInternalType.js
                </a>
              
                
                <a class="source" href="GwtListEditJournal.html">
                  GwtListEditJournal.js
                </a>
              
                
                <a class="source" href="GwtListEditPassword.html">
                  GwtListEditPassword.js
                </a>
              
                
                <a class="source" href="GwtListEditRecordDecorations.html">
                  GwtListEditRecordDecorations.js
                </a>
              
                
                <a class="source" href="GwtListEditReference.html">
                  GwtListEditReference.js
                </a>
              
                
                <a class="source" href="GwtListEditRelatedTags.html">
                  GwtListEditRelatedTags.js
                </a>
              
                
                <a class="source" href="GwtListEditSavePolicy.html">
                  GwtListEditSavePolicy.js
                </a>
              
                
                <a class="source" href="GwtListEditSelect.html">
                  GwtListEditSelect.js
                </a>
              
                
                <a class="source" href="GwtListEditTableController.html">
                  GwtListEditTableController.js
                </a>
              
                
                <a class="source" href="GwtListEditText.html">
                  GwtListEditText.js
                </a>
              
                
                <a class="source" href="GwtListEditTranslatedField.html">
                  GwtListEditTranslatedField.js
                </a>
              
                
                <a class="source" href="GwtListEditUpdateTablename.html">
                  GwtListEditUpdateTablename.js
                </a>
              
                
                <a class="source" href="GwtListEditValueRenderer.html">
                  GwtListEditValueRenderer.js
                </a>
              
                
                <a class="source" href="GwtListEditWindow.html">
                  GwtListEditWindow.js
                </a>
              
                
                <a class="source" href="GwtListEditor.html">
                  GwtListEditor.js
                </a>
              
                
                <a class="source" href="GwtListEditorPendingChanges.html">
                  GwtListEditorPendingChanges.js
                </a>
              
                
                <a class="source" href="GwtMessage14.html">
                  GwtMessage14.js
                </a>
              
                
                <a class="source" href="GwtObservable.html">
                  GwtObservable.js
                </a>
              
                
                <a class="source" href="GwtPollDialog.html">
                  GwtPollDialog.js
                </a>
              
                
                <a class="source" href="InPlaceEdit.html">
                  InPlaceEdit.js
                </a>
              
                
                <a class="source" href="ListDraggableRow2.html">
                  ListDraggableRow2.js
                </a>
              
                
                <a class="source" href="ListSelectManager2.html">
                  ListSelectManager2.js
                </a>
              
                
                <a class="source" href="ListSortDual2.html">
                  ListSortDual2.js
                </a>
              
                
                <a class="source" href="ListSortWindow2.html">
                  ListSortWindow2.js
                </a>
              
                
                <a class="source" href="NOW.messaging.html">
                  NOW.messaging.js
                </a>
              
                
                <a class="source" href="NOW.messaging.record.html">
                  NOW.messaging.record.js
                </a>
              
                
                <a class="source" href="NameMapEntry.html">
                  NameMapEntry.js
                </a>
              
                
                <a class="source" href="NotificationMessage.html">
                  NotificationMessage.js
                </a>
              
                
                <a class="source" href="PageTiming14.html">
                  PageTiming14.js
                </a>
              
                
                <a class="source" href="PersonalizeForm.html">
                  PersonalizeForm.js
                </a>
              
                
                <a class="source" href="Point.html">
                  Point.js
                </a>
              
                
                <a class="source" href="SLARepairClient.html">
                  SLARepairClient.js
                </a>
              
                
                <a class="source" href="ScriptLoader.html">
                  ScriptLoader.js
                </a>
              
                
                <a class="source" href="Select.html">
                  Select.js
                </a>
              
                
                <a class="source" href="SlushBucket.html">
                  SlushBucket.js
                </a>
              
                
                <a class="source" href="SortDraggable2.html">
                  SortDraggable2.js
                </a>
              
                
                <a class="source" href="SortListManager2.html">
                  SortListManager2.js
                </a>
              
                
                <a class="source" href="SortUtil2.html">
                  SortUtil2.js
                </a>
              
                
                <a class="source" href="StopWatch.html">
                  StopWatch.js
                </a>
              
                
                <a class="source" href="Table.html">
                  Table.js
                </a>
              
                
                <a class="source" href="TableElement.html">
                  TableElement.js
                </a>
              
                
                <a class="source" href="TableExtension.html">
                  TableExtension.js
                </a>
              
                
                <a class="source" href="TemplateRecord.html">
                  TemplateRecord.js
                </a>
              
                
                <a class="source" href="TextAreaElement.html">
                  TextAreaElement.js
                </a>
              
                
                <a class="source" href="UserRolesElement.html">
                  UserRolesElement.js
                </a>
              
                
                <a class="source" href="UtilityAndOverrides2.html">
                  UtilityAndOverrides2.js
                </a>
              
                
                <a class="source" href="_module.html">
                  _module.js
                </a>
              
                
                <a class="source" href="ac.html">
                  ac.js
                </a>
              
                
                <a class="source" href="ac_derived_field_support.html">
                  ac_derived_field_support.js
                </a>
              
                
                <a class="source" href="accessibility_tabindex.html">
                  accessibility_tabindex.js
                </a>
              
                
                <a class="source" href="affix.html">
                  affix.js
                </a>
              
                
                <a class="source" href="alert.html">
                  alert.js
                </a>
              
                
                <a class="source" href="amb.Channel.html">
                  amb.Channel.js
                </a>
              
                
                <a class="source" href="amb.ChannelRedirect.html">
                  amb.ChannelRedirect.js
                </a>
              
                
                <a class="source" href="amb.Logger.html">
                  amb.Logger.js
                </a>
              
                
                <a class="source" href="amb.MessageClient.html">
                  amb.MessageClient.js
                </a>
              
                
                <a class="source" href="amb.ServerConnection.html">
                  amb.ServerConnection.js
                </a>
              
                
                <a class="source" href="amb_initialize.html">
                  amb_initialize.js
                </a>
              
                
                <a class="source" href="amb_properties.html">
                  amb_properties.js
                </a>
              
                
                <a class="source" href="annotations_toggle.html">
                  annotations_toggle.js
                </a>
              
                
                <a class="source" href="app.form_presence.html">
                  app.form_presence.js
                </a>
              
                
                <a class="source" href="app_guided_tours.html">
                  app_guided_tours.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="calendar.html">
                  calendar.js
                </a>
              
                
                <a class="source" href="carousel.html">
                  carousel.js
                </a>
              
                
                <a class="source" href="collapse.html">
                  collapse.js
                </a>
              
                
                <a class="source" href="cometd.html">
                  cometd.js
                </a>
              
                
                <a class="source" href="condition14_new.html">
                  condition14_new.js
                </a>
              
                
                <a class="source" href="condition14_reporting.html">
                  condition14_reporting.js
                </a>
              
                
                <a class="source" href="condition14_templates.html">
                  condition14_templates.js
                </a>
              
                
                <a class="source" href="condition_global_variables14.html">
                  condition_global_variables14.js
                </a>
              
                
                <a class="source" href="constants_embedded_help.html">
                  constants_embedded_help.js
                </a>
              
                
                <a class="source" href="context_actions.html">
                  context_actions.js
                </a>
              
                
                <a class="source" href="controller.guidedTours.html">
                  controller.guidedTours.js
                </a>
              
                
                <a class="source" href="deferred_related_lists.html">
                  deferred_related_lists.js
                </a>
              
                
                <a class="source" href="depends.html">
                  depends.js
                </a>
              
                
                <a class="source" href="directive.snBindPopoverSelection.html">
                  directive.snBindPopoverSelection.js
                </a>
              
                
                <a class="source" href="directive.snComplexPopover.html">
                  directive.snComplexPopover.js
                </a>
              
                
                <a class="source" href="dropdown.html">
                  dropdown.js
                </a>
              
                
                <a class="source" href="dropdowns.html">
                  dropdowns.js
                </a>
              
                
                <a class="source" href="email_activity.html">
                  email_activity.js
                </a>
              
                
                <a class="source" href="event_initialize.html">
                  event_initialize.js
                </a>
              
                
                <a class="source" href="fixedHeaders.html">
                  fixedHeaders.js
                </a>
              
                
                <a class="source" href="form_submitted_mask.html">
                  form_submitted_mask.js
                </a>
              
                
                <a class="source" href="form_tags.html">
                  form_tags.js
                </a>
              
                
                <a class="source" href="formatting.html">
                  formatting.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="functions_attachments.html">
                  functions_attachments.js
                </a>
              
                
                <a class="source" href="functions_bootstrap14.html">
                  functions_bootstrap14.js
                </a>
              
                
                <a class="source" href="functions_calendar.html">
                  functions_calendar.js
                </a>
              
                
                <a class="source" href="functions_clipboard.html">
                  functions_clipboard.js
                </a>
              
                
                <a class="source" href="functions_email.html">
                  functions_email.js
                </a>
              
                
                <a class="source" href="functions_fontsizer.html">
                  functions_fontsizer.js
                </a>
              
                
                <a class="source" href="functions_onchange.html">
                  functions_onchange.js
                </a>
              
                
                <a class="source" href="functions_reference.html">
                  functions_reference.js
                </a>
              
                
                <a class="source" href="functions_showloading.html">
                  functions_showloading.js
                </a>
              
                
                <a class="source" href="functions_user_image.html">
                  functions_user_image.js
                </a>
              
                
                <a class="source" href="glide-highcharts-v5.html">
                  glide-highcharts-v5.js
                </a>
              
                
                <a class="source" href="guided_tours_template.html">
                  guided_tours_template.js
                </a>
              
                
                <a class="source" href="heisenberg_all.html">
                  heisenberg_all.js
                </a>
              
                
                <a class="source" href="jquery-1.11.0_no_conflict.html">
                  jquery-1.11.0_no_conflict.js
                </a>
              
                
                <a class="source" href="jquery.cometd.html">
                  jquery.cometd.js
                </a>
              
                
                <a class="source" href="jquery_clean.html">
                  jquery_clean.js
                </a>
              
                
                <a class="source" href="jquery_includes.html">
                  jquery_includes.js
                </a>
              
                
                <a class="source" href="js_guided_tours_includes.html">
                  js_guided_tours_includes.js
                </a>
              
                
                <a class="source" href="js_includes_amb.html">
                  js_includes_amb.js
                </a>
              
                
                <a class="source" href="js_includes_customer.html">
                  js_includes_customer.js
                </a>
              
                
                <a class="source" href="js_includes_doctype.html">
                  js_includes_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_form_presence.html">
                  js_includes_form_presence.js
                </a>
              
                
                <a class="source" href="js_includes_last_doctype.html">
                  js_includes_last_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_list_edit_doctype.html">
                  js_includes_list_edit_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_listv2_doctype.html">
                  js_includes_listv2_doctype.js
                </a>
              
                
                <a class="source" href="js_includes_sorting_new.html">
                  js_includes_sorting_new.js
                </a>
              
                
                <a class="source" href="js_includes_ui_popover.html">
                  js_includes_ui_popover.js
                </a>
              
                
                <a class="source" href="list_filter.html">
                  list_filter.js
                </a>
              
                
                <a class="source" href="magellan.CreateFavoriteModal.html">
                  magellan.CreateFavoriteModal.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="modals.html">
                  modals.js
                </a>
              
                
                <a class="source" href="newtag-it.html">
                  newtag-it.js
                </a>
              
                
                <a class="source" href="popover.html">
                  popover.js
                </a>
              
                
                <a class="source" href="popovers.html">
                  popovers.js
                </a>
              
                
                <a class="source" href="popupdivs14.html">
                  popupdivs14.js
                </a>
              
                
                <a class="source" href="popups.html">
                  popups.js
                </a>
              
                
                <a class="source" href="prototype.effects.html">
                  prototype.effects.js
                </a>
              
                
                <a class="source" href="prototype.hidefix.html">
                  prototype.hidefix.js
                </a>
              
                
                <a class="source" href="prototype.html">
                  prototype.js
                </a>
              
                
                <a class="source" href="prototype.plugin.html">
                  prototype.plugin.js
                </a>
              
                
                <a class="source" href="prototype.template.html">
                  prototype.template.js
                </a>
              
                
                <a class="source" href="scoped_object_generators.html">
                  scoped_object_generators.js
                </a>
              
                
                <a class="source" href="scrollable.html">
                  scrollable.js
                </a>
              
                
                <a class="source" href="scrollspy.html">
                  scrollspy.js
                </a>
              
                
                <a class="source" href="section.html">
                  section.js
                </a>
              
                
                <a class="source" href="selects.html">
                  selects.js
                </a>
              
                
                <a class="source" href="service.guidedToursService.html">
                  service.guidedToursService.js
                </a>
              
                
                <a class="source" href="service.snComplexPopoverService.html">
                  service.snComplexPopoverService.js
                </a>
              
                
                <a class="source" href="service.userData.html">
                  service.userData.js
                </a>
              
                
                <a class="source" href="simpleStorage.html">
                  simpleStorage.js
                </a>
              
                
                <a class="source" href="snPopover.html">
                  snPopover.js
                </a>
              
                
                <a class="source" href="tables.html">
                  tables.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tabs2_14.html">
                  tabs2_14.js
                </a>
              
                
                <a class="source" href="textutil.html">
                  textutil.js
                </a>
              
                
                <a class="source" href="timeAgo.html">
                  timeAgo.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="tooltips.html">
                  tooltips.js
                </a>
              
                
                <a class="source" href="transaction_scope_includes.html">
                  transaction_scope_includes.js
                </a>
              
                
                <a class="source" href="transition.html">
                  transition.js
                </a>
              
                
                <a class="source" href="ui_policy.html">
                  ui_policy.js
                </a>
              
                
                <a class="source" href="utils14.html">
                  utils14.js
                </a>
              
                
                <a class="source" href="xmlhttp.html">
                  xmlhttp.js
                </a>
              
                
                <a class="source" href="z_last_include.html">
                  z_last_include.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>AttachmentUploader.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/classes/AttachmentUploader.js */</span>
<span class="hljs-keyword">var</span> AttachmentUploader = Class.create({
  <span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, file, fileNumber, canAttach, showView, showPopup</span>) </span>{
    <span class="hljs-keyword">this</span>.target = Event.element(event);
    <span class="hljs-keyword">this</span>.file = file;
    <span class="hljs-keyword">this</span>.fileNumber = fileNumber;
    <span class="hljs-keyword">this</span>.showView = showView;
    <span class="hljs-keyword">this</span>.showPopup = showPopup;
    <span class="hljs-keyword">this</span>.canAttach = canAttach;
    <span class="hljs-keyword">this</span>.control = gel(<span class="hljs-string">"upload_file_"</span> + <span class="hljs-keyword">this</span>.fileNumber);
    <span class="hljs-keyword">this</span>.progress = gel(<span class="hljs-string">"upload_file_progress_"</span> + <span class="hljs-keyword">this</span>.fileNumber);
    <span class="hljs-keyword">this</span>.CRLF = <span class="hljs-string">"\r\n"</span>
    <span class="hljs-keyword">var</span> sys_id = gel(<span class="hljs-string">"sys_uniqueValue"</span>);
    <span class="hljs-keyword">if</span> (!sys_id)
      sys_id = gel(<span class="hljs-string">"sysparm_item_guid"</span>);
    <span class="hljs-keyword">this</span>.parent_sys_id = sys_id.value;
    <span class="hljs-keyword">var</span> table = gel(<span class="hljs-string">"sys_target"</span>);
    <span class="hljs-keyword">if</span> (!table)
      table = gel(<span class="hljs-string">"ni.attachment_target"</span>);
    <span class="hljs-keyword">this</span>.table = table.value;
  },
  <span class="hljs-attr">destroy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.target = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.xhr = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.file = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.control = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.progress = <span class="hljs-literal">null</span>;
  },
  <span class="hljs-attr">send</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">uploadedFunction</span>) </span>{
    <span class="hljs-keyword">this</span>.xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    Event.observe(<span class="hljs-keyword">this</span>.xhr.upload, <span class="hljs-string">"load"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (self.control) {
        <span class="hljs-keyword">try</span> {
          rel(self.control);
          $(<span class="hljs-string">'header_attachment'</span>).style.height = <span class="hljs-string">'auto'</span>;
        } <span class="hljs-keyword">catch</span> (ex) {}
      }
    }, <span class="hljs-literal">false</span>);
    Event.observe(<span class="hljs-keyword">this</span>.xhr.upload, <span class="hljs-string">"progress"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">if</span> (e.lengthComputable) {
        <span class="hljs-keyword">var</span> percentage = <span class="hljs-built_in">Math</span>.round((e.loaded * <span class="hljs-number">100</span>) / e.total);
        self._updateProgressBar(percentage);
      }
    }, <span class="hljs-literal">false</span>);
    Event.observe(<span class="hljs-keyword">this</span>.xhr.upload, <span class="hljs-string">"error"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      self._updateProgress(<span class="hljs-string">" error"</span>);
      <span class="hljs-keyword">if</span> (self.control)
        self.control.style.backgroundColor = <span class="hljs-string">"tomato"</span>;
      self.destroy();
    }, <span class="hljs-literal">false</span>);
    Event.observe(<span class="hljs-keyword">this</span>.xhr.upload, <span class="hljs-string">"loadstart"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      self._updateProgress(<span class="hljs-string">"started"</span>);
      <span class="hljs-keyword">if</span> (self.control)
        self.control.style.backgroundColor = <span class="hljs-string">"LightCyan"</span>;
    }, <span class="hljs-literal">false</span>);
    Event.observe(<span class="hljs-keyword">this</span>.xhr.upload, <span class="hljs-string">"abort"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      self._updateProgress(<span class="hljs-string">" aborted"</span>);
      <span class="hljs-keyword">if</span> (self.control)
        self.control.style.backgroundColor = <span class="hljs-string">"tomato"</span>;
      self.destroy();
    }, <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>.xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (self.xhr.readyState === <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">var</span> xml = self.xhr.responseXML;
        <span class="hljs-keyword">if</span> (xml) {
          <span class="hljs-keyword">var</span> sys_id = xml.documentElement.getAttribute(<span class="hljs-string">"sys_id"</span>);
          <span class="hljs-keyword">if</span> (sys_id == <span class="hljs-string">"attachment.refused"</span>) {
            alert(<span class="hljs-string">"Attachment refused because file type not allowed or type does not match file contents."</span>);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sys_id == <span class="hljs-string">"create.permission"</span>) {
            alert(<span class="hljs-string">"You do not have ability to attach file to this record."</span>);
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sys_id == <span class="hljs-string">"upload.error"</span>) {
            alert(<span class="hljs-string">"Attachment failed. "</span> +
              <span class="hljs-string">"Invalid table name and/or sys_id when attempting to create attachment."</span>);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> ga = <span class="hljs-keyword">new</span> GlideAjax(<span class="hljs-string">'AttachmentAjax'</span>);
            ga.addParam(<span class="hljs-string">'sysparm_name'</span>, <span class="hljs-string">'getIconSrc'</span>);
            ga.addParam(<span class="hljs-string">'sysparm_type'</span>, <span class="hljs-string">'icon'</span>);
            ga.addParam(<span class="hljs-string">'sysparm_value'</span>, sys_id);
            ga.getXMLWait();
            <span class="hljs-keyword">var</span> imgSrc = ga.getAnswer();
            <span class="hljs-keyword">if</span> (!imgSrc)
              imgSrc = <span class="hljs-string">"images/attachment.gifx"</span>;
            addAttachmentNameToForm(sys_id, self.file.name, <span class="hljs-string">"New"</span>, imgSrc,
              self.canAttach, self.showView, self.showPopup);
            ga = <span class="hljs-keyword">new</span> GlideAjax(<span class="hljs-string">'AttachmentAjax'</span>);
            ga.addParam(<span class="hljs-string">'sysparm_name'</span>, <span class="hljs-string">'getCanDelete'</span>);
            ga.addParam(<span class="hljs-string">'sysparm_type'</span>, <span class="hljs-string">'canDelete'</span>);
            ga.addParam(<span class="hljs-string">'sysparm_value'</span>, sys_id);
            ga.getXMLWait();
            <span class="hljs-keyword">var</span> canDelete = ga.getAnswer();
            <span class="hljs-keyword">if</span> (!canDelete)
              canDelete = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">var</span> gr = <span class="hljs-keyword">new</span> GlideRecord(<span class="hljs-string">'sys_attachment'</span>);
            gr.get(sys_id);
            addAttachmentNameToDialog(sys_id, self.file.name, canDelete,
              gr.sys_created_by, gr.sys_created_on, gr.content_type, imgSrc);
            _saveAttachmentClose();
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> uploadedFunction == <span class="hljs-string">"function"</span>) {
              self.sys_id = sys_id;
              uploadedFunction.call(<span class="hljs-keyword">this</span>, self);
            }
          }
        }
        self.destroy();
      }
    };
    <span class="hljs-keyword">this</span>._checkCompatibleFile(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> formData = <span class="hljs-keyword">new</span> FormData();
      formData.append(<span class="hljs-string">"sysparm_sys_id"</span>, self.parent_sys_id);
      formData.append(<span class="hljs-string">"sysparm_table"</span>, self.table);
      formData.append(<span class="hljs-string">"sysparm_nostack"</span>, <span class="hljs-string">"yes"</span>);
      formData.append(<span class="hljs-string">"sysparm_send_xml"</span>, <span class="hljs-string">"true"</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.g_ck)
        formData.append(<span class="hljs-string">"sysparm_ck"</span>, <span class="hljs-built_in">window</span>.g_ck);
      formData.append(<span class="hljs-string">"attachFile"</span>, self.file, self.file.name);
      self.xhr.open(<span class="hljs-string">"POST"</span>, <span class="hljs-string">"sys_attachment.do"</span>, <span class="hljs-literal">true</span>);
      self.xhr.send(formData);
      jslog(<span class="hljs-string">"starting send file upload for "</span> + self.file.name);
    })
  },
  <span class="hljs-attr">_updateProgress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">txt</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.progress)
      <span class="hljs-keyword">this</span>.progress.innerHTML = txt;
  },
  <span class="hljs-attr">_updateProgressBar</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">percentage</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.progress)
      <span class="hljs-keyword">this</span>.progress.innerHTML = <span class="hljs-string">"&lt;progress value=\""</span> + percentage +
      <span class="hljs-string">"\" max=\"100\"&gt;"</span> + percentage + <span class="hljs-string">"%"</span>;
  },
  <span class="hljs-attr">_checkCompatibleFile</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sendFunction</span>) </span>{
    <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> FileReader();
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    reader.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      self._outputIncompatible();
    }
    reader.onloadend = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
      <span class="hljs-keyword">if</span> (evt.target.error)
        <span class="hljs-keyword">return</span>;
      sendFunction();
    }
    reader.readAsArrayBuffer(<span class="hljs-keyword">this</span>.file);
  },
  <span class="hljs-attr">_isIWorkFile</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> fileName = <span class="hljs-keyword">this</span>.file.name;
    <span class="hljs-keyword">return</span> fileName.endsWith(<span class="hljs-string">'.key'</span>) ||
      fileName.endsWith(<span class="hljs-string">'.pages'</span>) ||
      fileName.endsWith(<span class="hljs-string">'.numbers'</span>) ||
      fileName.endsWith(<span class="hljs-string">'.keynote'</span>);
  },
  <span class="hljs-attr">_outputIncompatible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> errMsg = <span class="hljs-string">"There was an error uploading \"{0}.\" "</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isIWorkFile())
      errMsg += <span class="hljs-string">"Some iWork files cannot be added through drag and drop. "</span>;
    errMsg += <span class="hljs-string">"Please select the file and upload through the paperclip icon above."</span>;
    g_form.addErrorMessage(<span class="hljs-keyword">new</span> GwtMessage().getMessage(errMsg, <span class="hljs-keyword">this</span>.file.name));
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.control)
      <span class="hljs-keyword">this</span>.control.style.display = <span class="hljs-string">"none"</span>;
    <span class="hljs-keyword">this</span>.destroy();
  },
  <span class="hljs-attr">type</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"AttachmentUploader"</span>;
  }
});
AttachmentUploader.uploadBlob = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">blob, filename, url, data</span>) </span>{
  <span class="hljs-keyword">var</span> form = <span class="hljs-keyword">this</span>._getFormBuilder();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> data) {
    <span class="hljs-keyword">if</span> (data.hasOwnProperty(key)) {
      form.append(key, data[key]);
    }
  }
  form.append(<span class="hljs-string">'file'</span>, blob, filename);
  <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
  xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    onSuccess({
      <span class="hljs-attr">data</span>: xhr.response,
      <span class="hljs-attr">xml</span>: xhr.responseXML,
      <span class="hljs-attr">sys_id</span>: xhr.responseXML.documentElement.getAttribute(<span class="hljs-string">'sys_id'</span>)
    });
  };
  xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (xhr.readyState === <span class="hljs-number">4</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> sys_id = xhr.responseXML.documentElement.getAttribute(<span class="hljs-string">"sys_id"</span>);
        <span class="hljs-keyword">if</span> (!sys_id) {
          <span class="hljs-keyword">return</span> onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Attachment failed because file type does not match with file contents."</span>));
        }
        <span class="hljs-keyword">if</span> (sys_id == <span class="hljs-string">"create.permission"</span>) {
          <span class="hljs-keyword">return</span> onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"You do not have ability to attach file to this record."</span>));
        }
        <span class="hljs-keyword">if</span> (sys_id == <span class="hljs-string">"upload.error"</span>) {
          <span class="hljs-keyword">return</span> onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Attachment failed. "</span> +
            <span class="hljs-string">"Invalid table name and/or sys_id when attempting to create attachment."</span>));
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-number">200</span> &lt;= xhr.status &amp;&amp; xhr.status &lt; <span class="hljs-number">300</span>) {
          <span class="hljs-keyword">return</span> onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'server responded with: '</span> + xhr.status));
        }
        onSuccess({
          <span class="hljs-attr">sys_id</span>: sys_id
        });
      } <span class="hljs-keyword">catch</span> (e) {
        onError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'server responded with unusable data'</span>));
      }
    }
  };
  xhr.open(<span class="hljs-string">"POST"</span>, url);
  xhr.send(form);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listen</span>(<span class="hljs-params">event, listener</span>) </span>{
    <span class="hljs-keyword">if</span> (!xhr.addEventListener)
      xhr.attachEvent(event, listener);
    <span class="hljs-keyword">else</span>
      xhr.addEventListener(event, listener, <span class="hljs-literal">false</span>);
  }
  listen(<span class="hljs-string">'progress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> (e.lengthComputable) {
      onProgress({
        <span class="hljs-attr">total</span>: e.total,
        <span class="hljs-attr">loaded</span>: e.loaded,
        <span class="hljs-attr">percent</span>: <span class="hljs-built_in">Math</span>.round((e.loaded * <span class="hljs-number">100</span>) / e.total)
      });
    }
  });
  listen(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    onError(e);
  });
  <span class="hljs-keyword">var</span> errFuns = [];

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onError</span>(<span class="hljs-params">data</span>) </span>{
    errFuns.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fun</span>) </span>{
      fun(data);
    });
  }
  <span class="hljs-keyword">var</span> sucFuns = [];

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onSuccess</span>(<span class="hljs-params">data</span>) </span>{
    sucFuns.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fun</span>) </span>{
      fun(data);
    });
  }
  <span class="hljs-keyword">var</span> proFuns = [];

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onProgress</span>(<span class="hljs-params">data</span>) </span>{
    proFuns.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fun</span>) </span>{
      fun(data);
    });
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fun</span>) </span>{
      sucFuns.push(fun);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },
    <span class="hljs-attr">progress</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fun</span>) </span>{
      proFuns.push(fun);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },
    <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fun</span>) </span>{
      errFuns.push(fun);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
  }
};
AttachmentUploader.uploadDataURLAttachment = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataUrl, name, table, sys_id</span>) </span>{
  <span class="hljs-keyword">var</span> parts = AttachmentUploader._parseDataUrl(dataUrl);
  <span class="hljs-keyword">if</span> (name) {
    name = (parts.ext &amp;&amp; name.indexOf(<span class="hljs-string">'.'</span>) == <span class="hljs-number">-1</span>) ? name + parts.ext : name;
  } <span class="hljs-keyword">else</span> {
    name = <span class="hljs-string">'pasted_image'</span> + (parts.ext ? parts.ext : <span class="hljs-string">'.unknown'</span>);
  }
  <span class="hljs-keyword">var</span> data = {
    <span class="hljs-string">'sysparm_sys_id'</span>: sys_id,
    <span class="hljs-string">'sysparm_table'</span>: table
  };
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.uploadBlob(parts.blob, name, <span class="hljs-string">'sys_attachment.do'</span>, data);
};
AttachmentUploader.uploadDataURLDBImage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataUrl, name</span>) </span>{
  <span class="hljs-keyword">var</span> parts = AttachmentUploader._parseDataUrl(dataUrl);
  <span class="hljs-keyword">if</span> (name) {
    name = (parts.ext &amp;&amp; name.indexOf(<span class="hljs-string">'.'</span>) == <span class="hljs-number">-1</span>) ? name + parts.ext : name;
  } <span class="hljs-keyword">else</span> {
    name = <span class="hljs-string">'pasted_image'</span> + (parts.ext ? parts.ext : <span class="hljs-string">'.unknown'</span>);
  }
  <span class="hljs-keyword">var</span> data = {
    <span class="hljs-attr">sysparm_table</span>: <span class="hljs-string">'db_image'</span>,
    <span class="hljs-attr">sysparm_sys_id</span>: <span class="hljs-string">'new_db_image'</span>
  };
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.uploadBlob(parts, name, <span class="hljs-string">'sys_user_image.do'</span>, data);
};
AttachmentUploader._getFormBuilder = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> form = <span class="hljs-keyword">new</span> FormData();
  form.append(<span class="hljs-string">'sysparm_nostack'</span>, <span class="hljs-string">'yes'</span>);
  form.append(<span class="hljs-string">'sysparm_send_xml'</span>, <span class="hljs-string">'true'</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.g_ck)
    form.append(<span class="hljs-string">'sysparm_ck'</span>, <span class="hljs-built_in">window</span>.g_ck);
  <span class="hljs-keyword">return</span> form;
};
AttachmentUploader._parseDataUrl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>.Blob == <span class="hljs-string">'undefined'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'cannot create Blobs on this browser'</span>);
  <span class="hljs-keyword">var</span> exts = {
    <span class="hljs-string">'image/jpeg'</span>: <span class="hljs-string">'.jpg'</span>,
    <span class="hljs-string">'image/bmp'</span>: <span class="hljs-string">'.bmp'</span>,
    <span class="hljs-string">'image/gif'</span>: <span class="hljs-string">'.gif'</span>,
    <span class="hljs-string">'image/png'</span>: <span class="hljs-string">'.png'</span>,
    <span class="hljs-string">'image/tiff'</span>: <span class="hljs-string">'.tiff'</span>,
    <span class="hljs-string">'image/svg+xml'</span>: <span class="hljs-string">'.svg'</span>,
    <span class="hljs-string">'image/x-icon'</span>: <span class="hljs-string">'.ico'</span>
  };
  <span class="hljs-keyword">var</span> mime = str.substring(str.indexOf(<span class="hljs-string">':'</span>) + <span class="hljs-number">1</span>, str.indexOf(<span class="hljs-string">';'</span>));
  <span class="hljs-keyword">var</span> base64Str = str.substring(str.indexOf(<span class="hljs-string">','</span>) + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">var</span> byteString = atob(base64Str);
  <span class="hljs-keyword">var</span> ab = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ArrayBuffer</span>(byteString.length);
  <span class="hljs-keyword">var</span> ia = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(ab);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = byteString.length; i &lt; l; i++) {
    ia[i] = byteString.charCodeAt(i);
  }
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">blob</span>: <span class="hljs-keyword">new</span> Blob([ia], {
      <span class="hljs-attr">type</span>: mime
    }),
    <span class="hljs-attr">mime</span>: mime,
    <span class="hljs-attr">ext</span>: exts[mime]
  };
};
AttachmentUploader.addDropZone = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dropZone, maxMegabytes, canAttach, showView, showPopup, extensions, uploadedFunction</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> FileReader == <span class="hljs-string">"undefined"</span>)
    <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (canAttach == <span class="hljs-string">"false"</span>) {
    AttachmentUploader.noDropZone(<span class="hljs-string">"File attachments not allowed"</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">if</span> (maxMegabytes !== <span class="hljs-string">""</span>)
    maxMegabytes = <span class="hljs-built_in">parseInt</span>(maxMegabytes, <span class="hljs-number">10</span>);
  <span class="hljs-keyword">else</span>
    maxMegabytes = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(maxMegabytes))
    maxMegabytes = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> gotExtensions = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (extensions) {
    extensions.toLowerCase();
    extensions = extensions.split(<span class="hljs-string">","</span>);
    gotExtensions = <span class="hljs-literal">true</span>;
  }
  Event.observe(dropZone, <span class="hljs-string">"dragover"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    Event.stop(event);
    <span class="hljs-keyword">var</span> headerAttachment = gel(<span class="hljs-string">"header_attachment"</span>);
    <span class="hljs-keyword">if</span> (headerAttachment &amp;&amp; headerAttachment.style.backgroundColor != <span class="hljs-string">"orange"</span>) {
      headerAttachment.style.backgroundColor = <span class="hljs-string">"orange"</span>;
      needsReset = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">var</span> line = gel(<span class="hljs-string">"header_attachment_line"</span>);
    <span class="hljs-keyword">if</span> (line) {
      <span class="hljs-keyword">if</span> (line.style.visibility == <span class="hljs-string">"hidden"</span>) {
        line.reverseOnCancel = <span class="hljs-string">"true"</span>;
        <span class="hljs-keyword">if</span> ($$(<span class="hljs-string">'attachment_list_items'</span>).length &gt; <span class="hljs-number">0</span>) {
          showObjectInline(gel(<span class="hljs-string">"header_attachment_list_label"</span>));
        }
        line.style.visibility = <span class="hljs-string">"visible"</span>;
        line.style.display = <span class="hljs-string">""</span>;
      }
      line.resetDisplay = <span class="hljs-string">"1"</span>;
    }
    setTimeout(<span class="hljs-string">"AttachmentUploader._resetBackground(false)"</span>, <span class="hljs-number">1000</span>);
    <span class="hljs-keyword">if</span> (!(isMSIE || isMSIE11)) {
      event.dataTransfer.effectAllowed = <span class="hljs-string">"copy"</span>;
      event.dataTransfer.dropEffect = <span class="hljs-string">"copy"</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }, <span class="hljs-literal">true</span>);
  Event.observe(dropZone, <span class="hljs-string">"dragend"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    AttachmentUploader._resetBackground(<span class="hljs-literal">true</span>);
  }, <span class="hljs-literal">true</span>);
  Event.observe(dropZone, <span class="hljs-string">"drop"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    AttachmentUploader._resetBackground(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">var</span> files = event.dataTransfer.files
    <span class="hljs-keyword">if</span> (files.length &lt; <span class="hljs-number">1</span>)
      <span class="hljs-keyword">return</span>;
    Event.stop(event);
    <span class="hljs-keyword">if</span> (dropZone.disableAttachments == <span class="hljs-string">"true"</span>) {
      alert(getMessage(<span class="hljs-string">"Attachments are not allowed"</span>));
      <span class="hljs-keyword">return</span>;
    }
    $(<span class="hljs-string">'header_attachment'</span>).style.height = <span class="hljs-string">'auto'</span>;
    <span class="hljs-keyword">if</span> (isFirefox) {
      $(<span class="hljs-string">'header_attachment'</span>).style.height = <span class="hljs-string">'3em'</span>;
    }
    <span class="hljs-keyword">var</span> line = gel(<span class="hljs-string">"header_attachment_line"</span>);
    <span class="hljs-keyword">if</span> (line)
      line.reverseOnCancel = <span class="hljs-string">"false"</span>;
    <span class="hljs-keyword">var</span> progressSpan = gel(<span class="hljs-string">"attachment_upload_progress"</span>);
    progressSpan.innerHTML = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> filesTooLarge = [];
    <span class="hljs-keyword">var</span> filesBadExtension = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++) {
      <span class="hljs-keyword">var</span> file = files[i];
      <span class="hljs-keyword">var</span> megs = file.size / <span class="hljs-number">1048576</span>;
      <span class="hljs-keyword">if</span> (maxMegabytes &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (megs &gt; maxMegabytes) {
          filesTooLarge.push(file.name + <span class="hljs-string">" ("</span> + AttachmentUploader.getDisplaySize(file.size) + <span class="hljs-string">")"</span>);
          files[i] = <span class="hljs-literal">null</span>;
          <span class="hljs-keyword">continue</span>;
        }
      }
      <span class="hljs-keyword">if</span> (gotExtensions) {
        <span class="hljs-keyword">var</span> badExtension = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> periodIndex = file.name.lastIndexOf(<span class="hljs-string">"."</span>);
        <span class="hljs-keyword">var</span> extension = <span class="hljs-string">"(none)"</span>;
        <span class="hljs-keyword">if</span> (periodIndex == <span class="hljs-number">-1</span>)
          badExtension = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span> {
          extension = file.name.substring(periodIndex + <span class="hljs-number">1</span>).toLowerCase();
          <span class="hljs-keyword">if</span> (extensions.indexOf(extension) == <span class="hljs-number">-1</span>)
            badExtension = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">if</span> (badExtension) {
          filesBadExtension.push(file.name);
          <span class="hljs-keyword">continue</span>;
        }
      }
      <span class="hljs-keyword">var</span> p = cel(<span class="hljs-string">"p"</span>);
      p.id = <span class="hljs-string">"upload_file_"</span> + i;
      addClassName(p, <span class="hljs-string">'file'</span>);
      p.innerHTML = files[i].name + <span class="hljs-string">" ("</span> + AttachmentUploader.getDisplaySize(files[i].size) + <span class="hljs-string">") "</span>;
      <span class="hljs-keyword">var</span> span = cel(<span class="hljs-string">"span"</span>);
      span.id = <span class="hljs-string">"upload_file_progress_"</span> + i;
      p.appendChild(span);
      progressSpan.appendChild(p);
      <span class="hljs-keyword">var</span> uploader = <span class="hljs-keyword">new</span> AttachmentUploader(event, file, i, canAttach, showView, showPopup);
      uploader.send(uploadedFunction);
    }
    <span class="hljs-keyword">if</span> ((filesTooLarge.length + filesBadExtension.length) &gt; <span class="hljs-number">0</span>)
      AttachmentUploader.setWarning(filesTooLarge, filesBadExtension, maxMegabytes);
  }, <span class="hljs-literal">true</span>);
};
AttachmentUploader._resetBackground = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">doNow</span>) </span>{
  <span class="hljs-keyword">var</span> line = gel(<span class="hljs-string">"header_attachment_line"</span>);
  <span class="hljs-keyword">if</span> (!line)
    <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (doNow != <span class="hljs-literal">true</span> &amp;&amp; <span class="hljs-keyword">typeof</span> line.resetDisplay != <span class="hljs-string">"undefined"</span>) {
    <span class="hljs-keyword">var</span> resetDisplay = <span class="hljs-built_in">parseInt</span>(line.resetDisplay);
    resetDisplay++;
    line.resetDisplay = resetDisplay;
    <span class="hljs-keyword">if</span> (resetDisplay &lt; <span class="hljs-number">10</span>)
      <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">var</span> headerAttachment = gel(<span class="hljs-string">"header_attachment"</span>);
  <span class="hljs-keyword">if</span> (headerAttachment)
    headerAttachment.style.backgroundColor = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">if</span> (line.reverseOnCancel == <span class="hljs-string">"true"</span>) {
    line.reverseOnCanel = <span class="hljs-string">"false"</span>;
    hideObject(gel(<span class="hljs-string">"header_attachment_list_label"</span>));
    line.style.visibility = <span class="hljs-string">"hidden"</span>;
    line.style.display = <span class="hljs-string">"none"</span>;
  }
}
AttachmentUploader.getDisplaySize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sizeInBytes</span>) </span>{
  <span class="hljs-keyword">var</span> kilobytes = <span class="hljs-built_in">Math</span>.round(sizeInBytes / <span class="hljs-number">1024</span>);
  <span class="hljs-keyword">if</span> (kilobytes &lt; <span class="hljs-number">1</span>)
    kilobytes = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">var</span> reportSize = kilobytes + <span class="hljs-string">"K"</span>;
  <span class="hljs-keyword">if</span> (kilobytes &gt; <span class="hljs-number">1024</span>)
    reportSize = <span class="hljs-built_in">Math</span>.round(kilobytes / <span class="hljs-number">1024</span>) + <span class="hljs-string">"MB"</span>;
  <span class="hljs-keyword">return</span> reportSize;
}
AttachmentUploader.noDropZone = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
  <span class="hljs-keyword">var</span> dropZone = <span class="hljs-built_in">document</span>.body;
  Event.observe(dropZone, <span class="hljs-string">"dragover"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    Event.stop(event);
    <span class="hljs-keyword">if</span> (isChrome)
      event.dataTransfer.dropEffect = <span class="hljs-string">"copy"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }, <span class="hljs-literal">true</span>);
  Event.observe(dropZone, <span class="hljs-string">"dragleave"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    Event.stop(event);
  }, <span class="hljs-literal">true</span>);
  Event.observe(dropZone, <span class="hljs-string">"drop"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    Event.stop(event);
    alert(message);
  }, <span class="hljs-literal">true</span>);
}
AttachmentUploader.isAttachmentDisabled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.body[<span class="hljs-string">"disableAttachments"</span>] === <span class="hljs-string">"true"</span>;
}
AttachmentUploader.disableAttachments = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">document</span>.body.disableAttachments = <span class="hljs-string">"true"</span>;
}
AttachmentUploader.enableAttachments = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">document</span>.body.disableAttachments = <span class="hljs-string">"false"</span>;
}
AttachmentUploader.setWarning = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filesTooLarge, filesBadExtension, maxFileSize</span>) </span>{
  <span class="hljs-keyword">var</span> warningString = <span class="hljs-string">"The following files were not uploaded:\n\n"</span>;
  <span class="hljs-keyword">if</span> (filesTooLarge.length &gt; <span class="hljs-number">0</span>) {
    warningString += <span class="hljs-string">"Files larger than the maximum file size ("</span> + maxFileSize + <span class="hljs-string">"MB):\n"</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; filesTooLarge.length; i++)
      warningString += <span class="hljs-string">"\t"</span> + filesTooLarge[i] + <span class="hljs-string">"\n"</span>;
    warningString += <span class="hljs-string">"\n"</span>;
  }
  <span class="hljs-keyword">if</span> (filesBadExtension.length &gt; <span class="hljs-number">0</span>) {
    warningString += <span class="hljs-string">"Files with prohibited extensions:\n"</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; filesBadExtension.length; i++)
      warningString += <span class="hljs-string">"\t"</span> + filesBadExtension[i] + <span class="hljs-string">"\n"</span>;
  }
  alert(warningString);
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
