<!DOCTYPE html>

<html>
<head>
  <title>form_tags.jsx</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="SLARepairClient.html">
                  SLARepairClient.js
                </a>
              
                
                <a class="source" href="form_tags.html">
                  form_tags.jsx
                </a>
              
                
                <a class="source" href="glide-highcharts-v5.html">
                  glide-highcharts-v5.js
                </a>
              
                
                <a class="source" href="heisenberg_all.html">
                  heisenberg_all.jsx
                </a>
              
                
                <a class="source" href="js_guided_tours_includes.html">
                  js_guided_tours_includes.jsx
                </a>
              
                
                <a class="source" href="js_includes_amb.html">
                  js_includes_amb.jsx
                </a>
              
                
                <a class="source" href="js_includes_customer.html">
                  js_includes_customer.jsx
                </a>
              
                
                <a class="source" href="js_includes_doctype.html">
                  js_includes_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_form_presence.html">
                  js_includes_form_presence.jsx
                </a>
              
                
                <a class="source" href="js_includes_last_doctype.html">
                  js_includes_last_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_list_edit_doctype.html">
                  js_includes_list_edit_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_listv2_doctype.html">
                  js_includes_listv2_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_sorting_new.html">
                  js_includes_sorting_new.jsx
                </a>
              
                
                <a class="source" href="js_includes_sp.html">
                  js_includes_sp.jsx
                </a>
              
                
                <a class="source" href="magellan.CreateFavoriteModal.html">
                  magellan.CreateFavoriteModal.jsx
                </a>
              
                
                <a class="source" href="newtag-it.html">
                  newtag-it.jsx
                </a>
              
                
                <a class="source" href="transaction_scope_includes.html">
                  transaction_scope_includes.jsx
                </a>
              
                
                <a class="source" href="ui_policy.html">
                  ui_policy.jsx
                </a>
              
                
                <a class="source" href="z_last_include.html">
                  z_last_include.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>form_tags.jsx</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/form_tags.js */</span>
$j(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
<span class="hljs-keyword">var</span> $dt = $(<span class="hljs-string">'#document_tags'</span>);
<span class="hljs-keyword">if</span> ($dt.length == <span class="hljs-number">0</span>)
<span class="hljs-keyword">return</span>;
$(<span class="hljs-string">'#tags_menu'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
$(<span class="hljs-string">'#form_tags'</span>).toggle();
CustomEvent.fire(<span class="hljs-string">'frame.resized'</span>);
$dt.find(<span class="hljs-string">'input'</span>).show().parent().show();
$dt.find(<span class="hljs-string">'input'</span>).focus();
})
<span class="hljs-keyword">var</span> url = <span class="hljs-keyword">new</span> GlideURL(<span class="hljs-string">"data_table.do"</span>);
url.addParam(<span class="hljs-string">'sysparm_type'</span>, <span class="hljs-string">'labels'</span>);
url.addParam(<span class="hljs-string">'sysparm_table'</span>, $dt.attr(<span class="hljs-string">'data-table'</span>));
url.addParam(<span class="hljs-string">'sysparm_sys_id'</span>, $dt.attr(<span class="hljs-string">'data-sys_id'</span>));
url.addParam(<span class="hljs-string">'sysparm_action'</span>, <span class="hljs-string">'existing_labels'</span>);
url.addParam(<span class="hljs-string">'nocache'</span>, (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime().toString()));
url = url.getURL();
$.ajax({
<span class="hljs-attr">dataType</span>: <span class="hljs-string">"json"</span>,
<span class="hljs-attr">url</span>: url,
<span class="hljs-attr">beforeSend</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request</span>) </span>{
request.setRequestHeader(<span class="hljs-string">"X-UserToken"</span>, <span class="hljs-built_in">window</span>.g_ck);
},
<span class="hljs-attr">success</span>: initializeResponseMenu
});
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">labelTypeAhead</span>(<span class="hljs-params">table, search, showChoices</span>) </span>{
<span class="hljs-keyword">var</span> url = <span class="hljs-keyword">new</span> GlideURL(<span class="hljs-string">"data_table.do"</span>);
url.addParam(<span class="hljs-string">'sysparm_type'</span>, <span class="hljs-string">'labels'</span>);
url.addParam(<span class="hljs-string">'sysparm_table'</span>, table);
url.addParam(<span class="hljs-string">'sysparm_action'</span>, <span class="hljs-string">'available_labels'</span>);
url.addParam(<span class="hljs-string">'sysparm_prefix'</span>, search.term);
url = url.getURL();
$.ajax({
<span class="hljs-attr">dataType</span>: <span class="hljs-string">"json"</span>,
<span class="hljs-attr">url</span>: url,
<span class="hljs-attr">beforeSend</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request</span>) </span>{
request.setRequestHeader(<span class="hljs-string">"X-UserToken"</span>, <span class="hljs-built_in">window</span>.g_ck);
},
<span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> t = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].responseText;
<span class="hljs-keyword">var</span> response = <span class="hljs-built_in">JSON</span>.parse(t);
showChoices(response.availableLabels);
}
});
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initializeResponseMenu</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> t = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].responseText;
<span class="hljs-keyword">var</span> json = <span class="hljs-built_in">JSON</span>.parse(t);
$j(<span class="hljs-string">"#tags_number"</span>).attr(<span class="hljs-string">"data-number"</span>, json.set.length);
<span class="hljs-keyword">if</span> (json.set.length &gt; <span class="hljs-number">0</span>)
$(<span class="hljs-string">'#tags_number'</span>).text(json.set.length);
$dt.newtagit({
<span class="hljs-attr">itemName</span>: <span class="hljs-string">'item'</span>,
<span class="hljs-attr">allowSpaces</span>: <span class="hljs-literal">true</span>,
<span class="hljs-attr">afterTagAdded</span>: onTagAdded,
<span class="hljs-attr">afterTagRemoved</span>: onTagRemoved,
<span class="hljs-attr">showAutocompleteOnFocus</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">animate</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">placeholderText</span>: getMessage(<span class="hljs-string">'Add Tag...'</span>),
<span class="hljs-attr">table</span>:$dt.attr(<span class="hljs-string">'data-table'</span>),
<span class="hljs-attr">labelsListString</span>: <span class="hljs-built_in">JSON</span>.stringify(json),
<span class="hljs-attr">autocomplete</span>: {
<span class="hljs-attr">source</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">search, showChoices</span>) </span>{
labelTypeAhead($dt.attr(<span class="hljs-string">'data-table'</span>), search, showChoices);
}
},
<span class="hljs-attr">query</span>: <span class="hljs-string">""</span>,
<span class="hljs-attr">context</span>: <span class="hljs-string">'tagsMenu'</span>,
<span class="hljs-attr">rowId</span>: $dt.attr(<span class="hljs-string">'data-sys_id'</span>),
<span class="hljs-attr">fieldName</span>: <span class="hljs-string">'documentTags'</span>
});
<span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.isTablet)
$dt.find(<span class="hljs-string">'input'</span>).hide();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTagAdded</span>(<span class="hljs-params">evt, ui, rowId</span>) </span>{
<span class="hljs-keyword">if</span> (ui.duringInitialization)
<span class="hljs-keyword">return</span>;
<span class="hljs-keyword">var</span> number = <span class="hljs-built_in">parseInt</span>($(<span class="hljs-string">"#tags_number"</span>).attr(<span class="hljs-string">"data-number"</span>), <span class="hljs-number">10</span>) + <span class="hljs-number">1</span>;
<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">isNaN</span>(number))
$(<span class="hljs-string">"#tags_number"</span>).text(number).attr(<span class="hljs-string">"data-number"</span>, number).show();
labelSet(<span class="hljs-string">'add'</span>, ui.tagLabel, ui.table, ui.rowId);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTagRemoved</span>(<span class="hljs-params">evt, ui, rowId</span>) </span>{
<span class="hljs-keyword">if</span> (ui.duringInitialization)
<span class="hljs-keyword">return</span>;
<span class="hljs-keyword">if</span> (!ui.tag)
<span class="hljs-keyword">return</span>;
<span class="hljs-keyword">var</span> number = <span class="hljs-built_in">parseInt</span>($(<span class="hljs-string">"#tags_number"</span>).attr(<span class="hljs-string">"data-number"</span>), <span class="hljs-number">10</span>) - <span class="hljs-number">1</span>;
<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">isNaN</span>(number)) {
$(<span class="hljs-string">"#tags_number"</span>).attr(<span class="hljs-string">"data-number"</span>, number);
<span class="hljs-keyword">if</span> (number &gt; <span class="hljs-number">0</span>)
$(<span class="hljs-string">"#tags_number"</span>).text(number);
<span class="hljs-keyword">else</span>
$(<span class="hljs-string">"#tags_number"</span>).hide();
}
labelSet(<span class="hljs-string">'removeById'</span>, ui.tag, ui.table, ui.rowId);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">labelSet</span>(<span class="hljs-params">action, label, table, rowId</span>) </span>{
<span class="hljs-keyword">var</span> url = <span class="hljs-keyword">new</span> GlideURL(<span class="hljs-string">"data_table.do"</span>);
url.addParam(<span class="hljs-string">'sysparm_type'</span>, <span class="hljs-string">'labels'</span>);
url.addParam(<span class="hljs-string">'sysparm_table'</span>, $dt.attr(<span class="hljs-string">'data-table'</span>));
url.addParam(<span class="hljs-string">'sysparm_sys_id'</span>, $dt.attr(<span class="hljs-string">'data-sys_id'</span>));
url.addParam(<span class="hljs-string">'sysparm_label'</span>, label);
url.addParam(<span class="hljs-string">'sysparm_action'</span>, action);
url = url.getURL();
$.ajax({
<span class="hljs-attr">dataType</span>: <span class="hljs-string">"json"</span>,
<span class="hljs-attr">url</span>: url,
<span class="hljs-attr">beforeSend</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request</span>) </span>{
request.setRequestHeader(<span class="hljs-string">"X-UserToken"</span>, <span class="hljs-built_in">window</span>.g_ck);
},
<span class="hljs-attr">success</span>: labelResponse
});
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">labelResponse</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">if</span> (g_enhanced_activated == <span class="hljs-string">'false'</span>) <span class="hljs-keyword">return</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span> == <span class="hljs-literal">null</span> || <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>] == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
<span class="hljs-keyword">var</span> t = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>].responseText;
<span class="hljs-keyword">if</span> (t == <span class="hljs-string">""</span> || t == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
<span class="hljs-keyword">var</span> json = <span class="hljs-built_in">JSON</span>.parse(t);
<span class="hljs-keyword">var</span> share = $dt.find(<span class="hljs-string">'[id=\''</span> + json.label + <span class="hljs-string">'\'].tagit-share'</span>);
share.parent().attr(<span class="hljs-string">"id"</span>, json.sysId).css({<span class="hljs-string">"background-color"</span>: json.bgcolor, <span class="hljs-string">"color"</span>: json.tcolor});
share.parent().find(<span class="hljs-string">".tagit-label"</span>).unbind(<span class="hljs-string">'click'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-built_in">window</span>.open(json.table + <span class="hljs-string">"_list.do?sysparm_query="</span> + json.query);});
<span class="hljs-keyword">var</span> shareLevel = (json.type == <span class="hljs-string">'SHARED'</span>) ? <span class="hljs-string">'tagit-share-group'</span> : <span class="hljs-string">'tagit-share-user'</span>;
share.parent().removeClass(<span class="hljs-string">"tagit-share-user tagit-share-group"</span>).addClass(shareLevel);
<span class="hljs-keyword">if</span> (json.owner != <span class="hljs-literal">true</span>) {
share.removeClass(<span class="hljs-string">"pointerhand"</span>);
share.unbind(<span class="hljs-string">"click"</span>);
}
<span class="hljs-keyword">var</span> icon = (json.type == <span class="hljs-string">'SHARED'</span>) ? <span class="hljs-string">'icon-user-group'</span> : <span class="hljs-string">'icon-user'</span>;
share = share.children();
share.removeClass(<span class="hljs-string">"icon-user-group icon-user"</span>).addClass(icon);
}
});
<span class="hljs-keyword">var</span> showTagForm = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
<span class="hljs-keyword">var</span> form = <span class="hljs-keyword">new</span> GlideDialogWindow(<span class="hljs-string">"tag_form"</span>);
form.setTitle(<span class="hljs-string">""</span>);
form.setPreference(<span class="hljs-string">"label_id"</span>, id);
form.removeCloseDecoration();
form.render();
}
;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
