<!DOCTYPE html>

<html>
<head>
  <title>newtag-it.jsx</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="SLARepairClient.html">
                  SLARepairClient.js
                </a>
              
                
                <a class="source" href="form_tags.html">
                  form_tags.jsx
                </a>
              
                
                <a class="source" href="glide-highcharts-v5.html">
                  glide-highcharts-v5.js
                </a>
              
                
                <a class="source" href="heisenberg_all.html">
                  heisenberg_all.jsx
                </a>
              
                
                <a class="source" href="js_guided_tours_includes.html">
                  js_guided_tours_includes.jsx
                </a>
              
                
                <a class="source" href="js_includes_amb.html">
                  js_includes_amb.jsx
                </a>
              
                
                <a class="source" href="js_includes_customer.html">
                  js_includes_customer.jsx
                </a>
              
                
                <a class="source" href="js_includes_doctype.html">
                  js_includes_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_form_presence.html">
                  js_includes_form_presence.jsx
                </a>
              
                
                <a class="source" href="js_includes_last_doctype.html">
                  js_includes_last_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_list_edit_doctype.html">
                  js_includes_list_edit_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_listv2_doctype.html">
                  js_includes_listv2_doctype.jsx
                </a>
              
                
                <a class="source" href="js_includes_sorting_new.html">
                  js_includes_sorting_new.jsx
                </a>
              
                
                <a class="source" href="js_includes_sp.html">
                  js_includes_sp.jsx
                </a>
              
                
                <a class="source" href="magellan.CreateFavoriteModal.html">
                  magellan.CreateFavoriteModal.jsx
                </a>
              
                
                <a class="source" href="newtag-it.html">
                  newtag-it.jsx
                </a>
              
                
                <a class="source" href="transaction_scope_includes.html">
                  transaction_scope_includes.jsx
                </a>
              
                
                <a class="source" href="ui_policy.html">
                  ui_policy.jsx
                </a>
              
                
                <a class="source" href="z_last_include.html">
                  z_last_include.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>newtag-it.jsx</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*! RESOURCE: /scripts/lib/newtag-it.js */</span>
jQuery(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
$.widget(<span class="hljs-string">'ui.newtagit'</span>, {
<span class="hljs-attr">options</span>: {
<span class="hljs-attr">allowDuplicates</span>   : <span class="hljs-literal">false</span>,
<span class="hljs-attr">caseSensitive</span>     : <span class="hljs-literal">true</span>,
<span class="hljs-attr">fieldName</span>         : <span class="hljs-string">'tags'</span>,
<span class="hljs-attr">placeholderText</span>   : <span class="hljs-literal">null</span>,
<span class="hljs-attr">readOnly</span>          : <span class="hljs-literal">false</span>,
<span class="hljs-attr">removeConfirmation</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">labelLimit</span>          : <span class="hljs-literal">null</span>,
<span class="hljs-attr">availableLabels</span>     : [],
<span class="hljs-attr">autocomplete</span>: {},
<span class="hljs-attr">showAutocompleteOnFocus</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">allowSpaces</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">singleField</span>: <span class="hljs-literal">false</span>,
<span class="hljs-attr">singleFieldDelimiter</span>: <span class="hljs-string">','</span>,
<span class="hljs-attr">singleFieldNode</span>: <span class="hljs-literal">null</span>,
<span class="hljs-attr">animate</span>: <span class="hljs-literal">true</span>,
<span class="hljs-attr">tabIndex</span>: <span class="hljs-literal">null</span>,
<span class="hljs-attr">beforeTagAdded</span>      : <span class="hljs-literal">null</span>,
<span class="hljs-attr">afterTagAdded</span>       : <span class="hljs-literal">null</span>,
<span class="hljs-attr">beforeTagRemoved</span>    : <span class="hljs-literal">null</span>,
<span class="hljs-attr">afterTagRemoved</span>     : <span class="hljs-literal">null</span>,
<span class="hljs-attr">onTagClicked</span>        : <span class="hljs-literal">null</span>,
<span class="hljs-attr">onTagLimitExceeded</span>  : <span class="hljs-literal">null</span>,
<span class="hljs-attr">onTagAdded</span>  : <span class="hljs-literal">null</span>,
<span class="hljs-attr">onTagRemoved</span>: <span class="hljs-literal">null</span>,
<span class="hljs-attr">tagSource</span>: <span class="hljs-literal">null</span>
},
<span class="hljs-attr">_create</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.element.is(<span class="hljs-string">'input'</span>)) {
<span class="hljs-keyword">this</span>.tagList = $(<span class="hljs-string">'&lt;ul&gt;&lt;/ul&gt;'</span>).insertAfter(<span class="hljs-keyword">this</span>.element);
<span class="hljs-keyword">this</span>.options.singleField = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">this</span>.options.singleFieldNode = <span class="hljs-keyword">this</span>.element;
<span class="hljs-keyword">this</span>.element.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
} <span class="hljs-keyword">else</span> {
<span class="hljs-keyword">this</span>.tagList = <span class="hljs-keyword">this</span>.element.find(<span class="hljs-string">'ul, ol'</span>).andSelf().last();
}
<span class="hljs-keyword">this</span>.tagInput = $(<span class="hljs-string">'&lt;input type="text" autocorrect="off" autocomplete="off"/&gt;'</span>).addClass(<span class="hljs-string">'ui-widget-content'</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.readOnly) <span class="hljs-keyword">this</span>.tagInput.attr(<span class="hljs-string">'disabled'</span>, <span class="hljs-string">'disabled'</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.tabIndex) {
<span class="hljs-keyword">this</span>.tagInput.attr(<span class="hljs-string">'tabindex'</span>, <span class="hljs-keyword">this</span>.options.tabIndex);
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.placeholderText) {
<span class="hljs-keyword">this</span>.tagInput.attr(<span class="hljs-string">'placeholder'</span>, <span class="hljs-keyword">this</span>.options.placeholderText);
}
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.autocomplete.source) {
<span class="hljs-keyword">this</span>.options.autocomplete.source = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">search, showChoices</span>) </span>{
<span class="hljs-keyword">var</span> filter = search.term.toLowerCase();
<span class="hljs-keyword">var</span> choices = $.grep(<span class="hljs-keyword">this</span>.options.availableLabels, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">element</span>) </span>{
<span class="hljs-keyword">return</span> (element.toLowerCase().indexOf(filter) === <span class="hljs-number">0</span>);
});
showChoices(<span class="hljs-keyword">this</span>._subtractArray(choices, <span class="hljs-keyword">this</span>.assignedTags()));
};
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.showAutocompleteOnFocus) {
<span class="hljs-keyword">this</span>.tagInput.focus(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, ui</span>) </span>{
that._showAutocomplete();
});
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.options.autocomplete.minLength === <span class="hljs-string">'undefined'</span>) {
<span class="hljs-keyword">this</span>.options.autocomplete.minLength = <span class="hljs-number">0</span>;
}
}
<span class="hljs-keyword">if</span> ($.isFunction(<span class="hljs-keyword">this</span>.options.autocomplete.source)) {
<span class="hljs-keyword">this</span>.options.autocomplete.source = $.proxy(<span class="hljs-keyword">this</span>.options.autocomplete.source, <span class="hljs-keyword">this</span>);
}
<span class="hljs-keyword">if</span> ($.isFunction(<span class="hljs-keyword">this</span>.options.tagSource)) {
<span class="hljs-keyword">this</span>.options.tagSource = $.proxy(<span class="hljs-keyword">this</span>.options.tagSource, <span class="hljs-keyword">this</span>);
}
<span class="hljs-keyword">this</span>.tagList
.addClass(<span class="hljs-string">'tagit'</span>)
.addClass(<span class="hljs-string">'ui-widget ui-widget-content ui-corner-all'</span>)
.append($(<span class="hljs-string">'&lt;li class="tagit-new"&gt;&lt;/li&gt;'</span>).append(<span class="hljs-keyword">this</span>.tagInput));
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.context == <span class="hljs-string">'list'</span>) {
<span class="hljs-keyword">this</span>.tagList.css(<span class="hljs-string">'width'</span>, <span class="hljs-string">'96%'</span>)
.css(<span class="hljs-string">'max-height'</span>, <span class="hljs-string">'65px'</span>)
}
<span class="hljs-keyword">this</span>.tagList.click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
<span class="hljs-keyword">var</span> target = $(e.target);
<span class="hljs-keyword">if</span> (target.hasClass(<span class="hljs-string">'tagit-label'</span>)) {
<span class="hljs-keyword">var</span> tag = target.closest(<span class="hljs-string">'.tagit-choice'</span>);
<span class="hljs-keyword">if</span> (!tag.hasClass(<span class="hljs-string">'removed'</span>)) {
that._trigger(<span class="hljs-string">'onTagClicked'</span>, e, {<span class="hljs-attr">tag</span>: tag, <span class="hljs-attr">tagLabel</span>: that.tagLabel(tag)});
}
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (that.options.context == <span class="hljs-string">'list'</span>) {
<span class="hljs-keyword">if</span> (target.hasClass(<span class="hljs-string">'tagit-more'</span>))
target = target.parent();
target.css(<span class="hljs-string">'max-height'</span>, <span class="hljs-string">''</span>);
target.find(<span class="hljs-string">'.tagit-new'</span>).css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'inline-block'</span>).show();
target.find(<span class="hljs-string">'.tagit-more'</span>).hide();
}
});
<span class="hljs-keyword">var</span> addedExistingFromSingleFieldNode = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.singleField) {
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.singleFieldNode) {
<span class="hljs-keyword">var</span> node = $(<span class="hljs-keyword">this</span>.options.singleFieldNode);
<span class="hljs-keyword">var</span> tags = node.val().split(<span class="hljs-keyword">this</span>.options.singleFieldDelimiter);
node.val(<span class="hljs-string">''</span>);
$.each(tags, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index, tag</span>) </span>{
that.createTag(tag, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
addedExistingFromSingleFieldNode = <span class="hljs-literal">true</span>;
});
} <span class="hljs-keyword">else</span> {
<span class="hljs-keyword">this</span>.options.singleFieldNode = $(<span class="hljs-string">'&lt;input type="hidden" style="display:none;" value="" name="'</span> + <span class="hljs-keyword">this</span>.options.fieldName + <span class="hljs-string">'" /&gt;'</span>);
<span class="hljs-keyword">this</span>.tagList.after(<span class="hljs-keyword">this</span>.options.singleFieldNode);
}
}
<span class="hljs-keyword">var</span> labelsList =  <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.options.labelsListString).set;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; labelsList.length; i++) {
<span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.options.context == <span class="hljs-string">'list'</span>) {
that.tagList.find(<span class="hljs-string">'.tagit-new'</span>).hide();
<span class="hljs-keyword">var</span> height = that.tagList.height();
<span class="hljs-keyword">var</span> $tagitMore = $(<span class="hljs-string">'&lt;li class="tagit-more" style="height:'</span> + height + <span class="hljs-string">'"&gt;...&lt;/li&gt;'</span>);
that.tagList.append($tagitMore);
}
<span class="hljs-keyword">var</span> label = labelsList[i];
<span class="hljs-keyword">var</span> newTag = that.createTag(label.name, $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">'class'</span>), <span class="hljs-literal">true</span>, label);
}
<span class="hljs-keyword">this</span>.tagInput
.unbind(<span class="hljs-string">'keydown'</span>).keydown(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
<span class="hljs-keyword">if</span> (event.which == $.ui.keyCode.BACKSPACE &amp;&amp; that.tagInput.val() === <span class="hljs-string">''</span>) {
<span class="hljs-keyword">var</span> tag = that._lastTag();
<span class="hljs-keyword">if</span> (!that.options.removeConfirmation || tag.hasClass(<span class="hljs-string">'remove'</span>)) {
that.removeTagById(tag, tag.attr(<span class="hljs-string">'id'</span>));
<span class="hljs-keyword">if</span> (that.options.showAutocompleteOnFocus) {
setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ that._showAutocomplete(); }, <span class="hljs-number">0</span>);
}
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (that.options.removeConfirmation) {
tag.addClass(<span class="hljs-string">'remove ui-state-highlight'</span>);
}
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (that.options.removeConfirmation) {
that._lastTag().removeClass(<span class="hljs-string">'remove ui-state-highlight'</span>);
}
<span class="hljs-keyword">if</span> (
event.which === $.ui.keyCode.COMMA ||
event.which === $.ui.keyCode.ENTER ||
(
event.which == $.ui.keyCode.TAB &amp;&amp;
that.tagInput.val() !== <span class="hljs-string">''</span>
) ||
(
event.which == $.ui.keyCode.SPACE &amp;&amp;
that.options.allowSpaces !== <span class="hljs-literal">true</span> &amp;&amp;
(
$.trim(that.tagInput.val()).replace( <span class="hljs-regexp">/^s*/</span>, <span class="hljs-string">''</span> ).charAt(<span class="hljs-number">0</span>) != <span class="hljs-string">'"'</span> ||
(
$.trim(that.tagInput.val()).charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">'"'</span> &amp;&amp;
$.trim(that.tagInput.val()).charAt($.trim(that.tagInput.val()).length - <span class="hljs-number">1</span>) == <span class="hljs-string">'"'</span> &amp;&amp;
$.trim(that.tagInput.val()).length - <span class="hljs-number">1</span> !== <span class="hljs-number">0</span>
)
)
)
) {
<span class="hljs-keyword">if</span> (!(event.which === $.ui.keyCode.ENTER &amp;&amp; that.tagInput.val() === <span class="hljs-string">''</span>)) {
event.preventDefault();
}
that.createTag(that._cleanedInput());
that.tagInput.autocomplete(<span class="hljs-string">'close'</span>);
}
}).blur(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
<span class="hljs-keyword">if</span> (!that.tagInput.data(<span class="hljs-string">'autocomplete-open'</span>)) {
that.createTag(that._cleanedInput());
}
});
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.availableLabels || <span class="hljs-keyword">this</span>.options.tagSource || <span class="hljs-keyword">this</span>.options.autocomplete.source) {
<span class="hljs-keyword">var</span> autocompleteOptions = {
<span class="hljs-attr">select</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, ui</span>) </span>{
that.createTag(ui.item.value);
<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
};
$.extend(autocompleteOptions, <span class="hljs-keyword">this</span>.options.autocomplete);
autocompleteOptions.source = <span class="hljs-keyword">this</span>.options.tagSource || autocompleteOptions.source;
<span class="hljs-keyword">this</span>.tagInput.autocomplete(autocompleteOptions).bind(<span class="hljs-string">'autocompleteopen'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, ui</span>) </span>{
that.tagInput.data(<span class="hljs-string">'autocomplete-open'</span>, <span class="hljs-literal">true</span>);
}).bind(<span class="hljs-string">'autocompleteclose'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, ui</span>) </span>{
that.tagInput.data(<span class="hljs-string">'autocomplete-open'</span>, <span class="hljs-literal">false</span>)
});
}
},
<span class="hljs-attr">_cleanedInput</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">return</span> $.trim(<span class="hljs-keyword">this</span>.tagInput.val().replace(<span class="hljs-regexp">/^"(.*)"$/</span>, <span class="hljs-string">'$1'</span>));
},
<span class="hljs-attr">_lastTag</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tagList.find(<span class="hljs-string">'.tagit-choice:last:not(.removed)'</span>);
},
<span class="hljs-attr">_tags</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tagList.find(<span class="hljs-string">'.tagit-choice:not(.removed)'</span>);
},
<span class="hljs-attr">assignedTags</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
<span class="hljs-keyword">var</span> tags = [];
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.singleField) {
tags = $(<span class="hljs-keyword">this</span>.options.singleFieldNode).val().split(<span class="hljs-keyword">this</span>.options.singleFieldDelimiter);
<span class="hljs-keyword">if</span> (tags[<span class="hljs-number">0</span>] === <span class="hljs-string">''</span>) {
tags = [];
}
} <span class="hljs-keyword">else</span> {
<span class="hljs-keyword">this</span>._tags().each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
tags.push(that.tagLabel(<span class="hljs-keyword">this</span>));
});
}
<span class="hljs-keyword">return</span> tags;
},
<span class="hljs-attr">_updateSingleTagsField</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tags</span>) </span>{
$(<span class="hljs-keyword">this</span>.options.singleFieldNode).val(tags.join(<span class="hljs-keyword">this</span>.options.singleFieldDelimiter)).trigger(<span class="hljs-string">'change'</span>);
},
<span class="hljs-attr">_subtractArray</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a1, a2</span>) </span>{
<span class="hljs-keyword">var</span> result = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; a1.length; i++) {
<span class="hljs-keyword">if</span> ($.inArray(a1[i], a2) == <span class="hljs-number">-1</span>) {
result.push(a1[i]);
}
}
<span class="hljs-keyword">return</span> result;
},
<span class="hljs-attr">tagLabel</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tag</span>) </span>{
<span class="hljs-keyword">var</span> label;
<span class="hljs-keyword">var</span> pile = $(tag).find(<span class="hljs-string">'.tagit-label:first'</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> pile != <span class="hljs-string">"undefined"</span>) {
label = pile.text();
} <span class="hljs-keyword">else</span> {
label = $(tag).find(<span class="hljs-string">'input:first'</span>).val();
}
<span class="hljs-keyword">return</span> label;
},
<span class="hljs-attr">_showAutocomplete</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">this</span>.tagInput.autocomplete(<span class="hljs-string">'search'</span>, <span class="hljs-string">''</span>);
},
<span class="hljs-attr">_findTagByLabel</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
<span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
<span class="hljs-keyword">var</span> tag = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">this</span>._tags().each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i</span>) </span>{
<span class="hljs-keyword">if</span> (that._formatStr(name) == that._formatStr(that.tagLabel(<span class="hljs-keyword">this</span>))) {
tag = $(<span class="hljs-keyword">this</span>);
<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
});
<span class="hljs-keyword">return</span> tag;
},
<span class="hljs-attr">_isNew</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
<span class="hljs-keyword">return</span> !<span class="hljs-keyword">this</span>._findTagByLabel(name);
},
<span class="hljs-attr">_formatStr</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.caseSensitive) {
<span class="hljs-keyword">return</span> str;
}
<span class="hljs-keyword">return</span> $.trim(str.toLowerCase());
},
<span class="hljs-attr">_effectExists</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
<span class="hljs-keyword">return</span> <span class="hljs-built_in">Boolean</span>($.effects &amp;&amp; ($.effects[name] || ($.effects.effect &amp;&amp; $.effects.effect[name])));
},
<span class="hljs-attr">createTag</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, additionalClass, duringInitialization, labelJson</span>) </span>{
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> labelJson == <span class="hljs-string">'undefined'</span>)
labelJson = {
<span class="hljs-attr">type</span>: <span class="hljs-string">'ANY'</span>,
<span class="hljs-attr">bgcolor</span>: <span class="hljs-string">'#6ab7ef'</span>,
<span class="hljs-attr">owner</span>: <span class="hljs-literal">true</span>,
<span class="hljs-attr">sysId</span>: <span class="hljs-string">'new'</span>,
<span class="hljs-attr">query</span>: <span class="hljs-string">''</span>,
<span class="hljs-attr">tcolor</span>: <span class="hljs-string">'#fff'</span>
};
<span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
value = $.trim(value);
<span class="hljs-keyword">if</span> (value === <span class="hljs-string">''</span>) {
<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
<span class="hljs-keyword">var</span> displayValue = value;
<span class="hljs-keyword">if</span> (displayValue.length &gt; <span class="hljs-number">15</span>)
displayValue = value.substring(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>) + <span class="hljs-string">'...'</span>;
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.allowDuplicates &amp;&amp; !<span class="hljs-keyword">this</span>._isNew(value)) {
<span class="hljs-keyword">var</span> existingTag = <span class="hljs-keyword">this</span>._findTagByLabel(value);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'onTagExists'</span>, <span class="hljs-literal">null</span>, {
<span class="hljs-attr">existingTag</span>: existingTag,
<span class="hljs-attr">duringInitialization</span>: duringInitialization
}) !== <span class="hljs-literal">false</span>) {
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._effectExists(<span class="hljs-string">'highlight'</span>)) {
existingTag.effect(<span class="hljs-string">'highlight'</span>);
}
}
<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.labelLimit &amp;&amp; <span class="hljs-keyword">this</span>._tags().length &gt;= <span class="hljs-keyword">this</span>.options.labelLimit) {
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'onTagLimitExceeded'</span>, <span class="hljs-literal">null</span>, {<span class="hljs-attr">duringInitialization</span>: duringInitialization});
<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
<span class="hljs-keyword">if</span> (labelJson.tcolor == <span class="hljs-string">""</span>) labelJson.tcolor = <span class="hljs-string">"#fff"</span>;
<span class="hljs-keyword">var</span> label = $((<span class="hljs-keyword">this</span>.options.onTagClicked || g_enhanced_activated == <span class="hljs-string">'true'</span>)? <span class="hljs-string">'&lt;a style="color:'</span> + labelJson.tcolor + <span class="hljs-string">'" class="tagit-label"&gt;&lt;/a&gt;'</span> : <span class="hljs-string">'&lt;span class="tagit-label"&gt;&lt;/span&gt;'</span>)
.text(displayValue);
<span class="hljs-keyword">if</span> (labelJson.uncommon)
label.css(<span class="hljs-string">"font-style"</span>, <span class="hljs-string">"italic"</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.query) {
label.click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-built_in">window</span>.open(that.options.table + <span class="hljs-string">"_list.do?sysparm_query="</span> + labelJson.query);
});
} <span class="hljs-keyword">else</span> {
label.click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
<span class="hljs-keyword">var</span> list = GlideList2.get(that.options.table);
list.addFilter(labelJson.query);
list.refresh(<span class="hljs-number">1</span>);
});
}
<span class="hljs-keyword">var</span> tag = $(<span class="hljs-string">'&lt;li&gt;&lt;/li&gt;'</span>)
.addClass(<span class="hljs-string">'tagit-choice ui-widget-content ui-state-default ui-corner-all'</span>)
.addClass(additionalClass)
.attr(<span class="hljs-string">'id'</span>, labelJson.sysId)
.css(<span class="hljs-string">'background-color'</span>, labelJson.bgcolor)
.css(<span class="hljs-string">'color'</span>, labelJson.tcolor);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.readOnly){
tag.addClass(<span class="hljs-string">'tagit-choice-read-only'</span>);
tag.append(label);
} <span class="hljs-keyword">else</span> {
tag.addClass(<span class="hljs-string">'tagit-choice-editable'</span>);
<span class="hljs-keyword">var</span> removeTagIcon = $(<span class="hljs-string">'&lt;span&gt;&lt;/span&gt;'</span>)
.addClass(<span class="hljs-string">'ui-icon ui-icon-close'</span>);
<span class="hljs-keyword">var</span> removeTag = $(<span class="hljs-string">'&lt;a&gt;&lt;span style="color:'</span> + labelJson.tcolor + <span class="hljs-string">'" class="text-icon icon-cross"&gt;&lt;/span&gt;&lt;/a&gt;'</span>)
.addClass(<span class="hljs-string">'tagit-close'</span>)
.append(removeTagIcon)
.click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
that.removeTagById(tag, <span class="hljs-keyword">this</span>.up(<span class="hljs-string">"li"</span>).getAttribute(<span class="hljs-string">"id"</span>));
e.stopPropagation();
});
<span class="hljs-keyword">if</span> (g_enhanced_activated == <span class="hljs-string">'true'</span>) {
<span class="hljs-keyword">var</span> icon = (labelJson.type == <span class="hljs-string">'SHARED'</span>) ? <span class="hljs-string">'icon-user-group'</span> : <span class="hljs-string">'icon-user'</span>;
<span class="hljs-keyword">if</span>(labelJson.type == <span class="hljs-string">"SHARED"</span>) {
tag.addClass(<span class="hljs-string">"tagit-share-group"</span>);
} <span class="hljs-keyword">else</span> {
tag.addClass(<span class="hljs-string">"tagit-share-user"</span>);
}
<span class="hljs-keyword">var</span> shareTag = $(<span class="hljs-string">'&lt;span&gt;&lt;span class="'</span> + icon + <span class="hljs-string">'" style="color:'</span> + labelJson.tcolor + <span class="hljs-string">';margin-left:2px;"&gt;&lt;/span&gt;&lt;/span&gt;'</span>)
.addClass(<span class="hljs-string">'tagit-share'</span>);
<span class="hljs-keyword">if</span> (labelJson.owner == <span class="hljs-literal">true</span>)
shareTag.addClass(<span class="hljs-string">"pointerhand"</span>);
shareTag.attr(<span class="hljs-string">'id'</span>, value);
<span class="hljs-keyword">if</span> (labelJson.owner == <span class="hljs-literal">true</span>) {
shareTag.attr(<span class="hljs-string">'title'</span>, <span class="hljs-string">'Edit tag audience'</span>);
shareTag.click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
showTagForm(<span class="hljs-keyword">this</span>.up(<span class="hljs-string">"li"</span>).getAttribute(<span class="hljs-string">"id"</span>));
});
}
}
<span class="hljs-keyword">if</span> (g_enhanced_activated == <span class="hljs-string">'true'</span>)
tag.append(shareTag);
tag.append(label);
}
tag.append(removeTag);
<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.options.singleField) {
<span class="hljs-keyword">var</span> escapedValue = label.html();
tag.append(<span class="hljs-string">'&lt;input type="hidden" style="display:none;" value="'</span> + escapedValue + <span class="hljs-string">'" name="'</span> + <span class="hljs-keyword">this</span>.options.fieldName + <span class="hljs-string">'" /&gt;'</span>);
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'beforeTagAdded'</span>, <span class="hljs-literal">null</span>, {
<span class="hljs-attr">tag</span>: tag,
<span class="hljs-attr">tagLabel</span>: <span class="hljs-keyword">this</span>.tagLabel(tag),
<span class="hljs-attr">duringInitialization</span>: duringInitialization
}) === <span class="hljs-literal">false</span>) {
<span class="hljs-keyword">return</span>;
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.singleField) {
<span class="hljs-keyword">var</span> tags = <span class="hljs-keyword">this</span>.assignedTags();
tags.push(value);
<span class="hljs-keyword">this</span>._updateSingleTagsField(tags);
}
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'onTagAdded'</span>, <span class="hljs-literal">null</span>, tag, <span class="hljs-keyword">this</span>.options.table, <span class="hljs-keyword">this</span>.options.rowId);
<span class="hljs-keyword">this</span>.tagInput.val(<span class="hljs-string">''</span>);
<span class="hljs-keyword">this</span>.tagInput.parent().before(tag);
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'afterTagAdded'</span>, <span class="hljs-literal">null</span>, {
<span class="hljs-attr">tag</span>: tag,
<span class="hljs-attr">tagLabel</span>: value,
<span class="hljs-attr">type</span>: labelJson.type,
<span class="hljs-attr">duringInitialization</span>: duringInitialization,
<span class="hljs-attr">table</span>:<span class="hljs-keyword">this</span>.options.table,
<span class="hljs-attr">rowId</span>:<span class="hljs-keyword">this</span>.options.rowId});
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.showAutocompleteOnFocus &amp;&amp; !duringInitialization) {
<span class="hljs-keyword">var</span> currentActiveElement = <span class="hljs-built_in">document</span>.activeElement;
setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.activeElement !== currentActiveElement)
<span class="hljs-keyword">return</span>;
that.preserveCursor(<span class="hljs-built_in">document</span>.activeElement);
that._showAutocomplete();
}, <span class="hljs-number">0</span>);
}
<span class="hljs-keyword">return</span> tag;
},
<span class="hljs-attr">removeTag</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tag, animate</span>) </span>{
animate = <span class="hljs-keyword">typeof</span> animate === <span class="hljs-string">'undefined'</span> ? <span class="hljs-keyword">this</span>.options.animate : animate;
tag = $(tag);
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'onTagRemoved'</span>, <span class="hljs-literal">null</span>, tag, <span class="hljs-keyword">this</span>.options.table, <span class="hljs-keyword">this</span>.options.rowId);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'beforeTagRemoved'</span>, <span class="hljs-literal">null</span>, {<span class="hljs-attr">tag</span>: tag, <span class="hljs-attr">tagLabel</span>: <span class="hljs-keyword">this</span>.tagLabel(tag)}) === <span class="hljs-literal">false</span>) {
<span class="hljs-keyword">return</span>;
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.singleField) {
<span class="hljs-keyword">var</span> tags = <span class="hljs-keyword">this</span>.assignedTags();
<span class="hljs-keyword">var</span> removedTagLabel = <span class="hljs-keyword">this</span>.tagLabel(tag);
tags = $.grep(tags, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>)</span>{
<span class="hljs-keyword">return</span> el != removedTagLabel;
});
<span class="hljs-keyword">this</span>._updateSingleTagsField(tags);
}
<span class="hljs-keyword">if</span> (animate) {
tag.addClass(<span class="hljs-string">'removed'</span>);
<span class="hljs-keyword">var</span> hide_args = <span class="hljs-keyword">this</span>._effectExists(<span class="hljs-string">'blind'</span>) ? [<span class="hljs-string">'blind'</span>, {<span class="hljs-attr">direction</span>: <span class="hljs-string">'horizontal'</span>}, <span class="hljs-string">'fast'</span>] : [<span class="hljs-string">'fast'</span>];
hide_args.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
tag.remove();
});
tag.fadeOut(<span class="hljs-string">'fast'</span>).hide.apply(tag, hide_args).dequeue();
} <span class="hljs-keyword">else</span> {
tag.remove();
}
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'afterTagRemoved'</span>, <span class="hljs-literal">null</span>, {<span class="hljs-attr">tag</span>: tag, <span class="hljs-attr">tagLabel</span>: <span class="hljs-keyword">this</span>.tagLabel(tag), <span class="hljs-attr">table</span>:<span class="hljs-keyword">this</span>.options.table,
<span class="hljs-attr">rowId</span>:<span class="hljs-keyword">this</span>.options.rowId});
},
<span class="hljs-attr">removeTagById</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tag, id, animate</span>) </span>{
animate = <span class="hljs-keyword">typeof</span> animate === <span class="hljs-string">'undefined'</span> ? <span class="hljs-keyword">this</span>.options.animate : animate;
tag = $(tag);
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'onTagRemoved'</span>, <span class="hljs-literal">null</span>, tag, <span class="hljs-keyword">this</span>.options.table, <span class="hljs-keyword">this</span>.options.rowId);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'beforeTagRemoved'</span>, <span class="hljs-literal">null</span>, {<span class="hljs-attr">tag</span>: id, <span class="hljs-attr">tagLabel</span>: <span class="hljs-keyword">this</span>.tagLabel(tag)}) === <span class="hljs-literal">false</span>) {
<span class="hljs-keyword">return</span>;
}
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.options.singleField) {
<span class="hljs-keyword">var</span> tags = <span class="hljs-keyword">this</span>.assignedTags();
<span class="hljs-keyword">var</span> removedTagLabel = <span class="hljs-keyword">this</span>.tagLabel(tag);
tags = $.grep(tags, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>)</span>{
<span class="hljs-keyword">return</span> el != removedTagLabel;
});
<span class="hljs-keyword">this</span>._updateSingleTagsField(tags);
}
<span class="hljs-keyword">if</span> (animate) {
tag.addClass(<span class="hljs-string">'removed'</span>);
<span class="hljs-keyword">var</span> hide_args = <span class="hljs-keyword">this</span>._effectExists(<span class="hljs-string">'blind'</span>) ? [<span class="hljs-string">'blind'</span>, {<span class="hljs-attr">direction</span>: <span class="hljs-string">'horizontal'</span>}, <span class="hljs-string">'fast'</span>] : [<span class="hljs-string">'fast'</span>];
hide_args.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
tag.remove();
});
tag.fadeOut(<span class="hljs-string">'fast'</span>).hide.apply(tag, hide_args).dequeue();
} <span class="hljs-keyword">else</span> {
tag.remove();
}
<span class="hljs-keyword">this</span>._trigger(<span class="hljs-string">'afterTagRemoved'</span>, <span class="hljs-literal">null</span>, {<span class="hljs-attr">tag</span>: id, <span class="hljs-attr">tagLabel</span>: <span class="hljs-keyword">this</span>.tagLabel(tag), <span class="hljs-attr">table</span>:<span class="hljs-keyword">this</span>.options.table,
<span class="hljs-attr">rowId</span>:<span class="hljs-keyword">this</span>.options.rowId});
},
<span class="hljs-attr">removeTagByLabel</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">tagLabel, animate</span>) </span>{
<span class="hljs-keyword">var</span> toRemove = <span class="hljs-keyword">this</span>._findTagByLabel(tagLabel);
<span class="hljs-keyword">if</span> (!toRemove) {
<span class="hljs-keyword">throw</span> <span class="hljs-string">"No such tag exists with the name '"</span> + tagLabel + <span class="hljs-string">"'"</span>;
}
<span class="hljs-keyword">this</span>.removeTag(toRemove, animate);
},
<span class="hljs-attr">removeAll</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
<span class="hljs-keyword">this</span>._tags().each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index, tag</span>) </span>{
that.removeTag(tag, <span class="hljs-literal">false</span>);
});
},
<span class="hljs-attr">preserveCursor</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">el</span>) </span>{
<span class="hljs-keyword">if</span> (!el)
<span class="hljs-keyword">return</span>;
<span class="hljs-keyword">var</span> initialValue = el.value;
el.value = initialValue + <span class="hljs-number">1</span>;
el.value = initialValue;
}
});
});
;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
